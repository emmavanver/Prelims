<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>3 Retrieve satellite data | Spatio-temporal yield variation to precipitation within a field</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="3 Retrieve satellite data | Spatio-temporal yield variation to precipitation within a field" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="3 Retrieve satellite data | Spatio-temporal yield variation to precipitation within a field" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Emmanuela van Versendaal" />


<meta name="date" content="2024-08-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="retrieve-satellite-data.html"/>
<link rel="next" href="parts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<Spatio-temporal Yield variation within field>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="retrieve-satellite-data.html"><a href="retrieve-satellite-data.html"><i class="fa fa-check"></i><b>2</b> Retrieve satellite data</a></li>
<li class="chapter" data-level="3" data-path="retrieve-satellite-data-1.html"><a href="retrieve-satellite-data-1.html"><i class="fa fa-check"></i><b>3</b> Retrieve satellite data</a>
<ul>
<li class="chapter" data-level="3.1" data-path="retrieve-satellite-data-1.html"><a href="retrieve-satellite-data-1.html#import-and-configurate-libraries"><i class="fa fa-check"></i><b>3.1</b> Import and configurate libraries</a></li>
<li class="chapter" data-level="3.2" data-path="retrieve-satellite-data-1.html"><a href="retrieve-satellite-data-1.html#field-identification"><i class="fa fa-check"></i><b>3.2</b> Field identification</a></li>
<li class="chapter" data-level="3.3" data-path="retrieve-satellite-data-1.html"><a href="retrieve-satellite-data-1.html#gcvi-peak-detection"><i class="fa fa-check"></i><b>3.3</b> GCVI Peak detection</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="parts.html"><a href="parts.html"><i class="fa fa-check"></i><b>4</b> Parts</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio-temporal yield variation to precipitation within a field</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="retrieve-satellite-data-1" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">3</span> Retrieve satellite data<a href="retrieve-satellite-data-1.html#retrieve-satellite-data-1" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="import-and-configurate-libraries" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Import and configurate libraries<a href="retrieve-satellite-data-1.html#import-and-configurate-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Run the following code only if you never installer rgee package in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="retrieve-satellite-data-1.html#cb1-1" tabindex="-1"></a><span class="do">### To install Rgee</span></span>
<span id="cb1-2"><a href="retrieve-satellite-data-1.html#cb1-2" tabindex="-1"></a><span class="co">#remove.packages(“reticulate”)</span></span>
<span id="cb1-3"><a href="retrieve-satellite-data-1.html#cb1-3" tabindex="-1"></a><span class="co">#install.packages(“reticulate”, dependencies = TRUE)</span></span>
<span id="cb1-4"><a href="retrieve-satellite-data-1.html#cb1-4" tabindex="-1"></a><span class="co">#remotes::install_github(“r-spatial/rgee”)</span></span>
<span id="cb1-5"><a href="retrieve-satellite-data-1.html#cb1-5" tabindex="-1"></a><span class="do">##No Run</span></span>
<span id="cb1-6"><a href="retrieve-satellite-data-1.html#cb1-6" tabindex="-1"></a><span class="do">## If it is the first time to use RGEE is necessary install gcloud cli</span></span>
<span id="cb1-7"><a href="retrieve-satellite-data-1.html#cb1-7" tabindex="-1"></a><span class="co">#reticulate::py_install(“earthengine-api”, envname = “r-miniconda”)</span></span>
<span id="cb1-8"><a href="retrieve-satellite-data-1.html#cb1-8" tabindex="-1"></a><span class="co">#reticulate::py_install(“numpy”, envname = “/Users/emmavanversendaal/Library/r-miniconda-arm64/envs/r-reticulate”)</span></span>
<span id="cb1-9"><a href="retrieve-satellite-data-1.html#cb1-9" tabindex="-1"></a><span class="co">#reticulate::py_install(“google-cloud-storage”)</span></span>
<span id="cb1-10"><a href="retrieve-satellite-data-1.html#cb1-10" tabindex="-1"></a><span class="co">#reticulate::py_config()</span></span></code></pre></div>
<p>Import libraries and clean environment</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="retrieve-satellite-data-1.html#cb2-1" tabindex="-1"></a><span class="co"># # Packages to be used</span></span>
<span id="cb2-2"><a href="retrieve-satellite-data-1.html#cb2-2" tabindex="-1"></a><span class="co"># library_names &lt;- c(“sp”, # (Bivand et al., 2012)</span></span>
<span id="cb2-3"><a href="retrieve-satellite-data-1.html#cb2-3" tabindex="-1"></a><span class="co">#                    “sf”, # (Pebesma, 2018)</span></span>
<span id="cb2-4"><a href="retrieve-satellite-data-1.html#cb2-4" tabindex="-1"></a><span class="co">#                    “raster”, # (Hijmans, 2023)</span></span>
<span id="cb2-5"><a href="retrieve-satellite-data-1.html#cb2-5" tabindex="-1"></a><span class="co">#                    “tidyverse”, # (Wickham et al., 2019)</span></span>
<span id="cb2-6"><a href="retrieve-satellite-data-1.html#cb2-6" tabindex="-1"></a><span class="co">#                    “rgee”, # (Aybar, 2024)</span></span>
<span id="cb2-7"><a href="retrieve-satellite-data-1.html#cb2-7" tabindex="-1"></a><span class="co">#                    “tidyrgee”)  # (Arno and Erickson, 2022)</span></span>
<span id="cb2-8"><a href="retrieve-satellite-data-1.html#cb2-8" tabindex="-1"></a><span class="co"># # Iterate over each library name</span></span>
<span id="cb2-9"><a href="retrieve-satellite-data-1.html#cb2-9" tabindex="-1"></a><span class="co"># for (lib_name in library_names) {</span></span>
<span id="cb2-10"><a href="retrieve-satellite-data-1.html#cb2-10" tabindex="-1"></a><span class="co">#   # Check if the library is already installed</span></span>
<span id="cb2-11"><a href="retrieve-satellite-data-1.html#cb2-11" tabindex="-1"></a><span class="co">#   if (!require(lib_name, character.only = TRUE)) {</span></span>
<span id="cb2-12"><a href="retrieve-satellite-data-1.html#cb2-12" tabindex="-1"></a><span class="co">#     # If the library is not installed, install it</span></span>
<span id="cb2-13"><a href="retrieve-satellite-data-1.html#cb2-13" tabindex="-1"></a><span class="co">#     install.packages(lib_name, dependencies = TRUE)</span></span>
<span id="cb2-14"><a href="retrieve-satellite-data-1.html#cb2-14" tabindex="-1"></a><span class="co">#     # Load the library</span></span>
<span id="cb2-15"><a href="retrieve-satellite-data-1.html#cb2-15" tabindex="-1"></a><span class="co">#     library(lib_name, character.only = TRUE)</span></span>
<span id="cb2-16"><a href="retrieve-satellite-data-1.html#cb2-16" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb2-17"><a href="retrieve-satellite-data-1.html#cb2-17" tabindex="-1"></a><span class="co">#     # If the library is already installed, load it</span></span>
<span id="cb2-18"><a href="retrieve-satellite-data-1.html#cb2-18" tabindex="-1"></a><span class="co">#     library(lib_name, character.only = TRUE)</span></span>
<span id="cb2-19"><a href="retrieve-satellite-data-1.html#cb2-19" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb2-20"><a href="retrieve-satellite-data-1.html#cb2-20" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
<p>Rgee configuration. Run this code to initialize session in Google Earth Engine.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="retrieve-satellite-data-1.html#cb3-1" tabindex="-1"></a><span class="co"># rgee::ee_check()</span></span>
<span id="cb3-2"><a href="retrieve-satellite-data-1.html#cb3-2" tabindex="-1"></a><span class="co"># ee_clean_user_credentials()</span></span>
<span id="cb3-3"><a href="retrieve-satellite-data-1.html#cb3-3" tabindex="-1"></a><span class="co"># ee_Authenticate(user=‘ee-evanversendaal’)</span></span>
<span id="cb3-4"><a href="retrieve-satellite-data-1.html#cb3-4" tabindex="-1"></a><span class="co"># ee_Initialize(user=‘ee-evanversendaal’)</span></span></code></pre></div>
<p>Run the following Functions: 1) Clouds mask function to identify pixels that are likely to be a cloud; 2) to calculate Green Chlorophyll Vegetation Index (GCVI)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="retrieve-satellite-data-1.html#cb4-1" tabindex="-1"></a><span class="co"># ## 1) Clouds masking function ##</span></span>
<span id="cb4-2"><a href="retrieve-satellite-data-1.html#cb4-2" tabindex="-1"></a><span class="co"># # This function is to filter the clouds, to have images with clear conditions</span></span>
<span id="cb4-3"><a href="retrieve-satellite-data-1.html#cb4-3" tabindex="-1"></a><span class="co"># maskS2clouds &lt;-  function(image) {</span></span>
<span id="cb4-4"><a href="retrieve-satellite-data-1.html#cb4-4" tabindex="-1"></a><span class="co">#     qa = image$select(‘QA60’);</span></span>
<span id="cb4-5"><a href="retrieve-satellite-data-1.html#cb4-5" tabindex="-1"></a><span class="co">#     # Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb4-6"><a href="retrieve-satellite-data-1.html#cb4-6" tabindex="-1"></a><span class="co">#     cloudBitMask = bitwShiftL(1,10)</span></span>
<span id="cb4-7"><a href="retrieve-satellite-data-1.html#cb4-7" tabindex="-1"></a><span class="co">#     cirrusBitMask = bitwShiftL(1, 11)</span></span>
<span id="cb4-8"><a href="retrieve-satellite-data-1.html#cb4-8" tabindex="-1"></a><span class="co">#     # Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb4-9"><a href="retrieve-satellite-data-1.html#cb4-9" tabindex="-1"></a><span class="co">#     mask_data = qa$bitwiseAnd(cloudBitMask)$</span></span>
<span id="cb4-10"><a href="retrieve-satellite-data-1.html#cb4-10" tabindex="-1"></a><span class="co">#       eq(0)$And(qa$bitwiseAnd(cirrusBitMask)$eq(0));</span></span>
<span id="cb4-11"><a href="retrieve-satellite-data-1.html#cb4-11" tabindex="-1"></a><span class="co">#     return(image$updateMask(mask_data)$divide(10000))</span></span>
<span id="cb4-12"><a href="retrieve-satellite-data-1.html#cb4-12" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb4-13"><a href="retrieve-satellite-data-1.html#cb4-13" tabindex="-1"></a><span class="co"># ## 2) Function to obatin GCVI ##</span></span>
<span id="cb4-14"><a href="retrieve-satellite-data-1.html#cb4-14" tabindex="-1"></a><span class="co"># getindex_GCVI &lt;- function(image) {</span></span>
<span id="cb4-15"><a href="retrieve-satellite-data-1.html#cb4-15" tabindex="-1"></a><span class="co">#   #Index &lt;- image$normalizedDifference(c(“B8”, “B4&quot;))$rename(‘Index’)</span></span>
<span id="cb4-16"><a href="retrieve-satellite-data-1.html#cb4-16" tabindex="-1"></a><span class="co">#   Index &lt;- image$expression(</span></span>
<span id="cb4-17"><a href="retrieve-satellite-data-1.html#cb4-17" tabindex="-1"></a><span class="co">#   expression = “(NIR/GREEN)-1”,</span></span>
<span id="cb4-18"><a href="retrieve-satellite-data-1.html#cb4-18" tabindex="-1"></a><span class="co">#   opt_map =  list(</span></span>
<span id="cb4-19"><a href="retrieve-satellite-data-1.html#cb4-19" tabindex="-1"></a><span class="co">#     “NIR” = image$select(“B8”),</span></span>
<span id="cb4-20"><a href="retrieve-satellite-data-1.html#cb4-20" tabindex="-1"></a><span class="co">#     “GREEN” = image$select(“B3”)</span></span>
<span id="cb4-21"><a href="retrieve-satellite-data-1.html#cb4-21" tabindex="-1"></a><span class="co">#    )</span></span>
<span id="cb4-22"><a href="retrieve-satellite-data-1.html#cb4-22" tabindex="-1"></a><span class="co">#   )$rename(“Index”)</span></span>
<span id="cb4-23"><a href="retrieve-satellite-data-1.html#cb4-23" tabindex="-1"></a><span class="co">#   return(image$addBands(Index))</span></span>
<span id="cb4-24"><a href="retrieve-satellite-data-1.html#cb4-24" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
</div>
<div id="field-identification" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Field identification<a href="retrieve-satellite-data-1.html#field-identification" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>In this step, it’s essential to specify the field identification because the code is designed to automatically run across different fields. By defining the specific field at this stage, you ensure that the correct data is selected for analysis. This setup allows for a streamlined and efficient workflow, enabling the code to process data for multiple fields as needed.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="retrieve-satellite-data-1.html#cb5-1" tabindex="-1"></a><span class="co">#FARM_NAME = &quot;...&quot;</span></span></code></pre></div>
</div>
<div id="gcvi-peak-detection" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> GCVI Peak detection<a href="retrieve-satellite-data-1.html#gcvi-peak-detection" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="retrieve-satellite-data.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="parts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/1_Sentinel_data.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
