<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Data collection &amp; Wrangling | Spatio-temporal yield variation to precipitation within a field</title>
  <meta name="description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Data collection &amp; Wrangling | Spatio-temporal yield variation to precipitation within a field" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Data collection &amp; Wrangling | Spatio-temporal yield variation to precipitation within a field" />
  
  <meta name="twitter:description" content="<p>This is a minimal example of using the bookdown package to write a book.
The HTML output format for this example is bookdown::gitbook,
set in the _output.yml file.</p>" />
  

<meta name="author" content="Emmanuela van Versendaal" />


<meta name="date" content="2024-08-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="body {
  font-family: Arial, sans-serif;
  font-size: 10pt;
  text-align: justify;
}
p {
  text-align: justify;
}" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<Spatio-temporal Yield variation within field>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html"><i class="fa fa-check"></i><b>2</b> Data collection &amp; Wrangling</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#retrieve-satellite-data"><i class="fa fa-check"></i><b>2.1</b> Retrieve satellite data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#import-and-configurate-libraries"><i class="fa fa-check"></i><b>2.1.1</b> Import and configurate libraries</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#field-identification"><i class="fa fa-check"></i><b>2.1.2</b> Field identification</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#gcvi-peak-detection"><i class="fa fa-check"></i><b>2.1.3</b> GCVI Peak detection</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#gcvi-at-pixel-level-within-field"><i class="fa fa-check"></i><b>2.1.4</b> GCVI at pixel level within field</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#clean-yield-monitor-data"><i class="fa fa-check"></i><b>2.2</b> Clean yield monitor data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#import-libraries"><i class="fa fa-check"></i><b>2.2.1</b> Import libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#field-identification-1"><i class="fa fa-check"></i><b>2.2.2</b> Field identification</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#cleaning-process"><i class="fa fa-check"></i><b>2.2.3</b> Cleaning process</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#merge-ym-data-gcvi-data"><i class="fa fa-check"></i><b>2.3</b> Merge YM data &amp; GCVI data</a></li>
<li class="chapter" data-level="2.4" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#cumulative-precipitation-period"><i class="fa fa-check"></i><b>2.4</b> Cumulative precipitation period</a></li>
<li class="chapter" data-level="2.5" data-path="data-collection-wrangling.html"><a href="data-collection-wrangling.html#reference"><i class="fa fa-check"></i><b>2.5</b> Reference</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio-temporal yield variation to precipitation within a field</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="data-collection-wrangling" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Data collection &amp; Wrangling<a href="data-collection-wrangling.html#data-collection-wrangling" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="retrieve-satellite-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Retrieve satellite data<a href="data-collection-wrangling.html#retrieve-satellite-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="import-and-configurate-libraries" class="section level3 hasAnchor" number="2.1.1">
<h3><span class="header-section-number">2.1.1</span> Import and configurate libraries<a href="data-collection-wrangling.html#import-and-configurate-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Run the following code only if you never installer rgee package in R.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="data-collection-wrangling.html#cb1-1" tabindex="-1"></a><span class="do">### To install Rgee</span></span>
<span id="cb1-2"><a href="data-collection-wrangling.html#cb1-2" tabindex="-1"></a><span class="co">#remove.packages(“reticulate”)</span></span>
<span id="cb1-3"><a href="data-collection-wrangling.html#cb1-3" tabindex="-1"></a><span class="co">#install.packages(“reticulate”, dependencies = TRUE)</span></span>
<span id="cb1-4"><a href="data-collection-wrangling.html#cb1-4" tabindex="-1"></a><span class="co">#remotes::install_github(“r-spatial/rgee”)</span></span>
<span id="cb1-5"><a href="data-collection-wrangling.html#cb1-5" tabindex="-1"></a><span class="do">##No Run</span></span>
<span id="cb1-6"><a href="data-collection-wrangling.html#cb1-6" tabindex="-1"></a><span class="do">## If it is the first time to use RGEE is necessary install gcloud cli</span></span>
<span id="cb1-7"><a href="data-collection-wrangling.html#cb1-7" tabindex="-1"></a><span class="co">#reticulate::py_install(“earthengine-api”, envname = “r-miniconda”)</span></span>
<span id="cb1-8"><a href="data-collection-wrangling.html#cb1-8" tabindex="-1"></a><span class="co">#reticulate::py_install(“numpy”, envname = “/Users/emmavanversendaal/Library/r-miniconda-arm64/envs/r-reticulate”)</span></span>
<span id="cb1-9"><a href="data-collection-wrangling.html#cb1-9" tabindex="-1"></a><span class="co">#reticulate::py_install(“google-cloud-storage”)</span></span>
<span id="cb1-10"><a href="data-collection-wrangling.html#cb1-10" tabindex="-1"></a><span class="co">#reticulate::py_config()</span></span></code></pre></div>
<p>Import libraries and clean environment</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="data-collection-wrangling.html#cb2-1" tabindex="-1"></a><span class="co"># # Packages to be used</span></span>
<span id="cb2-2"><a href="data-collection-wrangling.html#cb2-2" tabindex="-1"></a><span class="co"># library_names &lt;- c(“sp”, # (Bivand et al., 2012)</span></span>
<span id="cb2-3"><a href="data-collection-wrangling.html#cb2-3" tabindex="-1"></a><span class="co">#                    “sf”, # (Pebesma, 2018)</span></span>
<span id="cb2-4"><a href="data-collection-wrangling.html#cb2-4" tabindex="-1"></a><span class="co">#                    “raster”, # (Hijmans, 2023)</span></span>
<span id="cb2-5"><a href="data-collection-wrangling.html#cb2-5" tabindex="-1"></a><span class="co">#                    “tidyverse”, # (Wickham et al., 2019)</span></span>
<span id="cb2-6"><a href="data-collection-wrangling.html#cb2-6" tabindex="-1"></a><span class="co">#                    “rgee”, # (Aybar, 2024)</span></span>
<span id="cb2-7"><a href="data-collection-wrangling.html#cb2-7" tabindex="-1"></a><span class="co">#                    “tidyrgee”)  # (Arno and Erickson, 2022)</span></span>
<span id="cb2-8"><a href="data-collection-wrangling.html#cb2-8" tabindex="-1"></a><span class="co"># # Iterate over each library name</span></span>
<span id="cb2-9"><a href="data-collection-wrangling.html#cb2-9" tabindex="-1"></a><span class="co"># for (lib_name in library_names) {</span></span>
<span id="cb2-10"><a href="data-collection-wrangling.html#cb2-10" tabindex="-1"></a><span class="co">#   # Check if the library is already installed</span></span>
<span id="cb2-11"><a href="data-collection-wrangling.html#cb2-11" tabindex="-1"></a><span class="co">#   if (!require(lib_name, character.only = TRUE)) {</span></span>
<span id="cb2-12"><a href="data-collection-wrangling.html#cb2-12" tabindex="-1"></a><span class="co">#     # If the library is not installed, install it</span></span>
<span id="cb2-13"><a href="data-collection-wrangling.html#cb2-13" tabindex="-1"></a><span class="co">#     install.packages(lib_name, dependencies = TRUE)</span></span>
<span id="cb2-14"><a href="data-collection-wrangling.html#cb2-14" tabindex="-1"></a><span class="co">#     # Load the library</span></span>
<span id="cb2-15"><a href="data-collection-wrangling.html#cb2-15" tabindex="-1"></a><span class="co">#     library(lib_name, character.only = TRUE)</span></span>
<span id="cb2-16"><a href="data-collection-wrangling.html#cb2-16" tabindex="-1"></a><span class="co">#   } else {</span></span>
<span id="cb2-17"><a href="data-collection-wrangling.html#cb2-17" tabindex="-1"></a><span class="co">#     # If the library is already installed, load it</span></span>
<span id="cb2-18"><a href="data-collection-wrangling.html#cb2-18" tabindex="-1"></a><span class="co">#     library(lib_name, character.only = TRUE)</span></span>
<span id="cb2-19"><a href="data-collection-wrangling.html#cb2-19" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb2-20"><a href="data-collection-wrangling.html#cb2-20" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
<p>Rgee configuration. Run this code to initialize session in Google Earth Engine.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="data-collection-wrangling.html#cb3-1" tabindex="-1"></a><span class="co"># rgee::ee_check()</span></span>
<span id="cb3-2"><a href="data-collection-wrangling.html#cb3-2" tabindex="-1"></a><span class="co"># ee_clean_user_credentials()</span></span>
<span id="cb3-3"><a href="data-collection-wrangling.html#cb3-3" tabindex="-1"></a><span class="co"># ee_Authenticate(user=‘ee-evanversendaal’)</span></span>
<span id="cb3-4"><a href="data-collection-wrangling.html#cb3-4" tabindex="-1"></a><span class="co"># ee_Initialize(user=‘ee-evanversendaal’)</span></span></code></pre></div>
<p>Run the following Functions: 1) Clouds mask function to identify pixels that are likely to be a cloud; 2) to calculate Green Chlorophyll Vegetation Index (GCVI)</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="data-collection-wrangling.html#cb4-1" tabindex="-1"></a><span class="co"># ## 1) Clouds masking function ##</span></span>
<span id="cb4-2"><a href="data-collection-wrangling.html#cb4-2" tabindex="-1"></a><span class="co"># # This function is to filter the clouds, to have images with clear conditions</span></span>
<span id="cb4-3"><a href="data-collection-wrangling.html#cb4-3" tabindex="-1"></a><span class="co"># maskS2clouds &lt;-  function(image) {</span></span>
<span id="cb4-4"><a href="data-collection-wrangling.html#cb4-4" tabindex="-1"></a><span class="co">#     qa = image$select(‘QA60’);</span></span>
<span id="cb4-5"><a href="data-collection-wrangling.html#cb4-5" tabindex="-1"></a><span class="co">#     # Bits 10 and 11 are clouds and cirrus, respectively.</span></span>
<span id="cb4-6"><a href="data-collection-wrangling.html#cb4-6" tabindex="-1"></a><span class="co">#     cloudBitMask = bitwShiftL(1,10)</span></span>
<span id="cb4-7"><a href="data-collection-wrangling.html#cb4-7" tabindex="-1"></a><span class="co">#     cirrusBitMask = bitwShiftL(1, 11)</span></span>
<span id="cb4-8"><a href="data-collection-wrangling.html#cb4-8" tabindex="-1"></a><span class="co">#     # Both flags should be set to zero, indicating clear conditions.</span></span>
<span id="cb4-9"><a href="data-collection-wrangling.html#cb4-9" tabindex="-1"></a><span class="co">#     mask_data = qa$bitwiseAnd(cloudBitMask)$</span></span>
<span id="cb4-10"><a href="data-collection-wrangling.html#cb4-10" tabindex="-1"></a><span class="co">#       eq(0)$And(qa$bitwiseAnd(cirrusBitMask)$eq(0));</span></span>
<span id="cb4-11"><a href="data-collection-wrangling.html#cb4-11" tabindex="-1"></a><span class="co">#     return(image$updateMask(mask_data)$divide(10000))</span></span>
<span id="cb4-12"><a href="data-collection-wrangling.html#cb4-12" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb4-13"><a href="data-collection-wrangling.html#cb4-13" tabindex="-1"></a><span class="co"># ## 2) Function to obatin GCVI ##</span></span>
<span id="cb4-14"><a href="data-collection-wrangling.html#cb4-14" tabindex="-1"></a><span class="co"># getindex_GCVI &lt;- function(image) {</span></span>
<span id="cb4-15"><a href="data-collection-wrangling.html#cb4-15" tabindex="-1"></a><span class="co">#   #Index &lt;- image$normalizedDifference(c(“B8”, “B4&quot;))$rename(‘Index’)</span></span>
<span id="cb4-16"><a href="data-collection-wrangling.html#cb4-16" tabindex="-1"></a><span class="co">#   Index &lt;- image$expression(</span></span>
<span id="cb4-17"><a href="data-collection-wrangling.html#cb4-17" tabindex="-1"></a><span class="co">#   expression = “(NIR/GREEN)-1”,</span></span>
<span id="cb4-18"><a href="data-collection-wrangling.html#cb4-18" tabindex="-1"></a><span class="co">#   opt_map =  list(</span></span>
<span id="cb4-19"><a href="data-collection-wrangling.html#cb4-19" tabindex="-1"></a><span class="co">#     “NIR” = image$select(“B8”),</span></span>
<span id="cb4-20"><a href="data-collection-wrangling.html#cb4-20" tabindex="-1"></a><span class="co">#     “GREEN” = image$select(“B3”)</span></span>
<span id="cb4-21"><a href="data-collection-wrangling.html#cb4-21" tabindex="-1"></a><span class="co">#    )</span></span>
<span id="cb4-22"><a href="data-collection-wrangling.html#cb4-22" tabindex="-1"></a><span class="co">#   )$rename(“Index”)</span></span>
<span id="cb4-23"><a href="data-collection-wrangling.html#cb4-23" tabindex="-1"></a><span class="co">#   return(image$addBands(Index))</span></span>
<span id="cb4-24"><a href="data-collection-wrangling.html#cb4-24" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
</div>
<div id="field-identification" class="section level3 hasAnchor" number="2.1.2">
<h3><span class="header-section-number">2.1.2</span> Field identification<a href="data-collection-wrangling.html#field-identification" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this step, it’s essential to specify the field identification because the code is designed to automatically run across different fields. By defining the specific field at this stage, you ensure that the correct data is selected for analysis. This setup allows for a streamlined and efficient workflow, enabling the code to process data for multiple fields as needed.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="data-collection-wrangling.html#cb5-1" tabindex="-1"></a><span class="co">#FARM_NAME = &quot;...&quot;</span></span></code></pre></div>
</div>
<div id="gcvi-peak-detection" class="section level3 hasAnchor" number="2.1.3">
<h3><span class="header-section-number">2.1.3</span> GCVI Peak detection<a href="data-collection-wrangling.html#gcvi-peak-detection" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Obtain the path to the field polygon/boundary.</strong></p>
<p>This step is crucial because it ensures that only the satellite image specific to the field is used.</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="data-collection-wrangling.html#cb6-1" tabindex="-1"></a><span class="do">## 1. Create the polygons path ##</span></span>
<span id="cb6-2"><a href="data-collection-wrangling.html#cb6-2" tabindex="-1"></a><span class="co"># Path_polygon &lt;- data.frame(</span></span>
<span id="cb6-3"><a href="data-collection-wrangling.html#cb6-3" tabindex="-1"></a><span class="co">#   path = list.files(&quot;../1_Data/1_Polygon&quot;,</span></span>
<span id="cb6-4"><a href="data-collection-wrangling.html#cb6-4" tabindex="-1"></a><span class="co">#                     pattern = &quot;.shp&quot;, full.names = T, recursive = T)) %&gt;%</span></span>
<span id="cb6-5"><a href="data-collection-wrangling.html#cb6-5" tabindex="-1"></a><span class="co">#   mutate(path2 = path) %&gt;%</span></span>
<span id="cb6-6"><a href="data-collection-wrangling.html#cb6-6" tabindex="-1"></a><span class="co">#   separate(path2, into = c(&quot;..&quot;,&quot;Data_file&quot;,&quot;Polygon&quot;,&quot;Farm&quot;), sep = &quot;/&quot;) %&gt;%</span></span>
<span id="cb6-7"><a href="data-collection-wrangling.html#cb6-7" tabindex="-1"></a><span class="co">#   mutate(Farm = str_replace(Farm, &quot;_pol.shp&quot;, &quot;&quot;)) %&gt;%</span></span>
<span id="cb6-8"><a href="data-collection-wrangling.html#cb6-8" tabindex="-1"></a><span class="co">#   dplyr::select(path, Farm) %&gt;%</span></span>
<span id="cb6-9"><a href="data-collection-wrangling.html#cb6-9" tabindex="-1"></a><span class="co">#   #remove the filter if you want to run all farms</span></span>
<span id="cb6-10"><a href="data-collection-wrangling.html#cb6-10" tabindex="-1"></a><span class="co">#   dplyr::filter(Farm == FARM_NAME)</span></span></code></pre></div>
<p><strong>Obtain GCVI peak serie</strong></p>
<p>For this study, remote sensing data was sourced from the Sentinel-2 satellite dataset.
More details can be found here: <a href="https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR_HARMONIZED#description" class="uri">https://developers.google.com/earth-engine/datasets/catalog/COPERNICUS_S2_SR_HARMONIZED#description</a>
Identify the peak moment of the Green Chlorophyll Vegetation Index (GCVI) for the entire field. Then, determine a range of days around this peak, as well as separate ranges of days around the dates that are 30 days before and 30 days after the peak.
This approach allows us to select three key images during the crop growing season. The use of these ranges is necessary because it’s not always possible to obtain a clear image (with less than 2% cloud cover) on specific days, so having a broader window increases the chances of finding a suitable image.</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="data-collection-wrangling.html#cb7-1" tabindex="-1"></a><span class="co"># for (file in 1:nrow(Path_polygon)){</span></span>
<span id="cb7-2"><a href="data-collection-wrangling.html#cb7-2" tabindex="-1"></a><span class="co">#   ## 1. Defining AOI, boundary, and sample points for all the fields ##</span></span>
<span id="cb7-3"><a href="data-collection-wrangling.html#cb7-3" tabindex="-1"></a><span class="co">#   AOI &lt;- sf::st_read(dsn = Path_polygon[file, 1],</span></span>
<span id="cb7-4"><a href="data-collection-wrangling.html#cb7-4" tabindex="-1"></a><span class="co">#                      stringsAsFactors = F, quiet = F) %&gt;%</span></span>
<span id="cb7-5"><a href="data-collection-wrangling.html#cb7-5" tabindex="-1"></a><span class="co">#     sf::st_geometry() %&gt;%</span></span>
<span id="cb7-6"><a href="data-collection-wrangling.html#cb7-6" tabindex="-1"></a><span class="co">#     st_cast(&quot;MULTIPOLYGON&quot;) %&gt;%</span></span>
<span id="cb7-7"><a href="data-collection-wrangling.html#cb7-7" tabindex="-1"></a><span class="co">#     st_zm(drop = TRUE) %&gt;%</span></span>
<span id="cb7-8"><a href="data-collection-wrangling.html#cb7-8" tabindex="-1"></a><span class="co">#     sf_as_ee()</span></span>
<span id="cb7-9"><a href="data-collection-wrangling.html#cb7-9" tabindex="-1"></a><span class="co">#   ## 2. Retrieve Spatial layer ##</span></span>
<span id="cb7-10"><a href="data-collection-wrangling.html#cb7-10" tabindex="-1"></a><span class="co">#   </span><span class="al">###</span><span class="co"> 2.1. Extracting the bands</span></span>
<span id="cb7-11"><a href="data-collection-wrangling.html#cb7-11" tabindex="-1"></a><span class="co">#   s2bands &lt;- ee$ImageCollection(&quot;COPERNICUS/S2_HARMONIZED&quot;)$</span></span>
<span id="cb7-12"><a href="data-collection-wrangling.html#cb7-12" tabindex="-1"></a><span class="co">#     filterBounds(AOI)$</span></span>
<span id="cb7-13"><a href="data-collection-wrangling.html#cb7-13" tabindex="-1"></a><span class="co">#     # Period that we want:</span></span>
<span id="cb7-14"><a href="data-collection-wrangling.html#cb7-14" tabindex="-1"></a><span class="co">#     filterDate(&quot;2017-01-01&quot;,&quot;2024-01-01&quot;)$</span></span>
<span id="cb7-15"><a href="data-collection-wrangling.html#cb7-15" tabindex="-1"></a><span class="co">#     # Filter the images with more than 5% clouds:</span></span>
<span id="cb7-16"><a href="data-collection-wrangling.html#cb7-16" tabindex="-1"></a><span class="co">#     filter(ee$Filter$lt(&quot;CLOUDY_PIXEL_PERCENTAGE&quot;, 3))$</span></span>
<span id="cb7-17"><a href="data-collection-wrangling.html#cb7-17" tabindex="-1"></a><span class="co">#     map(maskS2clouds)$</span></span>
<span id="cb7-18"><a href="data-collection-wrangling.html#cb7-18" tabindex="-1"></a><span class="co">#     map(function(x){</span></span>
<span id="cb7-19"><a href="data-collection-wrangling.html#cb7-19" tabindex="-1"></a><span class="co">#     date &lt;- ee$Date(&quot;x$get(system:time_start&quot;))$format(&quot;YYYY_MM_dd&quot;)</span></span>
<span id="cb7-20"><a href="data-collection-wrangling.html#cb7-20" tabindex="-1"></a><span class="co">#     # Bands that we want:</span></span>
<span id="cb7-21"><a href="data-collection-wrangling.html#cb7-21" tabindex="-1"></a><span class="co">#     x$select(&quot;B2&quot;,&quot;B3&quot;,&quot;B4&quot;,&quot;B8&quot;) })</span></span>
<span id="cb7-22"><a href="data-collection-wrangling.html#cb7-22" tabindex="-1"></a><span class="co">#   </span><span class="al">###</span><span class="co"> 2.2. Extracting the data points to a data frame</span></span>
<span id="cb7-23"><a href="data-collection-wrangling.html#cb7-23" tabindex="-1"></a><span class="co">#   s2extraction &lt;- ee_extract(</span></span>
<span id="cb7-24"><a href="data-collection-wrangling.html#cb7-24" tabindex="-1"></a><span class="co">#     x = s2bands,</span></span>
<span id="cb7-25"><a href="data-collection-wrangling.html#cb7-25" tabindex="-1"></a><span class="co">#     y = AOI,</span></span>
<span id="cb7-26"><a href="data-collection-wrangling.html#cb7-26" tabindex="-1"></a><span class="co">#     scale = 10,</span></span>
<span id="cb7-27"><a href="data-collection-wrangling.html#cb7-27" tabindex="-1"></a><span class="co">#     fun = ee$Reducer$median(),</span></span>
<span id="cb7-28"><a href="data-collection-wrangling.html#cb7-28" tabindex="-1"></a><span class="co">#     sf = FALSE ) %&gt;%</span></span>
<span id="cb7-29"><a href="data-collection-wrangling.html#cb7-29" tabindex="-1"></a><span class="co">#     t() %&gt;%</span></span>
<span id="cb7-30"><a href="data-collection-wrangling.html#cb7-30" tabindex="-1"></a><span class="co">#     as.data.frame() %&gt;%</span></span>
<span id="cb7-31"><a href="data-collection-wrangling.html#cb7-31" tabindex="-1"></a><span class="co">#     rownames_to_column() %&gt;%</span></span>
<span id="cb7-32"><a href="data-collection-wrangling.html#cb7-32" tabindex="-1"></a><span class="co">#     separate(rowname, c(&quot;datet1&quot;, &quot;datet2&quot;, &quot;check&quot;, &quot;band&quot;), sep = &quot;_&quot;)</span></span>
<span id="cb7-33"><a href="data-collection-wrangling.html#cb7-33" tabindex="-1"></a><span class="co">#   </span><span class="al">###</span><span class="co"> 4.3. Index calculation</span></span>
<span id="cb7-34"><a href="data-collection-wrangling.html#cb7-34" tabindex="-1"></a><span class="co">#   s2extraction &lt;- s2extraction %&gt;%</span></span>
<span id="cb7-35"><a href="data-collection-wrangling.html#cb7-35" tabindex="-1"></a><span class="co">#     pivot_longer(cols = !c(datet1, datet2, check, band),</span></span>
<span id="cb7-36"><a href="data-collection-wrangling.html#cb7-36" tabindex="-1"></a><span class="co">#                  names_to = &quot;point_id&quot;,</span></span>
<span id="cb7-37"><a href="data-collection-wrangling.html#cb7-37" tabindex="-1"></a><span class="co">#                  values_to = &quot;values&quot;) %&gt;%</span></span>
<span id="cb7-38"><a href="data-collection-wrangling.html#cb7-38" tabindex="-1"></a><span class="co">#     pivot_wider(names_from = band,</span></span>
<span id="cb7-39"><a href="data-collection-wrangling.html#cb7-39" tabindex="-1"></a><span class="co">#                 values_from =  values ) %&gt;%</span></span>
<span id="cb7-40"><a href="data-collection-wrangling.html#cb7-40" tabindex="-1"></a><span class="co">#     dplyr::select(&quot;datet1&quot;, &quot;point_id&quot;,&quot;B2&quot;,&quot;B3&quot;,&quot;B4&quot;,&quot;B8&quot;) %&gt;%</span></span>
<span id="cb7-41"><a href="data-collection-wrangling.html#cb7-41" tabindex="-1"></a><span class="co">#     mutate(B2 = as.numeric(unlist(B2)),</span></span>
<span id="cb7-42"><a href="data-collection-wrangling.html#cb7-42" tabindex="-1"></a><span class="co">#            B3 = as.numeric(unlist(B3)),</span></span>
<span id="cb7-43"><a href="data-collection-wrangling.html#cb7-43" tabindex="-1"></a><span class="co">#            B4 = as.numeric(unlist(B4)),</span></span>
<span id="cb7-44"><a href="data-collection-wrangling.html#cb7-44" tabindex="-1"></a><span class="co">#            B8 = as.numeric(unlist(B8)),</span></span>
<span id="cb7-45"><a href="data-collection-wrangling.html#cb7-45" tabindex="-1"></a><span class="co">#            GCVI = (B8 / B3)-1)</span></span>
<span id="cb7-46"><a href="data-collection-wrangling.html#cb7-46" tabindex="-1"></a><span class="co">#   </span><span class="al">###</span><span class="co"> 2.4. Data wrangling</span></span>
<span id="cb7-47"><a href="data-collection-wrangling.html#cb7-47" tabindex="-1"></a><span class="co">#   s2datapoints &lt;- s2extraction %&gt;%</span></span>
<span id="cb7-48"><a href="data-collection-wrangling.html#cb7-48" tabindex="-1"></a><span class="co">#     mutate(date = str_replace(datet1, &quot;X&quot;, &quot;&quot;)) %&gt;%</span></span>
<span id="cb7-49"><a href="data-collection-wrangling.html#cb7-49" tabindex="-1"></a><span class="co">#     separate(date, into=c(&quot;asdate&quot;, &quot;remove&quot;), sep=&quot;T1&quot;) %&gt;%</span></span>
<span id="cb7-50"><a href="data-collection-wrangling.html#cb7-50" tabindex="-1"></a><span class="co">#     mutate(DATE = ymd(asdate)) %&gt;%</span></span>
<span id="cb7-51"><a href="data-collection-wrangling.html#cb7-51" tabindex="-1"></a><span class="co">#     rename(date = DATE) %&gt;%</span></span>
<span id="cb7-52"><a href="data-collection-wrangling.html#cb7-52" tabindex="-1"></a><span class="co">#     dplyr::select(point_id, GCVI, NDVI,EVI,date)  %&gt;%</span></span>
<span id="cb7-53"><a href="data-collection-wrangling.html#cb7-53" tabindex="-1"></a><span class="co">#     mutate(Year=year(date),</span></span>
<span id="cb7-54"><a href="data-collection-wrangling.html#cb7-54" tabindex="-1"></a><span class="co">#            Farm = Path_polygon[file, 2]) %&gt;%</span></span>
<span id="cb7-55"><a href="data-collection-wrangling.html#cb7-55" tabindex="-1"></a><span class="co">#     dplyr::filter(GCVI&gt;=0)</span></span>
<span id="cb7-56"><a href="data-collection-wrangling.html#cb7-56" tabindex="-1"></a><span class="co">#   </span><span class="al">###</span><span class="co"> 2.5. Peaks GCVI in each year</span></span>
<span id="cb7-57"><a href="data-collection-wrangling.html#cb7-57" tabindex="-1"></a><span class="co">#   sm_maxGCVI &lt;- s2datapoints %&gt;%</span></span>
<span id="cb7-58"><a href="data-collection-wrangling.html#cb7-58" tabindex="-1"></a><span class="co">#     na.exclude() %&gt;%</span></span>
<span id="cb7-59"><a href="data-collection-wrangling.html#cb7-59" tabindex="-1"></a><span class="co">#     group_by(Year) %&gt;%</span></span>
<span id="cb7-60"><a href="data-collection-wrangling.html#cb7-60" tabindex="-1"></a><span class="co">#     ## Fit a polynomial to detect the GCVI peak</span></span>
<span id="cb7-61"><a href="data-collection-wrangling.html#cb7-61" tabindex="-1"></a><span class="co">#     mutate(smooth =stats::predict(stats::loess(GCVI~as.numeric(date),</span></span>
<span id="cb7-62"><a href="data-collection-wrangling.html#cb7-62" tabindex="-1"></a><span class="co">#                                                span=.3))) %&gt;%</span></span>
<span id="cb7-63"><a href="data-collection-wrangling.html#cb7-63" tabindex="-1"></a><span class="co">#     slice_max(order_by = smooth) %&gt;%</span></span>
<span id="cb7-64"><a href="data-collection-wrangling.html#cb7-64" tabindex="-1"></a><span class="co">#     mutate(date_b30 = date - 30,</span></span>
<span id="cb7-65"><a href="data-collection-wrangling.html#cb7-65" tabindex="-1"></a><span class="co">#            lb_day_b30 = date_b30 - days(15),</span></span>
<span id="cb7-66"><a href="data-collection-wrangling.html#cb7-66" tabindex="-1"></a><span class="co">#            up_day_b30 = date_b30 + days(15),</span></span>
<span id="cb7-67"><a href="data-collection-wrangling.html#cb7-67" tabindex="-1"></a><span class="co">#            lb_day = date - days(15),</span></span>
<span id="cb7-68"><a href="data-collection-wrangling.html#cb7-68" tabindex="-1"></a><span class="co">#            up_day = date + days(15),</span></span>
<span id="cb7-69"><a href="data-collection-wrangling.html#cb7-69" tabindex="-1"></a><span class="co">#            date_30 = date + 30,</span></span>
<span id="cb7-70"><a href="data-collection-wrangling.html#cb7-70" tabindex="-1"></a><span class="co">#            lb_day_30 = date_30 - days(15),</span></span>
<span id="cb7-71"><a href="data-collection-wrangling.html#cb7-71" tabindex="-1"></a><span class="co">#            up_day_30 = date_30 + days(15)) %&gt;%</span></span>
<span id="cb7-72"><a href="data-collection-wrangling.html#cb7-72" tabindex="-1"></a><span class="co">#     distinct(date, .keep_all = TRUE)</span></span>
<span id="cb7-73"><a href="data-collection-wrangling.html#cb7-73" tabindex="-1"></a><span class="co">#   write.csv(sm_maxGCVI,</span></span>
<span id="cb7-74"><a href="data-collection-wrangling.html#cb7-74" tabindex="-1"></a><span class="co">#             paste0(&quot;../1_Data/2_Spatial_Layer/1_TS_peak/peak_diff_moments/&quot;,</span></span>
<span id="cb7-75"><a href="data-collection-wrangling.html#cb7-75" tabindex="-1"></a><span class="co">#                    Path_polygon[file,2],&quot;_GCVI.csv&quot;), row.names = F)</span></span>
<span id="cb7-76"><a href="data-collection-wrangling.html#cb7-76" tabindex="-1"></a><span class="co">#   ts_gcvi &lt;- s2datapoints %&gt;%</span></span>
<span id="cb7-77"><a href="data-collection-wrangling.html#cb7-77" tabindex="-1"></a><span class="co">#       ggplot(aes(x = date, y = GCVI)) +</span></span>
<span id="cb7-78"><a href="data-collection-wrangling.html#cb7-78" tabindex="-1"></a><span class="co">#       geom_point() +</span></span>
<span id="cb7-79"><a href="data-collection-wrangling.html#cb7-79" tabindex="-1"></a><span class="co">#       geom_smooth(span=.07, color = &quot;#52796F&quot;) +</span></span>
<span id="cb7-80"><a href="data-collection-wrangling.html#cb7-80" tabindex="-1"></a><span class="co">#       geom_point(data=sm_maxGCVI, aes(y=smooth),shape = 21, alpha=.7,</span></span>
<span id="cb7-81"><a href="data-collection-wrangling.html#cb7-81" tabindex="-1"></a><span class="co">#                  color=&quot;grey25&quot;, size=2.5, fill = &quot;#9B2226&quot;) +</span></span>
<span id="cb7-82"><a href="data-collection-wrangling.html#cb7-82" tabindex="-1"></a><span class="co">#       scale_x_date(date_breaks = &quot;1 year&quot;, date_labels = &quot;%Y&quot;)+</span></span>
<span id="cb7-83"><a href="data-collection-wrangling.html#cb7-83" tabindex="-1"></a><span class="co">#       theme_bw()</span></span>
<span id="cb7-84"><a href="data-collection-wrangling.html#cb7-84" tabindex="-1"></a><span class="co">#   ggsave(paste0(&quot;../3_Output/1_Spat_layer/TimeSerie/&quot;, FARM_NAME, &quot;_GCVI.png&quot;),</span></span>
<span id="cb7-85"><a href="data-collection-wrangling.html#cb7-85" tabindex="-1"></a><span class="co">#          height = 4, width = 5)</span></span>
<span id="cb7-86"><a href="data-collection-wrangling.html#cb7-86" tabindex="-1"></a><span class="co"># }</span></span></code></pre></div>
</div>
<div id="gcvi-at-pixel-level-within-field" class="section level3 hasAnchor" number="2.1.4">
<h3><span class="header-section-number">2.1.4</span> GCVI at pixel level within field<a href="data-collection-wrangling.html#gcvi-at-pixel-level-within-field" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Upload peak serie file path</strong></p>
<p>Upload the peak serie .csv file created in the steps before.</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="data-collection-wrangling.html#cb8-1" tabindex="-1"></a><span class="co"># path_peak &lt;- data.frame(</span></span>
<span id="cb8-2"><a href="data-collection-wrangling.html#cb8-2" tabindex="-1"></a><span class="co">#   pathGCVI = list.files(&quot;../1_Data/2_Spatial_Layer/1_TS_peak/peak_diff_moments&quot;,</span></span>
<span id="cb8-3"><a href="data-collection-wrangling.html#cb8-3" tabindex="-1"></a><span class="co">#                         full.names =T,pattern =&quot;_GCVI.csv&quot;,recursive =T)) %&gt;%</span></span>
<span id="cb8-4"><a href="data-collection-wrangling.html#cb8-4" tabindex="-1"></a><span class="co">#   mutate(path = pathGCVI) %&gt;%</span></span>
<span id="cb8-5"><a href="data-collection-wrangling.html#cb8-5" tabindex="-1"></a><span class="co">#   separate(path, into = c(&quot;del&quot;, &quot;del1&quot; ,&quot;del2&quot;, &quot;del3&quot;, &quot;del4&quot;,&quot;Farm&quot;),</span></span>
<span id="cb8-6"><a href="data-collection-wrangling.html#cb8-6" tabindex="-1"></a><span class="co">#            sep = &quot;/&quot;) %&gt;%</span></span>
<span id="cb8-7"><a href="data-collection-wrangling.html#cb8-7" tabindex="-1"></a><span class="co">#   mutate(Farm = str_replace(Farm, &quot;_GCVI.csv&quot;, &quot;&quot;),</span></span>
<span id="cb8-8"><a href="data-collection-wrangling.html#cb8-8" tabindex="-1"></a><span class="co">#          Path_polygon = paste0(&quot;../1_Data/1_Polygon/&quot;, Farm, &quot;_pol.shp&quot;)) %&gt;%</span></span>
<span id="cb8-9"><a href="data-collection-wrangling.html#cb8-9" tabindex="-1"></a><span class="co">#   dplyr::select(-starts_with(&quot;del&quot;)) %&gt;%</span></span>
<span id="cb8-10"><a href="data-collection-wrangling.html#cb8-10" tabindex="-1"></a><span class="co">#   dplyr::filter(Farm == FARM_NAME)</span></span></code></pre></div>
<p><strong>Obtain GCVI at pixel level within the field</strong></p>
<p>For each year, starting from 2017 (the start of Sentinel-2 data availability), images with less than 2% clouds were obtained for three specific periods: around the GCVI peak, 30 days before the peak, and 30 days after the peak. These images have a pixel resolution of 10 m x 10 m. Additionally, the GCVI was calculated for each of these periods.</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="data-collection-wrangling.html#cb9-1" tabindex="-1"></a><span class="co"># ## Peak moment ##</span></span>
<span id="cb9-2"><a href="data-collection-wrangling.html#cb9-2" tabindex="-1"></a><span class="co"># Year &lt;- c(2017,2018,2019,2020,2021,2022,2023)</span></span>
<span id="cb9-3"><a href="data-collection-wrangling.html#cb9-3" tabindex="-1"></a><span class="co"># for (file in 1:nrow(path_peak)){</span></span>
<span id="cb9-4"><a href="data-collection-wrangling.html#cb9-4" tabindex="-1"></a><span class="co">#   AOI &lt;- sf::st_read(dsn = path_peak[file, 3], # polygon</span></span>
<span id="cb9-5"><a href="data-collection-wrangling.html#cb9-5" tabindex="-1"></a><span class="co">#                      stringsAsFactors = F,</span></span>
<span id="cb9-6"><a href="data-collection-wrangling.html#cb9-6" tabindex="-1"></a><span class="co">#                      quiet = F) %&gt;%</span></span>
<span id="cb9-7"><a href="data-collection-wrangling.html#cb9-7" tabindex="-1"></a><span class="co">#     sf::st_geometry() %&gt;%</span></span>
<span id="cb9-8"><a href="data-collection-wrangling.html#cb9-8" tabindex="-1"></a><span class="co">#     st_cast(&quot;MULTIPOLYGON&quot;) %&gt;%</span></span>
<span id="cb9-9"><a href="data-collection-wrangling.html#cb9-9" tabindex="-1"></a><span class="co">#     st_zm(drop = TRUE) %&gt;%</span></span>
<span id="cb9-10"><a href="data-collection-wrangling.html#cb9-10" tabindex="-1"></a><span class="co">#     sf_as_ee()</span></span>
<span id="cb9-11"><a href="data-collection-wrangling.html#cb9-11" tabindex="-1"></a><span class="co">#   for (y in Year){</span></span>
<span id="cb9-12"><a href="data-collection-wrangling.html#cb9-12" tabindex="-1"></a><span class="co">#     peak &lt;- read.csv(path_peak[file, 1]) %&gt;%</span></span>
<span id="cb9-13"><a href="data-collection-wrangling.html#cb9-13" tabindex="-1"></a><span class="co">#       dplyr::filter(Year==y)</span></span>
<span id="cb9-14"><a href="data-collection-wrangling.html#cb9-14" tabindex="-1"></a><span class="co">#     s2 &lt;- ee$ImageCollection(&quot;COPERNICUS/S2_HARMONIZED&quot;)$</span></span>
<span id="cb9-15"><a href="data-collection-wrangling.html#cb9-15" tabindex="-1"></a><span class="co">#       filterBounds(AOI)$</span></span>
<span id="cb9-16"><a href="data-collection-wrangling.html#cb9-16" tabindex="-1"></a><span class="co">#       filterDate(as.character(peak$lb_day),</span></span>
<span id="cb9-17"><a href="data-collection-wrangling.html#cb9-17" tabindex="-1"></a><span class="co">#                  as.character(peak$up_day))$</span></span>
<span id="cb9-18"><a href="data-collection-wrangling.html#cb9-18" tabindex="-1"></a><span class="co">#       filter(ee$Filter$lt(&quot;CLOUDY_PIXEL_PERCENTAGE&quot;, 2))$</span></span>
<span id="cb9-19"><a href="data-collection-wrangling.html#cb9-19" tabindex="-1"></a><span class="co">#       map(maskS2clouds)$map(getindex_GCVI)$select(&quot;Index&quot;)$median()</span></span>
<span id="cb9-20"><a href="data-collection-wrangling.html#cb9-20" tabindex="-1"></a><span class="co">#     s2_im &lt;- ee$Image(s2)$</span></span>
<span id="cb9-21"><a href="data-collection-wrangling.html#cb9-21" tabindex="-1"></a><span class="co">#       clip(AOI)</span></span>
<span id="cb9-22"><a href="data-collection-wrangling.html#cb9-22" tabindex="-1"></a><span class="co">#     s2_raster &lt;- ee_as_rast(s2_im,</span></span>
<span id="cb9-23"><a href="data-collection-wrangling.html#cb9-23" tabindex="-1"></a><span class="co">#                             region = AOI,</span></span>
<span id="cb9-24"><a href="data-collection-wrangling.html#cb9-24" tabindex="-1"></a><span class="co">#                             via = &quot;getDownloadURL&quot;,</span></span>
<span id="cb9-25"><a href="data-collection-wrangling.html#cb9-25" tabindex="-1"></a><span class="co">#                             dsn = paste0(&quot;../1_Data/2_Spatial_Layer/2_VI_raster/Peak/p2/&quot;,</span></span>
<span id="cb9-26"><a href="data-collection-wrangling.html#cb9-26" tabindex="-1"></a><span class="co">#                                          path_peak[file, 2],&quot;_&quot;,y,&quot;_GCVI.tif&quot;),</span></span>
<span id="cb9-27"><a href="data-collection-wrangling.html#cb9-27" tabindex="-1"></a><span class="co">#                             scale = 10)</span></span>
<span id="cb9-28"><a href="data-collection-wrangling.html#cb9-28" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb9-29"><a href="data-collection-wrangling.html#cb9-29" tabindex="-1"></a><span class="co">#   }</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="data-collection-wrangling.html#cb10-1" tabindex="-1"></a><span class="co"># ## Peak - 30 days moment##</span></span>
<span id="cb10-2"><a href="data-collection-wrangling.html#cb10-2" tabindex="-1"></a><span class="co"># Year &lt;- c(2017,2018,2019,2020,2021,2022,2023)</span></span>
<span id="cb10-3"><a href="data-collection-wrangling.html#cb10-3" tabindex="-1"></a><span class="co"># for (file in 1:nrow(path_peak)){</span></span>
<span id="cb10-4"><a href="data-collection-wrangling.html#cb10-4" tabindex="-1"></a><span class="co">#   AOI &lt;- sf::st_read(dsn = path_peak[file, 3], # polygon</span></span>
<span id="cb10-5"><a href="data-collection-wrangling.html#cb10-5" tabindex="-1"></a><span class="co">#                      stringsAsFactors = F,</span></span>
<span id="cb10-6"><a href="data-collection-wrangling.html#cb10-6" tabindex="-1"></a><span class="co">#                      quiet = F) %&gt;%</span></span>
<span id="cb10-7"><a href="data-collection-wrangling.html#cb10-7" tabindex="-1"></a><span class="co">#     sf::st_geometry() %&gt;%</span></span>
<span id="cb10-8"><a href="data-collection-wrangling.html#cb10-8" tabindex="-1"></a><span class="co">#     st_cast(&quot;MULTIPOLYGON&quot;) %&gt;%</span></span>
<span id="cb10-9"><a href="data-collection-wrangling.html#cb10-9" tabindex="-1"></a><span class="co">#     st_zm(drop = TRUE) %&gt;%</span></span>
<span id="cb10-10"><a href="data-collection-wrangling.html#cb10-10" tabindex="-1"></a><span class="co">#     sf_as_ee()</span></span>
<span id="cb10-11"><a href="data-collection-wrangling.html#cb10-11" tabindex="-1"></a><span class="co">#   for (y in Year){</span></span>
<span id="cb10-12"><a href="data-collection-wrangling.html#cb10-12" tabindex="-1"></a><span class="co">#     peak &lt;- read.csv(path_peak[file, 1]) %&gt;%</span></span>
<span id="cb10-13"><a href="data-collection-wrangling.html#cb10-13" tabindex="-1"></a><span class="co">#       dplyr::filter(Year==y)</span></span>
<span id="cb10-14"><a href="data-collection-wrangling.html#cb10-14" tabindex="-1"></a><span class="co">#     s2 &lt;- ee$ImageCollection(&quot;COPERNICUS/S2_HARMONIZED&quot;)$</span></span>
<span id="cb10-15"><a href="data-collection-wrangling.html#cb10-15" tabindex="-1"></a><span class="co">#       filterBounds(AOI)$</span></span>
<span id="cb10-16"><a href="data-collection-wrangling.html#cb10-16" tabindex="-1"></a><span class="co">#       filterDate(as.character(peak$lb_day_b30),</span></span>
<span id="cb10-17"><a href="data-collection-wrangling.html#cb10-17" tabindex="-1"></a><span class="co">#                  as.character(peak$up_day_b30))$</span></span>
<span id="cb10-18"><a href="data-collection-wrangling.html#cb10-18" tabindex="-1"></a><span class="co">#       filter(ee$Filter$lt(&quot;CLOUDY_PIXEL_PERCENTAGE&quot;, 2))$</span></span>
<span id="cb10-19"><a href="data-collection-wrangling.html#cb10-19" tabindex="-1"></a><span class="co">#       map(maskS2clouds)$map(getindex_GCVI)$select(&quot;Index&quot;)$median()</span></span>
<span id="cb10-20"><a href="data-collection-wrangling.html#cb10-20" tabindex="-1"></a><span class="co">#     s2_im &lt;- ee$Image(s2)$</span></span>
<span id="cb10-21"><a href="data-collection-wrangling.html#cb10-21" tabindex="-1"></a><span class="co">#       clip(AOI)</span></span>
<span id="cb10-22"><a href="data-collection-wrangling.html#cb10-22" tabindex="-1"></a><span class="co">#     s2_raster &lt;- ee_as_rast(s2_im,</span></span>
<span id="cb10-23"><a href="data-collection-wrangling.html#cb10-23" tabindex="-1"></a><span class="co">#                             region = AOI,</span></span>
<span id="cb10-24"><a href="data-collection-wrangling.html#cb10-24" tabindex="-1"></a><span class="co">#                             via = &quot;getDownloadURL&quot;,</span></span>
<span id="cb10-25"><a href="data-collection-wrangling.html#cb10-25" tabindex="-1"></a><span class="co">#                             dsn = paste0(</span></span>
<span id="cb10-26"><a href="data-collection-wrangling.html#cb10-26" tabindex="-1"></a><span class="co">#                               &quot;../1_Data/2_Spatial_Layer/2_VI_raster/Peak_b30/p_b30/&quot;,</span></span>
<span id="cb10-27"><a href="data-collection-wrangling.html#cb10-27" tabindex="-1"></a><span class="co">#                               path_peak[file, 2],&quot;_&quot;,y,&quot;_GCVI.tif&quot;),</span></span>
<span id="cb10-28"><a href="data-collection-wrangling.html#cb10-28" tabindex="-1"></a><span class="co">#                             scale = 10)</span></span>
<span id="cb10-29"><a href="data-collection-wrangling.html#cb10-29" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb10-30"><a href="data-collection-wrangling.html#cb10-30" tabindex="-1"></a><span class="co">#   }</span></span></code></pre></div>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="data-collection-wrangling.html#cb11-1" tabindex="-1"></a><span class="co"># ## Peak - 30 days moment##</span></span>
<span id="cb11-2"><a href="data-collection-wrangling.html#cb11-2" tabindex="-1"></a><span class="co"># Year &lt;- c(2017,2018,2019,2020,2021,2022,2023)</span></span>
<span id="cb11-3"><a href="data-collection-wrangling.html#cb11-3" tabindex="-1"></a><span class="co"># for (file in 1:nrow(path_peak)){</span></span>
<span id="cb11-4"><a href="data-collection-wrangling.html#cb11-4" tabindex="-1"></a><span class="co">#   AOI &lt;- sf::st_read(dsn = path_peak[file, 3], # polygon</span></span>
<span id="cb11-5"><a href="data-collection-wrangling.html#cb11-5" tabindex="-1"></a><span class="co">#                      stringsAsFactors = F,</span></span>
<span id="cb11-6"><a href="data-collection-wrangling.html#cb11-6" tabindex="-1"></a><span class="co">#                      quiet = F) %&gt;%</span></span>
<span id="cb11-7"><a href="data-collection-wrangling.html#cb11-7" tabindex="-1"></a><span class="co">#     sf::st_geometry() %&gt;%</span></span>
<span id="cb11-8"><a href="data-collection-wrangling.html#cb11-8" tabindex="-1"></a><span class="co">#     st_cast(&quot;MULTIPOLYGON&quot;) %&gt;%</span></span>
<span id="cb11-9"><a href="data-collection-wrangling.html#cb11-9" tabindex="-1"></a><span class="co">#     st_zm(drop = TRUE) %&gt;%</span></span>
<span id="cb11-10"><a href="data-collection-wrangling.html#cb11-10" tabindex="-1"></a><span class="co">#     sf_as_ee()</span></span>
<span id="cb11-11"><a href="data-collection-wrangling.html#cb11-11" tabindex="-1"></a><span class="co">#   for (y in Year){</span></span>
<span id="cb11-12"><a href="data-collection-wrangling.html#cb11-12" tabindex="-1"></a><span class="co">#     peak &lt;- read.csv(path_peak[file, 1]) %&gt;%</span></span>
<span id="cb11-13"><a href="data-collection-wrangling.html#cb11-13" tabindex="-1"></a><span class="co">#       dplyr::filter(Year==y)</span></span>
<span id="cb11-14"><a href="data-collection-wrangling.html#cb11-14" tabindex="-1"></a><span class="co">#     s2 &lt;- ee$ImageCollection(&quot;COPERNICUS/S2_HARMONIZED&quot;)$</span></span>
<span id="cb11-15"><a href="data-collection-wrangling.html#cb11-15" tabindex="-1"></a><span class="co">#       filterBounds(AOI)$</span></span>
<span id="cb11-16"><a href="data-collection-wrangling.html#cb11-16" tabindex="-1"></a><span class="co">#       filterDate(as.character(peak$lb_day_30),</span></span>
<span id="cb11-17"><a href="data-collection-wrangling.html#cb11-17" tabindex="-1"></a><span class="co">#                  as.character(peak$up_day_30))$</span></span>
<span id="cb11-18"><a href="data-collection-wrangling.html#cb11-18" tabindex="-1"></a><span class="co">#       filter(ee$Filter$lt(&quot;CLOUDY_PIXEL_PERCENTAGE&quot;, 2))$</span></span>
<span id="cb11-19"><a href="data-collection-wrangling.html#cb11-19" tabindex="-1"></a><span class="co">#       map(maskS2clouds)$map(getindex_GCVI)$select(&quot;Index&quot;)$median()</span></span>
<span id="cb11-20"><a href="data-collection-wrangling.html#cb11-20" tabindex="-1"></a><span class="co">#     s2_im &lt;- ee$Image(s2)$</span></span>
<span id="cb11-21"><a href="data-collection-wrangling.html#cb11-21" tabindex="-1"></a><span class="co">#       clip(AOI)</span></span>
<span id="cb11-22"><a href="data-collection-wrangling.html#cb11-22" tabindex="-1"></a><span class="co">#     s2_raster &lt;- ee_as_rast(s2_im,</span></span>
<span id="cb11-23"><a href="data-collection-wrangling.html#cb11-23" tabindex="-1"></a><span class="co">#                             region = AOI,</span></span>
<span id="cb11-24"><a href="data-collection-wrangling.html#cb11-24" tabindex="-1"></a><span class="co">#                             via = &quot;getDownloadURL&quot;,</span></span>
<span id="cb11-25"><a href="data-collection-wrangling.html#cb11-25" tabindex="-1"></a><span class="co">#                             dsn =</span></span>
<span id="cb11-26"><a href="data-collection-wrangling.html#cb11-26" tabindex="-1"></a><span class="co">#                               paste0(&quot;../1_Data/2_Spatial_Layer/2_VI_raster/Peak_30/p30/&quot;,</span></span>
<span id="cb11-27"><a href="data-collection-wrangling.html#cb11-27" tabindex="-1"></a><span class="co">#                                          path_peak[file, 2],&quot;_&quot;,y,&quot;_GCVI.tif&quot;),</span></span>
<span id="cb11-28"><a href="data-collection-wrangling.html#cb11-28" tabindex="-1"></a><span class="co">#                             scale = 10)</span></span>
<span id="cb11-29"><a href="data-collection-wrangling.html#cb11-29" tabindex="-1"></a><span class="co">#   }</span></span>
<span id="cb11-30"><a href="data-collection-wrangling.html#cb11-30" tabindex="-1"></a><span class="co">#   }</span></span></code></pre></div>
</div>
</div>
<div id="clean-yield-monitor-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Clean yield monitor data<a href="data-collection-wrangling.html#clean-yield-monitor-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The methodology to be used in this case for cleaning yield monitor maps is that used by Cordoba et al. (2009). This methodology consists of two steps: removing outliers and cleaning according to the Local Moran Method.</p>
<ol style="list-style-type: decimal">
<li><p>Delete outliers: This involves removing yield values that are more than three standard deviations above or below the mean. In this step, global outliers located at the extremes of the dataset are eliminated, but not local extremes (spatial outliers).</p></li>
<li><p>Local Moran: This step involves eliminating spatial outliers, also known as inliers, which are data points that significantly differ from their neighborhood but are within the general range of variation of the dataset. This inlier identification step is based on Anselin (1995) methodology, known as the local Moran’s spatial autocorrelation index. Given a group of data belonging to different neighborhoods, Local Moran is applied to each data point individually, indicating the degree of similarity or difference between the value of an observation and the values of its neighbors. To calculate the Moran’s Index, it is necessary to identify the neighborhood for each data point, which is the domain where there are data that can be interpreted as spatial neighbors and will be used as a reference to determine whether the data point is different from its neighbors.</p></li>
</ol>
<p>Source: <a href="https://www.researchgate.net/profile/Monica-Balzarini/publication/341282116_Guia_para_el_analisis_de_datos_espaciales_Aplicaciones_en_agricultura/links/5f4e253fa6fdcc14c505fedd/Guia-para-el-analisis-de-datos-espaciales-Aplicaciones-en-agricultura.pdf" class="uri">https://www.researchgate.net/profile/Monica-Balzarini/publication/341282116_Guia_para_el_analisis_de_datos_espaciales_Aplicaciones_en_agricultura/links/5f4e253fa6fdcc14c505fedd/Guia-para-el-analisis-de-datos-espaciales-Aplicaciones-en-agricultura.pdf</a>”</p>
<div id="import-libraries" class="section level3 hasAnchor" number="2.2.1">
<h3><span class="header-section-number">2.2.1</span> Import libraries<a href="data-collection-wrangling.html#import-libraries" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="data-collection-wrangling.html#cb12-1" tabindex="-1"></a><span class="co"># Packages to be used</span></span>
<span id="cb12-2"><a href="data-collection-wrangling.html#cb12-2" tabindex="-1"></a>library_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sp&quot;</span>, <span class="co"># (Bivand et al., 2012)</span></span>
<span id="cb12-3"><a href="data-collection-wrangling.html#cb12-3" tabindex="-1"></a>                   <span class="st">&quot;sf&quot;</span>,  <span class="co"># (Pebesma, 2018)</span></span>
<span id="cb12-4"><a href="data-collection-wrangling.html#cb12-4" tabindex="-1"></a>                   <span class="st">&quot;spdep&quot;</span>, <span class="co"># local moran (Pebesma and Bivand, 2023)</span></span>
<span id="cb12-5"><a href="data-collection-wrangling.html#cb12-5" tabindex="-1"></a>                   <span class="st">&quot;gstat&quot;</span>, <span class="co"># grid and interpolation (Gräler et al., 2016)</span></span>
<span id="cb12-6"><a href="data-collection-wrangling.html#cb12-6" tabindex="-1"></a>                   <span class="st">&quot;raster&quot;</span>, <span class="co"># (Hijmans, 2023)</span></span>
<span id="cb12-7"><a href="data-collection-wrangling.html#cb12-7" tabindex="-1"></a>                   <span class="st">&quot;chirps&quot;</span>, <span class="co"># (Funk et al., 2015)</span></span>
<span id="cb12-8"><a href="data-collection-wrangling.html#cb12-8" tabindex="-1"></a>                   <span class="st">&quot;tidyverse&quot;</span>) <span class="co"># (Wickham et al., 2019)</span></span>
<span id="cb12-9"><a href="data-collection-wrangling.html#cb12-9" tabindex="-1"></a><span class="co"># Iterate over each library name</span></span>
<span id="cb12-10"><a href="data-collection-wrangling.html#cb12-10" tabindex="-1"></a><span class="cf">for</span> (lib_name <span class="cf">in</span> library_names) {</span>
<span id="cb12-11"><a href="data-collection-wrangling.html#cb12-11" tabindex="-1"></a>  <span class="co"># Check if the library is already installed</span></span>
<span id="cb12-12"><a href="data-collection-wrangling.html#cb12-12" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb12-13"><a href="data-collection-wrangling.html#cb12-13" tabindex="-1"></a>    <span class="co"># If the library is not installed, install it</span></span>
<span id="cb12-14"><a href="data-collection-wrangling.html#cb12-14" tabindex="-1"></a>    <span class="fu">install.packages</span>(lib_name, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-15"><a href="data-collection-wrangling.html#cb12-15" tabindex="-1"></a>    <span class="co"># Load the library</span></span>
<span id="cb12-16"><a href="data-collection-wrangling.html#cb12-16" tabindex="-1"></a>    <span class="fu">library</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-17"><a href="data-collection-wrangling.html#cb12-17" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb12-18"><a href="data-collection-wrangling.html#cb12-18" tabindex="-1"></a>    <span class="co"># If the library is already installed, load it</span></span>
<span id="cb12-19"><a href="data-collection-wrangling.html#cb12-19" tabindex="-1"></a>    <span class="fu">library</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb12-20"><a href="data-collection-wrangling.html#cb12-20" tabindex="-1"></a>  }</span>
<span id="cb12-21"><a href="data-collection-wrangling.html#cb12-21" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="field-identification-1" class="section level3 hasAnchor" number="2.2.2">
<h3><span class="header-section-number">2.2.2</span> Field identification<a href="data-collection-wrangling.html#field-identification-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Add the name of the field that you want to clean below. The code is all related to the name that you add there.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="data-collection-wrangling.html#cb13-1" tabindex="-1"></a>FIELD_TO_CLEAN <span class="ot">&lt;-</span> <span class="st">&quot;OH2&quot;</span></span></code></pre></div>
</div>
<div id="cleaning-process" class="section level3 hasAnchor" number="2.2.3">
<h3><span class="header-section-number">2.2.3</span> Cleaning process<a href="data-collection-wrangling.html#cleaning-process" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Obtain path to original Yield monitor data</strong></p>
<p>To automate the cleaning process, establish paths for: (i) each yield monitor data file that requires cleaning, and (ii) the field polygon. The field polygon will be used to cut the yield map, allowing for the exclusion of data collected when the harvesting machine is maneuvering around field borders and other problematic areas.</p>
<p>IMPORTANT:</p>
<p>After running the entire cleaning code, and maybe (could help to visualize) the data exploration code, check the yield distribution within the field. If there is strange patterns or some rows with completely different yields, check the data in QGIS to evaluate it there is any problem.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="data-collection-wrangling.html#cb14-1" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(</span>
<span id="cb14-2"><a href="data-collection-wrangling.html#cb14-2" tabindex="-1"></a>  <span class="at">path =</span> <span class="fu">list.files</span>(<span class="fu">c</span>(<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/1_Original/&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;/Soybean&quot;</span>),</span>
<span id="cb14-3"><a href="data-collection-wrangling.html#cb14-3" tabindex="-1"></a>                      <span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/1_Original/&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;/Maize&quot;</span>)), </span>
<span id="cb14-4"><a href="data-collection-wrangling.html#cb14-4" tabindex="-1"></a>                    <span class="at">full.names =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.shp&quot;</span>, <span class="at">recursive =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-5"><a href="data-collection-wrangling.html#cb14-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Polygon =</span><span class="fu">list.files</span>(<span class="st">&quot;1_Data/1_Polygon&quot;</span>, <span class="at">pattern =</span> <span class="fu">paste0</span>(FIELD_TO_CLEAN,<span class="st">&quot;_pol.shp&quot;</span>), </span>
<span id="cb14-6"><a href="data-collection-wrangling.html#cb14-6" tabindex="-1"></a>                             <span class="at">full.names =</span> T, <span class="at">recursive =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb14-7"><a href="data-collection-wrangling.html#cb14-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path2=</span>path) <span class="sc">%&gt;%</span> </span>
<span id="cb14-8"><a href="data-collection-wrangling.html#cb14-8" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> path2, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;del_Datafold&quot;</span> ,<span class="st">&quot;del_YMfold&quot;</span>,<span class="st">&quot;del_Origfold&quot;</span> ,<span class="st">&quot;Field&quot;</span>,</span>
<span id="cb14-9"><a href="data-collection-wrangling.html#cb14-9" tabindex="-1"></a>                                  <span class="st">&quot;Crop&quot;</span>,  <span class="st">&quot;Farm_name&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;/&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-10"><a href="data-collection-wrangling.html#cb14-10" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> Farm_name, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Family&quot;</span>, <span class="st">&quot;del_Home&quot;</span>, <span class="st">&quot;del_field&quot;</span>, <span class="st">&quot;del_harvest&quot;</span>, <span class="st">&quot;Year&quot;</span>), </span>
<span id="cb14-11"><a href="data-collection-wrangling.html#cb14-11" tabindex="-1"></a>           <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb14-12"><a href="data-collection-wrangling.html#cb14-12" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(<span class="fu">gsub</span>(<span class="st">&quot;.*_(20</span><span class="sc">\\</span><span class="st">d{2})-.*</span><span class="sc">\\</span><span class="st">.shp&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, path)))<span class="sc">%&gt;%</span></span>
<span id="cb14-13"><a href="data-collection-wrangling.html#cb14-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Year <span class="sc">&gt;</span><span class="dv">2015</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb14-14"><a href="data-collection-wrangling.html#cb14-14" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(<span class="fu">starts_with</span>(<span class="st">&quot;del_&quot;</span>))) </span></code></pre></div>
<p><strong>1) Check data &amp; first step of cleaning process</strong></p>
<p>This code first generates yield maps before any cleaning process is applied. Next, it performs the initial step of the cleaning process by removing extreme outliers. This is done by filtering the data based on combine speed, grain moisture, and yield variables.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="data-collection-wrangling.html#cb15-1" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(files)){</span>
<span id="cb15-2"><a href="data-collection-wrangling.html#cb15-2" tabindex="-1"></a>  <span class="do">###########################################################</span></span>
<span id="cb15-3"><a href="data-collection-wrangling.html#cb15-3" tabindex="-1"></a>                     <span class="do">#### DATA CHECKING ####</span></span>
<span id="cb15-4"><a href="data-collection-wrangling.html#cb15-4" tabindex="-1"></a>  <span class="do">###########################################################</span></span>
<span id="cb15-5"><a href="data-collection-wrangling.html#cb15-5" tabindex="-1"></a>  <span class="co"># Obtain yield monitor data</span></span>
<span id="cb15-6"><a href="data-collection-wrangling.html#cb15-6" tabindex="-1"></a>  YM <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(files[file,<span class="dv">1</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb15-7"><a href="data-collection-wrangling.html#cb15-7" tabindex="-1"></a>    <span class="fu">st_set_crs</span>(<span class="fu">st_crs</span>(<span class="st">&quot;epsg:4326&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb15-8"><a href="data-collection-wrangling.html#cb15-8" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">32616</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-9"><a href="data-collection-wrangling.html#cb15-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">X =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]),</span>
<span id="cb15-10"><a href="data-collection-wrangling.html#cb15-10" tabindex="-1"></a>                  <span class="at">Y =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb15-11"><a href="data-collection-wrangling.html#cb15-11" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="at">Yield =</span> VRYIELDVOL,</span>
<span id="cb15-12"><a href="data-collection-wrangling.html#cb15-12" tabindex="-1"></a>           <span class="at">VEHICLSPEED =</span> <span class="fu">starts_with</span>(<span class="st">&quot;VEHICLSPE&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb15-13"><a href="data-collection-wrangling.html#cb15-13" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Moisture,WetMass,Yield, VEHICLSPEED,</span>
<span id="cb15-14"><a href="data-collection-wrangling.html#cb15-14" tabindex="-1"></a>                  DISTANCE)</span>
<span id="cb15-15"><a href="data-collection-wrangling.html#cb15-15" tabindex="-1"></a>  <span class="co"># Obtain Field polygon (boundary)</span></span>
<span id="cb15-16"><a href="data-collection-wrangling.html#cb15-16" tabindex="-1"></a>   pol <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(files[file,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb15-17"><a href="data-collection-wrangling.html#cb15-17" tabindex="-1"></a>     <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(YM)) </span>
<span id="cb15-18"><a href="data-collection-wrangling.html#cb15-18" tabindex="-1"></a>  <span class="co"># Clip the yield data with the field boundary</span></span>
<span id="cb15-19"><a href="data-collection-wrangling.html#cb15-19" tabindex="-1"></a>   YM <span class="ot">&lt;-</span> <span class="fu">st_intersection</span>(YM, pol)</span>
<span id="cb15-20"><a href="data-collection-wrangling.html#cb15-20" tabindex="-1"></a>  <span class="co"># Plot data to check original data</span></span>
<span id="cb15-21"><a href="data-collection-wrangling.html#cb15-21" tabindex="-1"></a>   YM_original <span class="ot">&lt;-</span> YM <span class="sc">%&gt;%</span> </span>
<span id="cb15-22"><a href="data-collection-wrangling.html#cb15-22" tabindex="-1"></a>     <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-23"><a href="data-collection-wrangling.html#cb15-23" tabindex="-1"></a>     <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> Yield))<span class="sc">+</span></span>
<span id="cb15-24"><a href="data-collection-wrangling.html#cb15-24" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Yield (bu/ac)&quot;</span>)<span class="sc">+</span></span>
<span id="cb15-25"><a href="data-collection-wrangling.html#cb15-25" tabindex="-1"></a>     <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;#3b0001&quot;</span>,<span class="st">&quot;#be0003&quot;</span>,<span class="st">&quot;#ff4903&quot;</span>, <span class="st">&quot;#ffdc00&quot;</span>,<span class="st">&quot;#559d03&quot;</span>,<span class="st">&quot;#075e07&quot;</span>,<span class="st">&#39;#161f0c&#39;</span>))<span class="sc">+</span></span>
<span id="cb15-26"><a href="data-collection-wrangling.html#cb15-26" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-27"><a href="data-collection-wrangling.html#cb15-27" tabindex="-1"></a>           <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-28"><a href="data-collection-wrangling.html#cb15-28" tabindex="-1"></a>   <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/2_YM_clean/1_Original/YM/&quot;</span>,</span>
<span id="cb15-29"><a href="data-collection-wrangling.html#cb15-29" tabindex="-1"></a>                 files[file,<span class="dv">3</span>],<span class="st">&quot;_&quot;</span>,files[file,<span class="dv">4</span>],files[file,<span class="dv">6</span>],<span class="st">&quot;.png&quot;</span>), </span>
<span id="cb15-30"><a href="data-collection-wrangling.html#cb15-30" tabindex="-1"></a>          <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="fl">6.5</span>)</span>
<span id="cb15-31"><a href="data-collection-wrangling.html#cb15-31" tabindex="-1"></a>   distr_pl <span class="ot">&lt;-</span> YM <span class="sc">%&gt;%</span> </span>
<span id="cb15-32"><a href="data-collection-wrangling.html#cb15-32" tabindex="-1"></a>     dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>FID) <span class="sc">%&gt;%</span> </span>
<span id="cb15-33"><a href="data-collection-wrangling.html#cb15-33" tabindex="-1"></a>     <span class="fu">pivot_longer</span>(<span class="sc">!</span>geometry, <span class="at">names_to =</span> <span class="st">&quot;Var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Val&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-34"><a href="data-collection-wrangling.html#cb15-34" tabindex="-1"></a>     <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-35"><a href="data-collection-wrangling.html#cb15-35" tabindex="-1"></a>     <span class="fu">geom_histogram</span>(<span class="fu">aes</span>(Val), <span class="at">fill =</span> <span class="st">&quot;grey60&quot;</span>, <span class="at">color =</span> <span class="st">&quot;grey20&quot;</span>)<span class="sc">+</span></span>
<span id="cb15-36"><a href="data-collection-wrangling.html#cb15-36" tabindex="-1"></a>     <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var, <span class="at">ncol =</span> <span class="dv">1</span>, <span class="at">scales =</span> <span class="st">&quot;free&quot;</span>)<span class="sc">+</span></span>
<span id="cb15-37"><a href="data-collection-wrangling.html#cb15-37" tabindex="-1"></a>     <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb15-38"><a href="data-collection-wrangling.html#cb15-38" tabindex="-1"></a>     <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Value&quot;</span>)<span class="sc">+</span></span>
<span id="cb15-39"><a href="data-collection-wrangling.html#cb15-39" tabindex="-1"></a>     <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-40"><a href="data-collection-wrangling.html#cb15-40" tabindex="-1"></a>    <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/2_YM_clean/1_Original/Distr/&quot;</span>,</span>
<span id="cb15-41"><a href="data-collection-wrangling.html#cb15-41" tabindex="-1"></a>                  files[file,<span class="dv">3</span>],<span class="st">&quot;_&quot;</span>,files[file,<span class="dv">4</span>],files[file,<span class="dv">6</span>],<span class="st">&quot;.png&quot;</span>), </span>
<span id="cb15-42"><a href="data-collection-wrangling.html#cb15-42" tabindex="-1"></a>           <span class="at">height =</span> <span class="dv">6</span>, <span class="at">width =</span> <span class="fl">2.5</span>)</span>
<span id="cb15-43"><a href="data-collection-wrangling.html#cb15-43" tabindex="-1"></a>  <span class="do">###########################################################</span></span>
<span id="cb15-44"><a href="data-collection-wrangling.html#cb15-44" tabindex="-1"></a>                   <span class="do">#### DATA CLEANING: STEP 1 ####</span></span>
<span id="cb15-45"><a href="data-collection-wrangling.html#cb15-45" tabindex="-1"></a>  <span class="do">###########################################################    </span></span>
<span id="cb15-46"><a href="data-collection-wrangling.html#cb15-46" tabindex="-1"></a>    <span class="co"># 1) Remove general outliers (extreme outliers)</span></span>
<span id="cb15-47"><a href="data-collection-wrangling.html#cb15-47" tabindex="-1"></a>    YM_in <span class="ot">&lt;-</span> YM <span class="sc">%&gt;%</span> </span>
<span id="cb15-48"><a href="data-collection-wrangling.html#cb15-48" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(Yield<span class="sc">&gt;=</span><span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb15-49"><a href="data-collection-wrangling.html#cb15-49" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">Speed_q025 =</span> <span class="fu">quantile</span>(VEHICLSPEED, <span class="fl">0.025</span>),</span>
<span id="cb15-50"><a href="data-collection-wrangling.html#cb15-50" tabindex="-1"></a>             <span class="at">Speed_q975 =</span> <span class="fu">quantile</span>(VEHICLSPEED, <span class="fl">0.975</span>),</span>
<span id="cb15-51"><a href="data-collection-wrangling.html#cb15-51" tabindex="-1"></a>             <span class="at">Moist_q025 =</span> <span class="fu">quantile</span>(Moisture, <span class="fl">0.025</span>),</span>
<span id="cb15-52"><a href="data-collection-wrangling.html#cb15-52" tabindex="-1"></a>             <span class="at">Moist_q975 =</span> <span class="fu">quantile</span>(Moisture, <span class="fl">0.975</span>),</span>
<span id="cb15-53"><a href="data-collection-wrangling.html#cb15-53" tabindex="-1"></a>             <span class="at">mean_yield =</span> <span class="fu">mean</span>(Yield),</span>
<span id="cb15-54"><a href="data-collection-wrangling.html#cb15-54" tabindex="-1"></a>             <span class="at">sd_yield =</span> <span class="fu">sd</span>(Yield),</span>
<span id="cb15-55"><a href="data-collection-wrangling.html#cb15-55" tabindex="-1"></a>             <span class="at">LI =</span> mean_yield<span class="dv">-3</span><span class="sc">*</span>sd_yield,</span>
<span id="cb15-56"><a href="data-collection-wrangling.html#cb15-56" tabindex="-1"></a>             <span class="at">LS =</span> mean_yield<span class="sc">+</span><span class="dv">3</span><span class="sc">*</span>sd_yield) <span class="sc">%&gt;%</span> </span>
<span id="cb15-57"><a href="data-collection-wrangling.html#cb15-57" tabindex="-1"></a>      <span class="co"># Filtering rules with clear physical meaning </span></span>
<span id="cb15-58"><a href="data-collection-wrangling.html#cb15-58" tabindex="-1"></a>      dplyr<span class="sc">::</span><span class="fu">filter</span>(Yield<span class="sc">&gt;</span> LI <span class="sc">&amp;</span> Yield<span class="sc">&lt;</span> LS <span class="sc">&amp;</span> </span>
<span id="cb15-59"><a href="data-collection-wrangling.html#cb15-59" tabindex="-1"></a>                      VEHICLSPEED <span class="sc">&gt;</span>  Speed_q025 <span class="sc">&amp;</span> VEHICLSPEED <span class="sc">&lt;</span>Speed_q975<span class="sc">&amp;</span></span>
<span id="cb15-60"><a href="data-collection-wrangling.html#cb15-60" tabindex="-1"></a>                      Moisture <span class="sc">&gt;</span> Moist_q025 <span class="sc">&amp;</span> Moisture <span class="sc">&lt;</span> Moist_q975) </span>
<span id="cb15-61"><a href="data-collection-wrangling.html#cb15-61" tabindex="-1"></a>  </span>
<span id="cb15-62"><a href="data-collection-wrangling.html#cb15-62" tabindex="-1"></a>     sf<span class="sc">::</span><span class="fu">write_sf</span>(YM_in,<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/2_Clean_Gener_Outliers/&quot;</span>,</span>
<span id="cb15-63"><a href="data-collection-wrangling.html#cb15-63" tabindex="-1"></a>                               FIELD_TO_CLEAN,<span class="st">&quot;_&quot;</span>,files[file,<span class="dv">4</span>],<span class="st">&quot;_&quot;</span>,files[file,<span class="dv">6</span>],<span class="st">&quot;.shp&quot;</span>),</span>
<span id="cb15-64"><a href="data-collection-wrangling.html#cb15-64" tabindex="-1"></a>                  <span class="at">append =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-65"><a href="data-collection-wrangling.html#cb15-65" tabindex="-1"></a>     <span class="co"># Plot data with the first cleaning step</span></span>
<span id="cb15-66"><a href="data-collection-wrangling.html#cb15-66" tabindex="-1"></a>     YM_out <span class="ot">&lt;-</span> YM_in <span class="sc">%&gt;%</span> </span>
<span id="cb15-67"><a href="data-collection-wrangling.html#cb15-67" tabindex="-1"></a>       <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb15-68"><a href="data-collection-wrangling.html#cb15-68" tabindex="-1"></a>       <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> Yield))<span class="sc">+</span></span>
<span id="cb15-69"><a href="data-collection-wrangling.html#cb15-69" tabindex="-1"></a>       <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Yield (bu/ac)&quot;</span>)<span class="sc">+</span></span>
<span id="cb15-70"><a href="data-collection-wrangling.html#cb15-70" tabindex="-1"></a>       <span class="fu">scale_color_gradientn</span>(<span class="at">colors=</span><span class="fu">c</span>(<span class="st">&quot;#3b0001&quot;</span>,<span class="st">&quot;#be0003&quot;</span>,<span class="st">&quot;#ff4903&quot;</span>, <span class="st">&quot;#ffdc00&quot;</span>,<span class="st">&quot;#559d03&quot;</span>,<span class="st">&quot;#075e07&quot;</span>,<span class="st">&#39;#161f0c&#39;</span>))<span class="sc">+</span></span>
<span id="cb15-71"><a href="data-collection-wrangling.html#cb15-71" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb15-72"><a href="data-collection-wrangling.html#cb15-72" tabindex="-1"></a>           <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span>
<span id="cb15-73"><a href="data-collection-wrangling.html#cb15-73" tabindex="-1"></a>  </span>
<span id="cb15-74"><a href="data-collection-wrangling.html#cb15-74" tabindex="-1"></a>     <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/2_YM_clean/2_General_Outliers/&quot;</span>,</span>
<span id="cb15-75"><a href="data-collection-wrangling.html#cb15-75" tabindex="-1"></a>                   files[file,<span class="dv">3</span>],<span class="st">&quot;_&quot;</span>,files[file,<span class="dv">4</span>],files[file,<span class="dv">6</span>],<span class="st">&quot;.png&quot;</span>), </span>
<span id="cb15-76"><a href="data-collection-wrangling.html#cb15-76" tabindex="-1"></a>            <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="fl">6.5</span>)</span>
<span id="cb15-77"><a href="data-collection-wrangling.html#cb15-77" tabindex="-1"></a>}</span>
<span id="cb15-78"><a href="data-collection-wrangling.html#cb15-78" tabindex="-1"></a>YM_original <span class="co"># Original data without removing general outliers</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-1.png" width="672" /></p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="data-collection-wrangling.html#cb16-1" tabindex="-1"></a>YM_out <span class="co"># Yield monitor data without general outliers</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-15-2.png" width="672" /></p>
<p><strong>Path to Yield monitor without extreme/general outliers</strong></p>
<p>Upload the paths to the yield monitor data shapefiles after removing extreme outliers. Additionally, create a 10 m x 10 m grid for the farm to match the cell/pixel size of the Sentinel data.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="data-collection-wrangling.html#cb17-1" tabindex="-1"></a>files2 <span class="ot">&lt;-</span><span class="fu">data.frame</span>(<span class="at">path=</span><span class="fu">list.files</span>(<span class="st">&quot;1_Data/3_YM/2_Clean_Gener_Outliers&quot;</span>, </span>
<span id="cb17-2"><a href="data-collection-wrangling.html#cb17-2" tabindex="-1"></a>                                    <span class="at">full.names =</span> T,<span class="at">pattern =</span> <span class="st">&quot;.shp&quot;</span>,<span class="at">recursive =</span>T)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-3"><a href="data-collection-wrangling.html#cb17-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, FIELD_TO_CLEAN)) <span class="sc">%&gt;%</span> </span>
<span id="cb17-4"><a href="data-collection-wrangling.html#cb17-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Polygon =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="st">&quot;1_Data/1_Polygon&quot;</span>, </span>
<span id="cb17-5"><a href="data-collection-wrangling.html#cb17-5" tabindex="-1"></a>                                        <span class="at">full.names =</span> T,</span>
<span id="cb17-6"><a href="data-collection-wrangling.html#cb17-6" tabindex="-1"></a>                                        <span class="at">pattern =</span> <span class="fu">paste0</span>(FIELD_TO_CLEAN,<span class="st">&quot;_pol.shp&quot;</span>), </span>
<span id="cb17-7"><a href="data-collection-wrangling.html#cb17-7" tabindex="-1"></a>                                        <span class="at">recursive =</span> T)),</span>
<span id="cb17-8"><a href="data-collection-wrangling.html#cb17-8" tabindex="-1"></a>         <span class="at">path2=</span>path) <span class="sc">%&gt;%</span> </span>
<span id="cb17-9"><a href="data-collection-wrangling.html#cb17-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path2 =</span> <span class="fu">str_remove</span>(path2,<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/2_Clean_Gener_Outliers/&quot;</span>,</span>
<span id="cb17-10"><a href="data-collection-wrangling.html#cb17-10" tabindex="-1"></a>                                         FIELD_TO_CLEAN,<span class="st">&quot;_&quot;</span>)),</span>
<span id="cb17-11"><a href="data-collection-wrangling.html#cb17-11" tabindex="-1"></a>         <span class="at">Field =</span> FIELD_TO_CLEAN) <span class="sc">%&gt;%</span> </span>
<span id="cb17-12"><a href="data-collection-wrangling.html#cb17-12" tabindex="-1"></a>  <span class="fu">separate</span>(<span class="at">col =</span> path2, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Crop&quot;</span>, <span class="st">&quot;Year&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb17-13"><a href="data-collection-wrangling.html#cb17-13" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">str_remove</span>(Year, <span class="st">&quot;.shp&quot;</span>))</span>
<span id="cb17-14"><a href="data-collection-wrangling.html#cb17-14" tabindex="-1"></a></span>
<span id="cb17-15"><a href="data-collection-wrangling.html#cb17-15" tabindex="-1"></a><span class="co"># This part is to obtain the field boundaries </span></span>
<span id="cb17-16"><a href="data-collection-wrangling.html#cb17-16" tabindex="-1"></a>YM <span class="ot">&lt;-</span> YM_in<span class="sc">%&gt;%</span> </span>
<span id="cb17-17"><a href="data-collection-wrangling.html#cb17-17" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">X =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]),</span>
<span id="cb17-18"><a href="data-collection-wrangling.html#cb17-18" tabindex="-1"></a>                  <span class="at">Y =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb17-19"><a href="data-collection-wrangling.html#cb17-19" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y,Yield) <span class="sc">%&gt;%</span></span>
<span id="cb17-20"><a href="data-collection-wrangling.html#cb17-20" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb17-21"><a href="data-collection-wrangling.html#cb17-21" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb17-22"><a href="data-collection-wrangling.html#cb17-22" tabindex="-1"></a>  </span>
<span id="cb17-23"><a href="data-collection-wrangling.html#cb17-23" tabindex="-1"></a>  <span class="fu">names</span>(YM)       <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>,<span class="st">&quot;Yield&quot;</span>)</span>
<span id="cb17-24"><a href="data-collection-wrangling.html#cb17-24" tabindex="-1"></a>  <span class="fu">coordinates</span>(YM) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb17-25"><a href="data-collection-wrangling.html#cb17-25" tabindex="-1"></a>  <span class="fu">proj4string</span>(YM) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb17-26"><a href="data-collection-wrangling.html#cb17-26" tabindex="-1"></a></span>
<span id="cb17-27"><a href="data-collection-wrangling.html#cb17-27" tabindex="-1"></a>grd <span class="ot">&lt;-</span> <span class="fu">expand.grid</span>(<span class="at">x =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="fu">as.data.frame</span>(YM)[,<span class="dv">1</span>]), </span>
<span id="cb17-28"><a href="data-collection-wrangling.html#cb17-28" tabindex="-1"></a>                           <span class="fu">max</span>(<span class="fu">as.data.frame</span>(YM)[,<span class="dv">1</span>]), <span class="at">by=</span><span class="dv">10</span>),</span>
<span id="cb17-29"><a href="data-collection-wrangling.html#cb17-29" tabindex="-1"></a>                   <span class="at">y =</span> <span class="fu">seq</span>(<span class="fu">min</span>(<span class="fu">as.data.frame</span>(YM)[,<span class="dv">2</span>]),</span>
<span id="cb17-30"><a href="data-collection-wrangling.html#cb17-30" tabindex="-1"></a>                           <span class="fu">max</span>(<span class="fu">as.data.frame</span>(YM)[,<span class="dv">2</span>]), <span class="at">by=</span><span class="dv">10</span>))</span>
<span id="cb17-31"><a href="data-collection-wrangling.html#cb17-31" tabindex="-1"></a><span class="fu">names</span>(grd) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>,<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb17-32"><a href="data-collection-wrangling.html#cb17-32" tabindex="-1"></a><span class="fu">coordinates</span>(grd) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>,<span class="st">&quot;Y&quot;</span>)</span>
<span id="cb17-33"><a href="data-collection-wrangling.html#cb17-33" tabindex="-1"></a><span class="fu">proj4string</span>(grd) <span class="ot">&lt;-</span><span class="fu">CRS</span>(<span class="st">&quot;+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb17-34"><a href="data-collection-wrangling.html#cb17-34" tabindex="-1"></a><span class="fu">gridded</span>(grd) <span class="ot">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># Create SpatialPixel object</span></span>
<span id="cb17-35"><a href="data-collection-wrangling.html#cb17-35" tabindex="-1"></a><span class="fu">fullgrid</span>(grd) <span class="ot">&lt;-</span> <span class="cn">TRUE</span>  <span class="co"># Create SpatialGrid object</span></span></code></pre></div>
<p><strong>2) Second step of cleaning yield monitor data: Local Moran</strong></p>
<p>Second step of the data cleaning process: The Local Moran method was used to identify and remove inliers and spatial outliers from the dataset. Additionally, yield monitor data were interpolated using inverse distance weighting (IDW) interpolation (Gräler et al., 2016) to generate a 10x10 m grid. This grid resolution allows for the consistent overlay of yield monitor data across multiple years and aligns with the resolution of Sentinel data.</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="data-collection-wrangling.html#cb18-1" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(files2)){</span>
<span id="cb18-2"><a href="data-collection-wrangling.html#cb18-2" tabindex="-1"></a>  <span class="do">###########################################################</span></span>
<span id="cb18-3"><a href="data-collection-wrangling.html#cb18-3" tabindex="-1"></a>                   <span class="do">#### DATA CLEANING: STEP 2 ####</span></span>
<span id="cb18-4"><a href="data-collection-wrangling.html#cb18-4" tabindex="-1"></a>  <span class="do">###########################################################  </span></span>
<span id="cb18-5"><a href="data-collection-wrangling.html#cb18-5" tabindex="-1"></a>  <span class="co"># Upload dataframe without extreme values</span></span>
<span id="cb18-6"><a href="data-collection-wrangling.html#cb18-6" tabindex="-1"></a>  YM_in <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(files2[file,<span class="dv">1</span>]) </span>
<span id="cb18-7"><a href="data-collection-wrangling.html#cb18-7" tabindex="-1"></a>  <span class="do">## LOCAL MORAN CLEANING METHOD ##</span></span>
<span id="cb18-8"><a href="data-collection-wrangling.html#cb18-8" tabindex="-1"></a>  NB <span class="ot">&lt;-</span> <span class="fu">dnearneigh</span>(YM_in<span class="sc">$</span>geometry, <span class="at">d1 =</span> <span class="dv">0</span>, <span class="at">d2 =</span> <span class="dv">18</span>)</span>
<span id="cb18-9"><a href="data-collection-wrangling.html#cb18-9" tabindex="-1"></a>  <span class="co">#summary(NB)</span></span>
<span id="cb18-10"><a href="data-collection-wrangling.html#cb18-10" tabindex="-1"></a>  moranl <span class="ot">&lt;-</span><span class="fu">localmoran</span>(YM_in<span class="sc">$</span>Yield, </span>
<span id="cb18-11"><a href="data-collection-wrangling.html#cb18-11" tabindex="-1"></a>                      <span class="fu">nb2listw</span>(NB,<span class="at">style =</span> <span class="st">&quot;W&quot;</span>),</span>
<span id="cb18-12"><a href="data-collection-wrangling.html#cb18-12" tabindex="-1"></a>                      <span class="at">alternative =</span> <span class="st">&quot;less&quot;</span>)</span>
<span id="cb18-13"><a href="data-collection-wrangling.html#cb18-13" tabindex="-1"></a>  moranp <span class="ot">&lt;-</span> <span class="fu">moran.plot</span>(YM_in<span class="sc">$</span>Yield,</span>
<span id="cb18-14"><a href="data-collection-wrangling.html#cb18-14" tabindex="-1"></a>                       <span class="at">col =</span> <span class="dv">3</span>,</span>
<span id="cb18-15"><a href="data-collection-wrangling.html#cb18-15" tabindex="-1"></a>                       <span class="fu">nb2listw</span>(NB,<span class="at">style =</span> <span class="st">&quot;W&quot;</span>),</span>
<span id="cb18-16"><a href="data-collection-wrangling.html#cb18-16" tabindex="-1"></a>                       <span class="at">labels =</span> F,<span class="at">quiet =</span> T,</span>
<span id="cb18-17"><a href="data-collection-wrangling.html#cb18-17" tabindex="-1"></a>                       <span class="at">xlab =</span> <span class="st">&quot;Rinde&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;Rinde Spatially Lagged&quot;</span>)</span>
<span id="cb18-18"><a href="data-collection-wrangling.html#cb18-18" tabindex="-1"></a>  <span class="co">#summary(moranp)</span></span>
<span id="cb18-19"><a href="data-collection-wrangling.html#cb18-19" tabindex="-1"></a>  influ <span class="ot">&lt;-</span> moranp<span class="sc">$</span>is_inf</span>
<span id="cb18-20"><a href="data-collection-wrangling.html#cb18-20" tabindex="-1"></a>  data <span class="ot">&lt;-</span> <span class="fu">cbind</span>(YM_in, moranl, influ)</span>
<span id="cb18-21"><a href="data-collection-wrangling.html#cb18-21" tabindex="-1"></a>  </span>
<span id="cb18-22"><a href="data-collection-wrangling.html#cb18-22" tabindex="-1"></a>  <span class="co"># Obtain dataset without extreme and spatial outliers</span></span>
<span id="cb18-23"><a href="data-collection-wrangling.html#cb18-23" tabindex="-1"></a>  YM_clean <span class="ot">&lt;-</span><span class="fu">subset</span>(data, data[[<span class="st">&quot;Ii&quot;</span>]] <span class="sc">&gt;=</span> <span class="dv">0</span> <span class="sc">|</span> data[[<span class="st">&quot;Pr.z...E.Ii..&quot;</span>]] <span class="sc">&gt;</span> <span class="fl">0.05</span>)</span>
<span id="cb18-24"><a href="data-collection-wrangling.html#cb18-24" tabindex="-1"></a>  inliers_ml <span class="ot">&lt;-</span><span class="fu">subset</span>(data, data[[<span class="st">&quot;Ii&quot;</span>]] <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">&amp;</span> data[[<span class="st">&quot;Pr.z...E.Ii..&quot;</span>]] <span class="sc">&lt;</span> <span class="fl">0.05</span>)</span>
<span id="cb18-25"><a href="data-collection-wrangling.html#cb18-25" tabindex="-1"></a>  </span>
<span id="cb18-26"><a href="data-collection-wrangling.html#cb18-26" tabindex="-1"></a>  <span class="co"># Plot to check data</span></span>
<span id="cb18-27"><a href="data-collection-wrangling.html#cb18-27" tabindex="-1"></a>  YM_clean_pl <span class="ot">&lt;-</span> YM_clean <span class="sc">%&gt;%</span> </span>
<span id="cb18-28"><a href="data-collection-wrangling.html#cb18-28" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb18-29"><a href="data-collection-wrangling.html#cb18-29" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> Yield))<span class="sc">+</span></span>
<span id="cb18-30"><a href="data-collection-wrangling.html#cb18-30" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Yield (bu/ac)&quot;</span>)<span class="sc">+</span></span>
<span id="cb18-31"><a href="data-collection-wrangling.html#cb18-31" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> <span class="fu">c</span>(<span class="st">&quot;#3b0001&quot;</span>,<span class="st">&quot;#be0003&quot;</span>,<span class="st">&quot;#ff4903&quot;</span>,</span>
<span id="cb18-32"><a href="data-collection-wrangling.html#cb18-32" tabindex="-1"></a>                                     <span class="st">&quot;#ffdc00&quot;</span>,<span class="st">&quot;#559d03&quot;</span>,<span class="st">&quot;#075e07&quot;</span>,<span class="st">&#39;#161f0c&#39;</span>))<span class="sc">+</span></span>
<span id="cb18-33"><a href="data-collection-wrangling.html#cb18-33" tabindex="-1"></a>       <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb18-34"><a href="data-collection-wrangling.html#cb18-34" tabindex="-1"></a>           <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>())</span>
<span id="cb18-35"><a href="data-collection-wrangling.html#cb18-35" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/2_YM_clean/3_Local_Moran/&quot;</span>,</span>
<span id="cb18-36"><a href="data-collection-wrangling.html#cb18-36" tabindex="-1"></a>                files2[file,<span class="dv">5</span>],<span class="st">&quot;_&quot;</span>,files2[file,<span class="dv">3</span>],files2[file,<span class="dv">4</span>],<span class="st">&quot;.png&quot;</span>), </span>
<span id="cb18-37"><a href="data-collection-wrangling.html#cb18-37" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">3</span>, <span class="at">width =</span> <span class="fl">6.5</span>)</span>
<span id="cb18-38"><a href="data-collection-wrangling.html#cb18-38" tabindex="-1"></a></span>
<span id="cb18-39"><a href="data-collection-wrangling.html#cb18-39" tabindex="-1"></a>  <span class="do">###########################################################</span></span>
<span id="cb18-40"><a href="data-collection-wrangling.html#cb18-40" tabindex="-1"></a>             <span class="do">#### CREATE GRID &amp; INTERPOLATE ####</span></span>
<span id="cb18-41"><a href="data-collection-wrangling.html#cb18-41" tabindex="-1"></a>  <span class="do">###########################################################    </span></span>
<span id="cb18-42"><a href="data-collection-wrangling.html#cb18-42" tabindex="-1"></a>  <span class="co"># Yield data</span></span>
<span id="cb18-43"><a href="data-collection-wrangling.html#cb18-43" tabindex="-1"></a>  YM <span class="ot">&lt;-</span> YM_clean <span class="sc">%&gt;%</span> </span>
<span id="cb18-44"><a href="data-collection-wrangling.html#cb18-44" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">X =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]),</span>
<span id="cb18-45"><a href="data-collection-wrangling.html#cb18-45" tabindex="-1"></a>                  <span class="at">Y =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb18-46"><a href="data-collection-wrangling.html#cb18-46" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y,Yield) <span class="sc">%&gt;%</span></span>
<span id="cb18-47"><a href="data-collection-wrangling.html#cb18-47" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb18-48"><a href="data-collection-wrangling.html#cb18-48" tabindex="-1"></a>    <span class="fu">as.data.frame</span>()</span>
<span id="cb18-49"><a href="data-collection-wrangling.html#cb18-49" tabindex="-1"></a>  </span>
<span id="cb18-50"><a href="data-collection-wrangling.html#cb18-50" tabindex="-1"></a>  <span class="fu">names</span>(YM)       <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>,<span class="st">&quot;Yield&quot;</span>)</span>
<span id="cb18-51"><a href="data-collection-wrangling.html#cb18-51" tabindex="-1"></a>  <span class="fu">coordinates</span>(YM) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)</span>
<span id="cb18-52"><a href="data-collection-wrangling.html#cb18-52" tabindex="-1"></a>  <span class="fu">proj4string</span>(YM) <span class="ot">&lt;-</span> <span class="fu">CRS</span>(<span class="st">&quot;+proj=utm +zone=16 +datum=WGS84 +units=m +no_defs&quot;</span>)</span>
<span id="cb18-53"><a href="data-collection-wrangling.html#cb18-53" tabindex="-1"></a>  </span>
<span id="cb18-54"><a href="data-collection-wrangling.html#cb18-54" tabindex="-1"></a>  <span class="co"># Create grid using the field polygon</span></span>
<span id="cb18-55"><a href="data-collection-wrangling.html#cb18-55" tabindex="-1"></a>  pol <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(files2[file,<span class="dv">2</span>]) <span class="sc">%&gt;%</span> </span>
<span id="cb18-56"><a href="data-collection-wrangling.html#cb18-56" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="at">crs =</span> <span class="fu">st_crs</span>(YM))</span>
<span id="cb18-57"><a href="data-collection-wrangling.html#cb18-57" tabindex="-1"></a>  </span>
<span id="cb18-58"><a href="data-collection-wrangling.html#cb18-58" tabindex="-1"></a>  <span class="co"># Interpolation</span></span>
<span id="cb18-59"><a href="data-collection-wrangling.html#cb18-59" tabindex="-1"></a>  idw <span class="ot">&lt;-</span> <span class="fu">idw</span>(<span class="at">formula =</span> YM<span class="sc">$</span>Yield<span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb18-60"><a href="data-collection-wrangling.html#cb18-60" tabindex="-1"></a>             <span class="at">locations =</span> YM, <span class="at">newdata =</span> grd,</span>
<span id="cb18-61"><a href="data-collection-wrangling.html#cb18-61" tabindex="-1"></a>             <span class="at">idp =</span><span class="dv">3</span>) <span class="sc">%&gt;%</span></span>
<span id="cb18-62"><a href="data-collection-wrangling.html#cb18-62" tabindex="-1"></a>    raster<span class="sc">::</span><span class="fu">raster</span>()</span>
<span id="cb18-63"><a href="data-collection-wrangling.html#cb18-63" tabindex="-1"></a>  </span>
<span id="cb18-64"><a href="data-collection-wrangling.html#cb18-64" tabindex="-1"></a>  idw <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">mask</span>(idw, pol)</span>
<span id="cb18-65"><a href="data-collection-wrangling.html#cb18-65" tabindex="-1"></a>  raster<span class="sc">::</span><span class="fu">writeRaster</span>(idw, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/3_Interp_Grid/&quot;</span>,</span>
<span id="cb18-66"><a href="data-collection-wrangling.html#cb18-66" tabindex="-1"></a>                                   files2[file,<span class="dv">5</span>],<span class="st">&quot;_&quot;</span>,files2[file,<span class="dv">3</span>],files2[file,<span class="dv">4</span>],</span>
<span id="cb18-67"><a href="data-collection-wrangling.html#cb18-67" tabindex="-1"></a>                                  <span class="st">&quot;.tif&quot;</span>), <span class="at">overwrite =</span> T)</span>
<span id="cb18-68"><a href="data-collection-wrangling.html#cb18-68" tabindex="-1"></a>}</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-1.png" width="672" /><img src="_main_files/figure-html/unnamed-chunk-17-2.png" width="672" /></p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="data-collection-wrangling.html#cb19-1" tabindex="-1"></a>YM_clean_pl <span class="co"># Yield monitor data cleaned</span></span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-17-3.png" width="672" /></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="data-collection-wrangling.html#cb20-1" tabindex="-1"></a>mapview<span class="sc">::</span><span class="fu">mapview</span>(idw) <span class="co"># Yield monitor data interpolateed &amp; gridded</span></span></code></pre></div>
<p><strong>3) Join all years of yield monitor data</strong></p>
<p>Up to this point, we have separate shapefiles for each year and field. In this code, we are merging all the yearly shapefiles (containing the cleaned yield monitor data) for each field into a single shapefile.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="data-collection-wrangling.html#cb21-1" tabindex="-1"></a><span class="co"># Generate a dataframe with paths and metadata</span></span>
<span id="cb21-2"><a href="data-collection-wrangling.html#cb21-2" tabindex="-1"></a>raster_paths <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">list.files</span>(<span class="st">&quot;1_Data/3_YM/3_Interp_Grid/&quot;</span>, </span>
<span id="cb21-3"><a href="data-collection-wrangling.html#cb21-3" tabindex="-1"></a>                                             <span class="at">full.names =</span> T,<span class="at">recursive =</span> T, </span>
<span id="cb21-4"><a href="data-collection-wrangling.html#cb21-4" tabindex="-1"></a>                                             <span class="at">pattern =</span> <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.tif$&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-5"><a href="data-collection-wrangling.html#cb21-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, FIELD_TO_CLEAN)) <span class="sc">%&gt;%</span> </span>
<span id="cb21-6"><a href="data-collection-wrangling.html#cb21-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">filename =</span> <span class="fu">basename</span>(path),</span>
<span id="cb21-7"><a href="data-collection-wrangling.html#cb21-7" tabindex="-1"></a>         <span class="at">filename =</span> <span class="fu">str_remove</span>(filename, <span class="fu">paste0</span>(FIELD_TO_CLEAN,<span class="st">&quot;_&quot;</span>)),</span>
<span id="cb21-8"><a href="data-collection-wrangling.html#cb21-8" tabindex="-1"></a>         <span class="at">filename =</span> <span class="fu">str_remove</span>(filename, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">.tif$&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb21-9"><a href="data-collection-wrangling.html#cb21-9" tabindex="-1"></a>  <span class="fu">separate</span>(filename,<span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Crop&quot;</span>,<span class="st">&quot;Year&quot;</span>),<span class="at">sep =</span><span class="st">&quot;(?&lt;=[A-Za-z])(?=[0-9])&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-10"><a href="data-collection-wrangling.html#cb21-10" tabindex="-1"></a>  <span class="fu">arrange</span>(Crop, Year)</span>
<span id="cb21-11"><a href="data-collection-wrangling.html#cb21-11" tabindex="-1"></a></span>
<span id="cb21-12"><a href="data-collection-wrangling.html#cb21-12" tabindex="-1"></a><span class="co"># Function to load raster</span></span>
<span id="cb21-13"><a href="data-collection-wrangling.html#cb21-13" tabindex="-1"></a>read_rasters <span class="ot">&lt;-</span> <span class="cf">function</span>(x) {</span>
<span id="cb21-14"><a href="data-collection-wrangling.html#cb21-14" tabindex="-1"></a>  <span class="fu">raster</span>(x)</span>
<span id="cb21-15"><a href="data-collection-wrangling.html#cb21-15" tabindex="-1"></a>}</span>
<span id="cb21-16"><a href="data-collection-wrangling.html#cb21-16" tabindex="-1"></a></span>
<span id="cb21-17"><a href="data-collection-wrangling.html#cb21-17" tabindex="-1"></a><span class="co"># Read and stack rasters</span></span>
<span id="cb21-18"><a href="data-collection-wrangling.html#cb21-18" tabindex="-1"></a>raster_stack <span class="ot">&lt;-</span> raster_paths<span class="sc">$</span>path <span class="sc">%&gt;%</span></span>
<span id="cb21-19"><a href="data-collection-wrangling.html#cb21-19" tabindex="-1"></a>  <span class="fu">map</span>(read_rasters) <span class="sc">%&gt;%</span></span>
<span id="cb21-20"><a href="data-collection-wrangling.html#cb21-20" tabindex="-1"></a>  <span class="fu">stack</span>()</span>
<span id="cb21-21"><a href="data-collection-wrangling.html#cb21-21" tabindex="-1"></a></span>
<span id="cb21-22"><a href="data-collection-wrangling.html#cb21-22" tabindex="-1"></a>YM_final <span class="ot">&lt;-</span> <span class="fu">rasterToPoints</span>(raster_stack, <span class="at">spatial=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-23"><a href="data-collection-wrangling.html#cb21-23" tabindex="-1"></a>  <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb21-24"><a href="data-collection-wrangling.html#cb21-24" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">!</span>geometry, <span class="at">names_to =</span> <span class="st">&quot;CropYear&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Yield&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-25"><a href="data-collection-wrangling.html#cb21-25" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CropYear =</span> <span class="fu">str_remove</span>(CropYear, <span class="fu">paste0</span>(FIELD_TO_CLEAN,<span class="st">&quot;_&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb21-26"><a href="data-collection-wrangling.html#cb21-26" tabindex="-1"></a>  <span class="fu">st_transform</span>(<span class="at">crs=</span><span class="dv">32616</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-27"><a href="data-collection-wrangling.html#cb21-27" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">X =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">1</span>]),</span>
<span id="cb21-28"><a href="data-collection-wrangling.html#cb21-28" tabindex="-1"></a>                <span class="at">Y =</span> <span class="fu">as.numeric</span>(sf<span class="sc">::</span><span class="fu">st_coordinates</span>(.)[,<span class="dv">2</span>])) <span class="sc">%&gt;%</span> </span>
<span id="cb21-29"><a href="data-collection-wrangling.html#cb21-29" tabindex="-1"></a>  <span class="fu">separate</span>(CropYear, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Crop&quot;</span>, <span class="st">&quot;Year&quot;</span>), <span class="at">sep =</span> <span class="st">&quot;(?&lt;=[A-Za-z])(?=[0-9])&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb21-30"><a href="data-collection-wrangling.html#cb21-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">as.numeric</span>(Year))</span>
<span id="cb21-31"><a href="data-collection-wrangling.html#cb21-31" tabindex="-1"></a></span>
<span id="cb21-32"><a href="data-collection-wrangling.html#cb21-32" tabindex="-1"></a><span class="fu">write_sf</span>(YM_final,<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/4_YM_final/YM_&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;.shp&quot;</span>))</span></code></pre></div>
</div>
</div>
<div id="merge-ym-data-gcvi-data" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Merge YM data &amp; GCVI data<a href="data-collection-wrangling.html#merge-ym-data-gcvi-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p><strong>Path to rasters (Sentinel data) and clean yield monitor data</strong></p>
<p>Obtain the file paths for each field image where the GCVI has already been calculated. These images correspond to three key moments: the peak, 30 days before the peak (Peak_b3), and 30 days after the peak (Peak_30).</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="data-collection-wrangling.html#cb22-1" tabindex="-1"></a>vi_path <span class="ot">&lt;-</span></span>
<span id="cb22-2"><a href="data-collection-wrangling.html#cb22-2" tabindex="-1"></a>  <span class="fu">data.frame</span>(<span class="at">path =</span><span class="fu">list.files</span>(<span class="fu">c</span>(<span class="st">&quot;1_Data/2_Spatial_Layer/2_VI_raster/Peak_b3/&quot;</span>,</span>
<span id="cb22-3"><a href="data-collection-wrangling.html#cb22-3" tabindex="-1"></a>                                <span class="st">&quot;1_Data/2_Spatial_Layer/2_VI_raster/Peak/&quot;</span>,</span>
<span id="cb22-4"><a href="data-collection-wrangling.html#cb22-4" tabindex="-1"></a>                                <span class="st">&quot;1_Data/2_Spatial_Layer/2_VI_raster/Peak_30/&quot;</span>),</span>
<span id="cb22-5"><a href="data-collection-wrangling.html#cb22-5" tabindex="-1"></a>                              <span class="at">full.names=</span>T, <span class="at">pattern=</span> <span class="st">&quot;.tif&quot;</span>, <span class="at">recursive =</span> T)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-6"><a href="data-collection-wrangling.html#cb22-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">YM_path =</span><span class="fu">list.files</span>(<span class="st">&quot;1_Data/3_YM/4_YM_final&quot;</span>,</span>
<span id="cb22-7"><a href="data-collection-wrangling.html#cb22-7" tabindex="-1"></a>                             <span class="at">full.names=</span>T,<span class="at">recursive =</span> <span class="cn">TRUE</span>,</span>
<span id="cb22-8"><a href="data-collection-wrangling.html#cb22-8" tabindex="-1"></a>                             <span class="at">pattern=</span><span class="fu">paste0</span>(FIELD_TO_CLEAN,<span class="st">&quot;.shp&quot;</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb22-9"><a href="data-collection-wrangling.html#cb22-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Year =</span> <span class="fu">gsub</span>(<span class="st">&quot;.*_(20</span><span class="sc">\\</span><span class="st">d{2})_.*</span><span class="sc">\\</span><span class="st">.tif&quot;</span>, <span class="st">&quot;</span><span class="sc">\\</span><span class="st">1&quot;</span>, path),</span>
<span id="cb22-10"><a href="data-collection-wrangling.html#cb22-10" tabindex="-1"></a>         <span class="at">Moment =</span> <span class="fu">str_extract</span>(path, <span class="st">&quot;(?&lt;=2_VI_raster/)[^/]+(?=/)&quot;</span>),</span>
<span id="cb22-11"><a href="data-collection-wrangling.html#cb22-11" tabindex="-1"></a>         <span class="at">VI =</span> <span class="fu">str_extract</span>(path, <span class="st">&quot;(NDVI|EVI|GCVI)&quot;</span>),</span>
<span id="cb22-12"><a href="data-collection-wrangling.html#cb22-12" tabindex="-1"></a>         <span class="at">VI_moment =</span> <span class="fu">paste</span>(Moment,VI,<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-13"><a href="data-collection-wrangling.html#cb22-13" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">str_detect</span>(path, FIELD_TO_CLEAN)) <span class="sc">%&gt;%</span> </span>
<span id="cb22-14"><a href="data-collection-wrangling.html#cb22-14" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> Year, <span class="at">values_from =</span> path) <span class="sc">%&gt;%</span> </span>
<span id="cb22-15"><a href="data-collection-wrangling.html#cb22-15" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(VI <span class="sc">==</span> <span class="st">&quot;GCVI&quot;</span>)</span></code></pre></div>
<p><strong>Join all rasters to a dataframe</strong></p>
<p>Overlay all the rasters containing GCVI data for the field and clip them using the field boundary. Additionally, extract the relevant information from the rasters.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="data-collection-wrangling.html#cb23-1" tabindex="-1"></a>VImoments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="fu">unique</span>(vi_path<span class="sc">$</span>VI_moment))</span>
<span id="cb23-2"><a href="data-collection-wrangling.html#cb23-2" tabindex="-1"></a><span class="cf">for</span> (VIm <span class="cf">in</span> VImoments) {</span>
<span id="cb23-3"><a href="data-collection-wrangling.html#cb23-3" tabindex="-1"></a>  viPath <span class="ot">&lt;-</span> vi_path <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(VI_moment <span class="sc">==</span> VIm)</span>
<span id="cb23-4"><a href="data-collection-wrangling.html#cb23-4" tabindex="-1"></a>  </span>
<span id="cb23-5"><a href="data-collection-wrangling.html#cb23-5" tabindex="-1"></a>  YM <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(viPath[<span class="dv">1</span>][[<span class="dv">1</span>]]) <span class="sc">%&gt;%</span> </span>
<span id="cb23-6"><a href="data-collection-wrangling.html#cb23-6" tabindex="-1"></a>    <span class="fu">st_transform</span>(<span class="st">&quot;epsg:4326&quot;</span>)</span>
<span id="cb23-7"><a href="data-collection-wrangling.html#cb23-7" tabindex="-1"></a>  points <span class="ot">&lt;-</span> YM <span class="sc">%&gt;%</span> <span class="fu">st_centroid</span>()</span>
<span id="cb23-8"><a href="data-collection-wrangling.html#cb23-8" tabindex="-1"></a>  </span>
<span id="cb23-9"><a href="data-collection-wrangling.html#cb23-9" tabindex="-1"></a>  str_crs <span class="ot">&lt;-</span> <span class="st">&quot;+init=epsg:4326&quot;</span> </span>
<span id="cb23-10"><a href="data-collection-wrangling.html#cb23-10" tabindex="-1"></a>  </span>
<span id="cb23-11"><a href="data-collection-wrangling.html#cb23-11" tabindex="-1"></a>  y17 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">5</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-12"><a href="data-collection-wrangling.html#cb23-12" tabindex="-1"></a>  <span class="fu">crs</span>(y17) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-13"><a href="data-collection-wrangling.html#cb23-13" tabindex="-1"></a>  <span class="fu">names</span>(y17) <span class="ot">&lt;-</span> <span class="st">&quot;2017&quot;</span></span>
<span id="cb23-14"><a href="data-collection-wrangling.html#cb23-14" tabindex="-1"></a></span>
<span id="cb23-15"><a href="data-collection-wrangling.html#cb23-15" tabindex="-1"></a>  y18 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">6</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-16"><a href="data-collection-wrangling.html#cb23-16" tabindex="-1"></a>  <span class="fu">crs</span>(y18) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-17"><a href="data-collection-wrangling.html#cb23-17" tabindex="-1"></a>  <span class="fu">names</span>(y18) <span class="ot">&lt;-</span> <span class="st">&quot;2018&quot;</span></span>
<span id="cb23-18"><a href="data-collection-wrangling.html#cb23-18" tabindex="-1"></a></span>
<span id="cb23-19"><a href="data-collection-wrangling.html#cb23-19" tabindex="-1"></a>  y19 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">7</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-20"><a href="data-collection-wrangling.html#cb23-20" tabindex="-1"></a>  <span class="fu">crs</span>(y19) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-21"><a href="data-collection-wrangling.html#cb23-21" tabindex="-1"></a>  <span class="fu">names</span>(y19) <span class="ot">&lt;-</span> <span class="st">&quot;2019&quot;</span></span>
<span id="cb23-22"><a href="data-collection-wrangling.html#cb23-22" tabindex="-1"></a></span>
<span id="cb23-23"><a href="data-collection-wrangling.html#cb23-23" tabindex="-1"></a>  y20 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">8</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-24"><a href="data-collection-wrangling.html#cb23-24" tabindex="-1"></a>  <span class="fu">crs</span>(y20) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-25"><a href="data-collection-wrangling.html#cb23-25" tabindex="-1"></a>  <span class="fu">names</span>(y20) <span class="ot">&lt;-</span> <span class="st">&quot;2020&quot;</span></span>
<span id="cb23-26"><a href="data-collection-wrangling.html#cb23-26" tabindex="-1"></a>  </span>
<span id="cb23-27"><a href="data-collection-wrangling.html#cb23-27" tabindex="-1"></a>  y21 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">9</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-28"><a href="data-collection-wrangling.html#cb23-28" tabindex="-1"></a>  <span class="fu">crs</span>(y21) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-29"><a href="data-collection-wrangling.html#cb23-29" tabindex="-1"></a>  <span class="fu">names</span>(y21) <span class="ot">&lt;-</span> <span class="st">&quot;2021&quot;</span></span>
<span id="cb23-30"><a href="data-collection-wrangling.html#cb23-30" tabindex="-1"></a>  </span>
<span id="cb23-31"><a href="data-collection-wrangling.html#cb23-31" tabindex="-1"></a>  y22 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">10</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-32"><a href="data-collection-wrangling.html#cb23-32" tabindex="-1"></a>  <span class="fu">crs</span>(y22) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-33"><a href="data-collection-wrangling.html#cb23-33" tabindex="-1"></a>  <span class="fu">names</span>(y22) <span class="ot">&lt;-</span> <span class="st">&quot;2022&quot;</span></span>
<span id="cb23-34"><a href="data-collection-wrangling.html#cb23-34" tabindex="-1"></a>  </span>
<span id="cb23-35"><a href="data-collection-wrangling.html#cb23-35" tabindex="-1"></a>  y23 <span class="ot">&lt;-</span><span class="fu">raster</span>(viPath[<span class="dv">11</span>][[<span class="dv">1</span>]])</span>
<span id="cb23-36"><a href="data-collection-wrangling.html#cb23-36" tabindex="-1"></a>  <span class="fu">crs</span>(y23) <span class="ot">&lt;-</span> str_crs</span>
<span id="cb23-37"><a href="data-collection-wrangling.html#cb23-37" tabindex="-1"></a>  <span class="fu">names</span>(y23) <span class="ot">&lt;-</span> <span class="st">&quot;2023&quot;</span></span>
<span id="cb23-38"><a href="data-collection-wrangling.html#cb23-38" tabindex="-1"></a>  </span>
<span id="cb23-39"><a href="data-collection-wrangling.html#cb23-39" tabindex="-1"></a>  <span class="do">## Stack/overlap the layers</span></span>
<span id="cb23-40"><a href="data-collection-wrangling.html#cb23-40" tabindex="-1"></a>  layers_stacked <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">stack</span>(y17,y18,y19,y20,y21,y22,y23)</span>
<span id="cb23-41"><a href="data-collection-wrangling.html#cb23-41" tabindex="-1"></a></span>
<span id="cb23-42"><a href="data-collection-wrangling.html#cb23-42" tabindex="-1"></a>  data_extracted <span class="ot">&lt;-</span> raster<span class="sc">::</span><span class="fu">extract</span>(layers_stacked, points, </span>
<span id="cb23-43"><a href="data-collection-wrangling.html#cb23-43" tabindex="-1"></a>                                    <span class="at">fun=</span><span class="st">&#39;median&#39;</span>, <span class="at">df=</span><span class="cn">TRUE</span>) <span class="sc">%&gt;%</span></span>
<span id="cb23-44"><a href="data-collection-wrangling.html#cb23-44" tabindex="-1"></a>      tibble<span class="sc">::</span><span class="fu">rownames_to_column</span>(<span class="at">var =</span> <span class="st">&quot;Iden&quot;</span>)</span>
<span id="cb23-45"><a href="data-collection-wrangling.html#cb23-45" tabindex="-1"></a>  </span>
<span id="cb23-46"><a href="data-collection-wrangling.html#cb23-46" tabindex="-1"></a>  merge <span class="ot">&lt;-</span> <span class="fu">bind_cols</span>(points, data_extracted) <span class="sc">%&gt;%</span></span>
<span id="cb23-47"><a href="data-collection-wrangling.html#cb23-47" tabindex="-1"></a>    <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb23-48"><a href="data-collection-wrangling.html#cb23-48" tabindex="-1"></a>    <span class="fu">st_as_sf</span>(<span class="at">coords =</span> <span class="fu">c</span>(<span class="st">&quot;X&quot;</span>, <span class="st">&quot;Y&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb23-49"><a href="data-collection-wrangling.html#cb23-49" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;X20&quot;</span>),<span class="at">names_to =</span> <span class="st">&quot;year_VI&quot;</span>, <span class="at">values_to =</span> VIm) <span class="sc">%&gt;%</span> </span>
<span id="cb23-50"><a href="data-collection-wrangling.html#cb23-50" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">year_VI =</span> <span class="fu">as.numeric</span>(<span class="fu">str_remove</span>(year_VI, <span class="st">&quot;X&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb23-51"><a href="data-collection-wrangling.html#cb23-51" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Year <span class="sc">==</span> year_VI) <span class="sc">%&gt;%</span> </span>
<span id="cb23-52"><a href="data-collection-wrangling.html#cb23-52" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(Crop, Year, Yield, <span class="fu">starts_with</span>(VIm),geometry)</span>
<span id="cb23-53"><a href="data-collection-wrangling.html#cb23-53" tabindex="-1"></a>  </span>
<span id="cb23-54"><a href="data-collection-wrangling.html#cb23-54" tabindex="-1"></a>  <span class="fu">write_sf</span>(merge,<span class="fu">paste0</span>(<span class="st">&quot;1_Data/2_Spatial_Layer/4_VI_YM/&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;_&quot;</span>,VIm,<span class="st">&quot;.shp&quot;</span>))</span>
<span id="cb23-55"><a href="data-collection-wrangling.html#cb23-55" tabindex="-1"></a>}</span></code></pre></div>
<p><strong>Join yield monitor data and GCVI data</strong></p>
<p>Merge the satellite data (GCVI at the peak, 30 days before, and 30 days after) with the yield monitor data across multiple years.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="data-collection-wrangling.html#cb24-1" tabindex="-1"></a><span class="co"># Base directory and field specifics</span></span>
<span id="cb24-2"><a href="data-collection-wrangling.html#cb24-2" tabindex="-1"></a>base_dir <span class="ot">&lt;-</span> <span class="st">&quot;1_Data/2_Spatial_Layer/4_VI_YM/&quot;</span></span>
<span id="cb24-3"><a href="data-collection-wrangling.html#cb24-3" tabindex="-1"></a>indices <span class="ot">&lt;-</span> <span class="st">&quot;GCVI&quot;</span></span>
<span id="cb24-4"><a href="data-collection-wrangling.html#cb24-4" tabindex="-1"></a>moments <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;_b3&quot;</span>,<span class="st">&quot;&quot;</span>,<span class="st">&quot;_30&quot;</span>)</span>
<span id="cb24-5"><a href="data-collection-wrangling.html#cb24-5" tabindex="-1"></a></span>
<span id="cb24-6"><a href="data-collection-wrangling.html#cb24-6" tabindex="-1"></a><span class="co"># Initial data load and filtering</span></span>
<span id="cb24-7"><a href="data-collection-wrangling.html#cb24-7" tabindex="-1"></a>main_data <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/4_YM_final/YM_&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;.shp&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb24-8"><a href="data-collection-wrangling.html#cb24-8" tabindex="-1"></a>  <span class="fu">filter</span>(Year <span class="sc">&gt;</span> <span class="dv">2016</span>)</span>
<span id="cb24-9"><a href="data-collection-wrangling.html#cb24-9" tabindex="-1"></a></span>
<span id="cb24-10"><a href="data-collection-wrangling.html#cb24-10" tabindex="-1"></a><span class="co"># Loop over moments and indices</span></span>
<span id="cb24-11"><a href="data-collection-wrangling.html#cb24-11" tabindex="-1"></a><span class="cf">for</span> (moment <span class="cf">in</span> moments) {</span>
<span id="cb24-12"><a href="data-collection-wrangling.html#cb24-12" tabindex="-1"></a>  <span class="cf">for</span> (vi <span class="cf">in</span> indices) {</span>
<span id="cb24-13"><a href="data-collection-wrangling.html#cb24-13" tabindex="-1"></a>    file_path <span class="ot">&lt;-</span> <span class="fu">paste0</span>(base_dir, FIELD_TO_CLEAN, <span class="st">&quot;_Peak&quot;</span>, moment, <span class="st">&quot;_&quot;</span>, vi, <span class="st">&quot;.shp&quot;</span>)</span>
<span id="cb24-14"><a href="data-collection-wrangling.html#cb24-14" tabindex="-1"></a>    shape_data <span class="ot">&lt;-</span> <span class="fu">read_sf</span>(file_path) <span class="sc">%&gt;%</span></span>
<span id="cb24-15"><a href="data-collection-wrangling.html#cb24-15" tabindex="-1"></a>      <span class="fu">st_set_crs</span>(<span class="dv">4326</span>) <span class="sc">%&gt;%</span></span>
<span id="cb24-16"><a href="data-collection-wrangling.html#cb24-16" tabindex="-1"></a>      <span class="fu">mutate</span>(<span class="at">X =</span> <span class="fu">as.numeric</span>(<span class="fu">st_coordinates</span>(.)[, <span class="dv">1</span>]),</span>
<span id="cb24-17"><a href="data-collection-wrangling.html#cb24-17" tabindex="-1"></a>             <span class="at">Y =</span> <span class="fu">as.numeric</span>(<span class="fu">st_coordinates</span>(.)[, <span class="dv">2</span>])) <span class="sc">%&gt;%</span></span>
<span id="cb24-18"><a href="data-collection-wrangling.html#cb24-18" tabindex="-1"></a>      <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span></span>
<span id="cb24-19"><a href="data-collection-wrangling.html#cb24-19" tabindex="-1"></a>      <span class="fu">as.data.frame</span>()</span>
<span id="cb24-20"><a href="data-collection-wrangling.html#cb24-20" tabindex="-1"></a></span>
<span id="cb24-21"><a href="data-collection-wrangling.html#cb24-21" tabindex="-1"></a>    main_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(main_data,shape_data,<span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>,<span class="st">&quot;X&quot;</span>,<span class="st">&quot;Y&quot;</span>,<span class="st">&quot;Crop&quot;</span>,<span class="st">&quot;Yield&quot;</span>))</span>
<span id="cb24-22"><a href="data-collection-wrangling.html#cb24-22" tabindex="-1"></a>  }</span>
<span id="cb24-23"><a href="data-collection-wrangling.html#cb24-23" tabindex="-1"></a>}</span>
<span id="cb24-24"><a href="data-collection-wrangling.html#cb24-24" tabindex="-1"></a></span>
<span id="cb24-25"><a href="data-collection-wrangling.html#cb24-25" tabindex="-1"></a>main_data <span class="ot">&lt;-</span> main_data <span class="sc">%&gt;%</span> </span>
<span id="cb24-26"><a href="data-collection-wrangling.html#cb24-26" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Crop, Year, Yield, X,Y, <span class="fu">starts_with</span>(<span class="st">&quot;P&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb24-27"><a href="data-collection-wrangling.html#cb24-27" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">Crop =</span> Crop)</span>
<span id="cb24-28"><a href="data-collection-wrangling.html#cb24-28" tabindex="-1"></a><span class="fu">names</span>(main_data)</span></code></pre></div>
<pre><code>## [1] &quot;Crop&quot;      &quot;Year&quot;      &quot;Yield&quot;     &quot;X&quot;         &quot;Y&quot;         &quot;P_3_GCV&quot;  
## [7] &quot;Peak_GCVI&quot; &quot;P_30_GC&quot;   &quot;geometry&quot;</code></pre>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="data-collection-wrangling.html#cb26-1" tabindex="-1"></a>sf<span class="sc">::</span><span class="fu">write_sf</span>(main_data, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/2_Spatial_Layer/5_VI_YM_df/&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;.shp&quot;</span>))</span>
<span id="cb26-2"><a href="data-collection-wrangling.html#cb26-2" tabindex="-1"></a></span>
<span id="cb26-3"><a href="data-collection-wrangling.html#cb26-3" tabindex="-1"></a><span class="co"># Check the final output</span></span>
<span id="cb26-4"><a href="data-collection-wrangling.html#cb26-4" tabindex="-1"></a><span class="co">#print(main_data)</span></span></code></pre></div>
</div>
<div id="cumulative-precipitation-period" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> Cumulative precipitation period<a href="data-collection-wrangling.html#cumulative-precipitation-period" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="data-collection-wrangling.html#cb27-1" tabindex="-1"></a>path <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="fu">paste0</span>(<span class="st">&quot;1_Data/3_YM/1_Original/&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;/Maize&quot;</span>),</span>
<span id="cb27-2"><a href="data-collection-wrangling.html#cb27-2" tabindex="-1"></a>                                       <span class="at">full.names =</span> T, <span class="at">pattern =</span> <span class="st">&quot;.shp&quot;</span>, <span class="at">recursive =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb27-3"><a href="data-collection-wrangling.html#cb27-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">row_number</span>()<span class="sc">==</span><span class="dv">1</span>)</span>
<span id="cb27-4"><a href="data-collection-wrangling.html#cb27-4" tabindex="-1"></a></span>
<span id="cb27-5"><a href="data-collection-wrangling.html#cb27-5" tabindex="-1"></a>start_Year <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">unique</span>(main_data<span class="sc">$</span>Year))</span>
<span id="cb27-6"><a href="data-collection-wrangling.html#cb27-6" tabindex="-1"></a>end_Year <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">unique</span>(main_data<span class="sc">$</span>Year))</span></code></pre></div>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="data-collection-wrangling.html#cb28-1" tabindex="-1"></a>pp_chirps <span class="ot">&lt;-</span> <span class="fu">get_chirps</span>(<span class="fu">read_sf</span>(path) <span class="sc">%&gt;%</span>dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>),</span>
<span id="cb28-2"><a href="data-collection-wrangling.html#cb28-2" tabindex="-1"></a>                        <span class="at">dates =</span> <span class="fu">c</span>(<span class="fu">paste0</span>(start_Year,<span class="st">&quot;-01-01&quot;</span>),</span>
<span id="cb28-3"><a href="data-collection-wrangling.html#cb28-3" tabindex="-1"></a>                                  <span class="fu">paste0</span>(end_Year,<span class="st">&quot;-12-31&quot;</span>)),</span>
<span id="cb28-4"><a href="data-collection-wrangling.html#cb28-4" tabindex="-1"></a>                        <span class="at">server =</span> <span class="st">&quot;ClimateSERV&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb28-5"><a href="data-collection-wrangling.html#cb28-5" tabindex="-1"></a>  <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb28-6"><a href="data-collection-wrangling.html#cb28-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">doy =</span> <span class="fu">yday</span>(date),</span>
<span id="cb28-7"><a href="data-collection-wrangling.html#cb28-7" tabindex="-1"></a>         <span class="at">month =</span> <span class="fu">month</span>(date),</span>
<span id="cb28-8"><a href="data-collection-wrangling.html#cb28-8" tabindex="-1"></a>         <span class="at">Year =</span> <span class="fu">year</span>(date))</span></code></pre></div>
<pre><code>## Fetching data from ClimateSERV</code></pre>
<pre><code>## Getting your request...</code></pre>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="data-collection-wrangling.html#cb31-1" tabindex="-1"></a>CP_period <span class="ot">&lt;-</span> YM_final <span class="sc">%&gt;%</span> </span>
<span id="cb31-2"><a href="data-collection-wrangling.html#cb31-2" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(Year) <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="data-collection-wrangling.html#cb31-3" tabindex="-1"></a>  <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-4"><a href="data-collection-wrangling.html#cb31-4" tabindex="-1"></a>  <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-5"><a href="data-collection-wrangling.html#cb31-5" tabindex="-1"></a>  <span class="fu">left_join</span>(pp_chirps, <span class="at">by =</span> <span class="st">&quot;Year&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-6"><a href="data-collection-wrangling.html#cb31-6" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Year<span class="sc">&gt;</span><span class="dv">2016</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-7"><a href="data-collection-wrangling.html#cb31-7" tabindex="-1"></a>  <span class="fu">group_by</span>(Year) <span class="sc">%&gt;%</span></span>
<span id="cb31-8"><a href="data-collection-wrangling.html#cb31-8" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb31-9"><a href="data-collection-wrangling.html#cb31-9" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb31-10"><a href="data-collection-wrangling.html#cb31-10" tabindex="-1"></a>    <span class="do">## April 1 ##</span></span>
<span id="cb31-11"><a href="data-collection-wrangling.html#cb31-11" tabindex="-1"></a>    <span class="at">CRA1_180 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-12"><a href="data-collection-wrangling.html#cb31-12" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-13"><a href="data-collection-wrangling.html#cb31-13" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_180 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-14"><a href="data-collection-wrangling.html#cb31-14" tabindex="-1"></a>    <span class="at">CRA1_170 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-15"><a href="data-collection-wrangling.html#cb31-15" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">170</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-16"><a href="data-collection-wrangling.html#cb31-16" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_170 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-17"><a href="data-collection-wrangling.html#cb31-17" tabindex="-1"></a>    <span class="at">CRA1_160 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-18"><a href="data-collection-wrangling.html#cb31-18" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">160</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-19"><a href="data-collection-wrangling.html#cb31-19" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_160 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-20"><a href="data-collection-wrangling.html#cb31-20" tabindex="-1"></a>    <span class="at">CRA1_150 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-21"><a href="data-collection-wrangling.html#cb31-21" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">150</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-22"><a href="data-collection-wrangling.html#cb31-22" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_150 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-23"><a href="data-collection-wrangling.html#cb31-23" tabindex="-1"></a>    <span class="at">CRA1_140 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-24"><a href="data-collection-wrangling.html#cb31-24" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">140</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-25"><a href="data-collection-wrangling.html#cb31-25" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_140 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-26"><a href="data-collection-wrangling.html#cb31-26" tabindex="-1"></a>    <span class="at">CRA1_130 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-27"><a href="data-collection-wrangling.html#cb31-27" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">130</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-28"><a href="data-collection-wrangling.html#cb31-28" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_130 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-29"><a href="data-collection-wrangling.html#cb31-29" tabindex="-1"></a>    <span class="at">CRA1_120 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-30"><a href="data-collection-wrangling.html#cb31-30" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">120</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-31"><a href="data-collection-wrangling.html#cb31-31" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_120 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-32"><a href="data-collection-wrangling.html#cb31-32" tabindex="-1"></a>    <span class="at">CRA1_110 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-33"><a href="data-collection-wrangling.html#cb31-33" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">110</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-34"><a href="data-collection-wrangling.html#cb31-34" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_110 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-35"><a href="data-collection-wrangling.html#cb31-35" tabindex="-1"></a>    <span class="at">CRA1_100 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-36"><a href="data-collection-wrangling.html#cb31-36" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">100</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-37"><a href="data-collection-wrangling.html#cb31-37" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA1_100 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-38"><a href="data-collection-wrangling.html#cb31-38" tabindex="-1"></a>    <span class="at">CRA1_90 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-39"><a href="data-collection-wrangling.html#cb31-39" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">90</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-40"><a href="data-collection-wrangling.html#cb31-40" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_90 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-41"><a href="data-collection-wrangling.html#cb31-41" tabindex="-1"></a>    <span class="at">CRA1_80 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-42"><a href="data-collection-wrangling.html#cb31-42" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">80</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-43"><a href="data-collection-wrangling.html#cb31-43" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_80 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-44"><a href="data-collection-wrangling.html#cb31-44" tabindex="-1"></a>    <span class="at">CRA1_70 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-45"><a href="data-collection-wrangling.html#cb31-45" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">70</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-46"><a href="data-collection-wrangling.html#cb31-46" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_70 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-47"><a href="data-collection-wrangling.html#cb31-47" tabindex="-1"></a>    <span class="at">CRA1_60 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-48"><a href="data-collection-wrangling.html#cb31-48" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">60</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-49"><a href="data-collection-wrangling.html#cb31-49" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_60 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-50"><a href="data-collection-wrangling.html#cb31-50" tabindex="-1"></a>    <span class="at">CRA1_50 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-51"><a href="data-collection-wrangling.html#cb31-51" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">50</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-52"><a href="data-collection-wrangling.html#cb31-52" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_50 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-53"><a href="data-collection-wrangling.html#cb31-53" tabindex="-1"></a>    <span class="at">CRA1_40 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-54"><a href="data-collection-wrangling.html#cb31-54" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">40</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-55"><a href="data-collection-wrangling.html#cb31-55" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_40 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-56"><a href="data-collection-wrangling.html#cb31-56" tabindex="-1"></a>    <span class="at">CRA1_30 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-57"><a href="data-collection-wrangling.html#cb31-57" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">30</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-58"><a href="data-collection-wrangling.html#cb31-58" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_30 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-59"><a href="data-collection-wrangling.html#cb31-59" tabindex="-1"></a>    <span class="at">CRA1_20 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-60"><a href="data-collection-wrangling.html#cb31-60" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">20</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-61"><a href="data-collection-wrangling.html#cb31-61" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_20 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-62"><a href="data-collection-wrangling.html#cb31-62" tabindex="-1"></a>    <span class="at">CRA1_10 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-63"><a href="data-collection-wrangling.html#cb31-63" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">90</span> <span class="sc">+</span> <span class="dv">10</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">90</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-64"><a href="data-collection-wrangling.html#cb31-64" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA1_10 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-65"><a href="data-collection-wrangling.html#cb31-65" tabindex="-1"></a>    <span class="do">## April 10##</span></span>
<span id="cb31-66"><a href="data-collection-wrangling.html#cb31-66" tabindex="-1"></a>    <span class="at">CRA2_180 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-67"><a href="data-collection-wrangling.html#cb31-67" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-68"><a href="data-collection-wrangling.html#cb31-68" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_180 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-69"><a href="data-collection-wrangling.html#cb31-69" tabindex="-1"></a>    <span class="at">CRA2_170 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-70"><a href="data-collection-wrangling.html#cb31-70" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">170</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-71"><a href="data-collection-wrangling.html#cb31-71" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_170 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-72"><a href="data-collection-wrangling.html#cb31-72" tabindex="-1"></a>    <span class="at">CRA2_160 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-73"><a href="data-collection-wrangling.html#cb31-73" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">160</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-74"><a href="data-collection-wrangling.html#cb31-74" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_160 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-75"><a href="data-collection-wrangling.html#cb31-75" tabindex="-1"></a>    <span class="at">CRA2_150 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-76"><a href="data-collection-wrangling.html#cb31-76" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">150</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-77"><a href="data-collection-wrangling.html#cb31-77" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_150 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-78"><a href="data-collection-wrangling.html#cb31-78" tabindex="-1"></a>    <span class="at">CRA2_140 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-79"><a href="data-collection-wrangling.html#cb31-79" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">140</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-80"><a href="data-collection-wrangling.html#cb31-80" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_140 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-81"><a href="data-collection-wrangling.html#cb31-81" tabindex="-1"></a>    <span class="at">CRA2_130 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-82"><a href="data-collection-wrangling.html#cb31-82" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">130</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-83"><a href="data-collection-wrangling.html#cb31-83" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_130 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-84"><a href="data-collection-wrangling.html#cb31-84" tabindex="-1"></a>    <span class="at">CRA2_120 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-85"><a href="data-collection-wrangling.html#cb31-85" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">120</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-86"><a href="data-collection-wrangling.html#cb31-86" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_120 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-87"><a href="data-collection-wrangling.html#cb31-87" tabindex="-1"></a>    <span class="at">CRA2_110 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-88"><a href="data-collection-wrangling.html#cb31-88" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">110</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-89"><a href="data-collection-wrangling.html#cb31-89" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_110 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-90"><a href="data-collection-wrangling.html#cb31-90" tabindex="-1"></a>    <span class="at">CRA2_100 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-91"><a href="data-collection-wrangling.html#cb31-91" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">100</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-92"><a href="data-collection-wrangling.html#cb31-92" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA2_100 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-93"><a href="data-collection-wrangling.html#cb31-93" tabindex="-1"></a>    <span class="at">CRA2_90 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-94"><a href="data-collection-wrangling.html#cb31-94" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">90</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-95"><a href="data-collection-wrangling.html#cb31-95" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_90 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-96"><a href="data-collection-wrangling.html#cb31-96" tabindex="-1"></a>    <span class="at">CRA2_80 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-97"><a href="data-collection-wrangling.html#cb31-97" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">80</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-98"><a href="data-collection-wrangling.html#cb31-98" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_80 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-99"><a href="data-collection-wrangling.html#cb31-99" tabindex="-1"></a>    <span class="at">CRA2_70 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-100"><a href="data-collection-wrangling.html#cb31-100" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">70</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-101"><a href="data-collection-wrangling.html#cb31-101" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_70 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-102"><a href="data-collection-wrangling.html#cb31-102" tabindex="-1"></a>    <span class="at">CRA2_60 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-103"><a href="data-collection-wrangling.html#cb31-103" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">60</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-104"><a href="data-collection-wrangling.html#cb31-104" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_60 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-105"><a href="data-collection-wrangling.html#cb31-105" tabindex="-1"></a>    <span class="at">CRA2_50 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-106"><a href="data-collection-wrangling.html#cb31-106" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">50</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-107"><a href="data-collection-wrangling.html#cb31-107" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_50 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-108"><a href="data-collection-wrangling.html#cb31-108" tabindex="-1"></a>    <span class="at">CRA2_40 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-109"><a href="data-collection-wrangling.html#cb31-109" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">40</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-110"><a href="data-collection-wrangling.html#cb31-110" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_40 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-111"><a href="data-collection-wrangling.html#cb31-111" tabindex="-1"></a>    <span class="at">CRA2_30 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-112"><a href="data-collection-wrangling.html#cb31-112" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">30</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-113"><a href="data-collection-wrangling.html#cb31-113" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_30 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-114"><a href="data-collection-wrangling.html#cb31-114" tabindex="-1"></a>    <span class="at">CRA2_20 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-115"><a href="data-collection-wrangling.html#cb31-115" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">20</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-116"><a href="data-collection-wrangling.html#cb31-116" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_20 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-117"><a href="data-collection-wrangling.html#cb31-117" tabindex="-1"></a>    <span class="at">CRA2_10 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-118"><a href="data-collection-wrangling.html#cb31-118" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">99</span> <span class="sc">+</span> <span class="dv">10</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">99</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-119"><a href="data-collection-wrangling.html#cb31-119" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA2_10 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-120"><a href="data-collection-wrangling.html#cb31-120" tabindex="-1"></a>    </span>
<span id="cb31-121"><a href="data-collection-wrangling.html#cb31-121" tabindex="-1"></a>    <span class="do">## April 20##</span></span>
<span id="cb31-122"><a href="data-collection-wrangling.html#cb31-122" tabindex="-1"></a>    <span class="at">CRA3_180 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-123"><a href="data-collection-wrangling.html#cb31-123" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-124"><a href="data-collection-wrangling.html#cb31-124" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_180 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-125"><a href="data-collection-wrangling.html#cb31-125" tabindex="-1"></a>    <span class="at">CRA3_170 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-126"><a href="data-collection-wrangling.html#cb31-126" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">170</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-127"><a href="data-collection-wrangling.html#cb31-127" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_170 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-128"><a href="data-collection-wrangling.html#cb31-128" tabindex="-1"></a>    <span class="at">CRA3_160 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-129"><a href="data-collection-wrangling.html#cb31-129" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">160</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-130"><a href="data-collection-wrangling.html#cb31-130" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_160 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-131"><a href="data-collection-wrangling.html#cb31-131" tabindex="-1"></a>    <span class="at">CRA3_150 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-132"><a href="data-collection-wrangling.html#cb31-132" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">150</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-133"><a href="data-collection-wrangling.html#cb31-133" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_150 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-134"><a href="data-collection-wrangling.html#cb31-134" tabindex="-1"></a>    <span class="at">CRA3_140 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-135"><a href="data-collection-wrangling.html#cb31-135" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">140</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-136"><a href="data-collection-wrangling.html#cb31-136" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_140 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-137"><a href="data-collection-wrangling.html#cb31-137" tabindex="-1"></a>    <span class="at">CRA3_130 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-138"><a href="data-collection-wrangling.html#cb31-138" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">130</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-139"><a href="data-collection-wrangling.html#cb31-139" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_130 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-140"><a href="data-collection-wrangling.html#cb31-140" tabindex="-1"></a>    <span class="at">CRA3_120 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-141"><a href="data-collection-wrangling.html#cb31-141" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">120</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-142"><a href="data-collection-wrangling.html#cb31-142" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_120 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-143"><a href="data-collection-wrangling.html#cb31-143" tabindex="-1"></a>    <span class="at">CRA3_110 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-144"><a href="data-collection-wrangling.html#cb31-144" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">110</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-145"><a href="data-collection-wrangling.html#cb31-145" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_110 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-146"><a href="data-collection-wrangling.html#cb31-146" tabindex="-1"></a>    <span class="at">CRA3_100 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-147"><a href="data-collection-wrangling.html#cb31-147" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">100</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-148"><a href="data-collection-wrangling.html#cb31-148" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRA3_100 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-149"><a href="data-collection-wrangling.html#cb31-149" tabindex="-1"></a>    <span class="at">CRA3_90 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-150"><a href="data-collection-wrangling.html#cb31-150" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">90</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-151"><a href="data-collection-wrangling.html#cb31-151" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_90 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-152"><a href="data-collection-wrangling.html#cb31-152" tabindex="-1"></a>    <span class="at">CRA3_80 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-153"><a href="data-collection-wrangling.html#cb31-153" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">80</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-154"><a href="data-collection-wrangling.html#cb31-154" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_80 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-155"><a href="data-collection-wrangling.html#cb31-155" tabindex="-1"></a>    <span class="at">CRA3_70 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-156"><a href="data-collection-wrangling.html#cb31-156" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">70</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-157"><a href="data-collection-wrangling.html#cb31-157" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_70 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-158"><a href="data-collection-wrangling.html#cb31-158" tabindex="-1"></a>    <span class="at">CRA3_60 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-159"><a href="data-collection-wrangling.html#cb31-159" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">60</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-160"><a href="data-collection-wrangling.html#cb31-160" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_60 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-161"><a href="data-collection-wrangling.html#cb31-161" tabindex="-1"></a>    <span class="at">CRA3_50 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-162"><a href="data-collection-wrangling.html#cb31-162" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">50</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-163"><a href="data-collection-wrangling.html#cb31-163" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_50 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-164"><a href="data-collection-wrangling.html#cb31-164" tabindex="-1"></a>    <span class="at">CRA3_40 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-165"><a href="data-collection-wrangling.html#cb31-165" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">40</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-166"><a href="data-collection-wrangling.html#cb31-166" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_40 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-167"><a href="data-collection-wrangling.html#cb31-167" tabindex="-1"></a>    <span class="at">CRA3_30 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-168"><a href="data-collection-wrangling.html#cb31-168" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">30</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-169"><a href="data-collection-wrangling.html#cb31-169" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_30 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-170"><a href="data-collection-wrangling.html#cb31-170" tabindex="-1"></a>    <span class="at">CRA3_20 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-171"><a href="data-collection-wrangling.html#cb31-171" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">20</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-172"><a href="data-collection-wrangling.html#cb31-172" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_20 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-173"><a href="data-collection-wrangling.html#cb31-173" tabindex="-1"></a>    <span class="at">CRA3_10 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-174"><a href="data-collection-wrangling.html#cb31-174" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">109</span> <span class="sc">+</span> <span class="dv">10</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">109</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-175"><a href="data-collection-wrangling.html#cb31-175" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRA3_10 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-176"><a href="data-collection-wrangling.html#cb31-176" tabindex="-1"></a>    </span>
<span id="cb31-177"><a href="data-collection-wrangling.html#cb31-177" tabindex="-1"></a>    </span>
<span id="cb31-178"><a href="data-collection-wrangling.html#cb31-178" tabindex="-1"></a>    <span class="do">## May 1##</span></span>
<span id="cb31-179"><a href="data-collection-wrangling.html#cb31-179" tabindex="-1"></a>    <span class="at">CRM1_180 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-180"><a href="data-collection-wrangling.html#cb31-180" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">180</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-181"><a href="data-collection-wrangling.html#cb31-181" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_180 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-182"><a href="data-collection-wrangling.html#cb31-182" tabindex="-1"></a>    <span class="at">CRM1_170 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-183"><a href="data-collection-wrangling.html#cb31-183" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">170</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-184"><a href="data-collection-wrangling.html#cb31-184" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_170 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-185"><a href="data-collection-wrangling.html#cb31-185" tabindex="-1"></a>    <span class="at">CRM1_160 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-186"><a href="data-collection-wrangling.html#cb31-186" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">160</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-187"><a href="data-collection-wrangling.html#cb31-187" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_160 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-188"><a href="data-collection-wrangling.html#cb31-188" tabindex="-1"></a>    <span class="at">CRM1_150 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-189"><a href="data-collection-wrangling.html#cb31-189" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">150</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-190"><a href="data-collection-wrangling.html#cb31-190" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_150 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-191"><a href="data-collection-wrangling.html#cb31-191" tabindex="-1"></a>    <span class="at">CRM1_140 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-192"><a href="data-collection-wrangling.html#cb31-192" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">140</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-193"><a href="data-collection-wrangling.html#cb31-193" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_140 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-194"><a href="data-collection-wrangling.html#cb31-194" tabindex="-1"></a>    <span class="at">CRM1_130 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-195"><a href="data-collection-wrangling.html#cb31-195" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">130</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-196"><a href="data-collection-wrangling.html#cb31-196" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_130 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-197"><a href="data-collection-wrangling.html#cb31-197" tabindex="-1"></a>    <span class="at">CRM1_120 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-198"><a href="data-collection-wrangling.html#cb31-198" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">120</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-199"><a href="data-collection-wrangling.html#cb31-199" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_120 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-200"><a href="data-collection-wrangling.html#cb31-200" tabindex="-1"></a>    <span class="at">CRM1_110 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-201"><a href="data-collection-wrangling.html#cb31-201" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">110</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-202"><a href="data-collection-wrangling.html#cb31-202" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_110 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-203"><a href="data-collection-wrangling.html#cb31-203" tabindex="-1"></a>    <span class="at">CRM1_100 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-204"><a href="data-collection-wrangling.html#cb31-204" tabindex="-1"></a>                             dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">100</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-205"><a href="data-collection-wrangling.html#cb31-205" tabindex="-1"></a>                             <span class="fu">summarise</span>(<span class="at">CRM1_100 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-206"><a href="data-collection-wrangling.html#cb31-206" tabindex="-1"></a>    <span class="at">CRM1_90 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-207"><a href="data-collection-wrangling.html#cb31-207" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">90</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-208"><a href="data-collection-wrangling.html#cb31-208" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_90 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-209"><a href="data-collection-wrangling.html#cb31-209" tabindex="-1"></a>    <span class="at">CRM1_80 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-210"><a href="data-collection-wrangling.html#cb31-210" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">80</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-211"><a href="data-collection-wrangling.html#cb31-211" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_80 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-212"><a href="data-collection-wrangling.html#cb31-212" tabindex="-1"></a>    <span class="at">CRM1_70 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-213"><a href="data-collection-wrangling.html#cb31-213" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">70</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-214"><a href="data-collection-wrangling.html#cb31-214" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_70 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-215"><a href="data-collection-wrangling.html#cb31-215" tabindex="-1"></a>    <span class="at">CRM1_60 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-216"><a href="data-collection-wrangling.html#cb31-216" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">60</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-217"><a href="data-collection-wrangling.html#cb31-217" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_60 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-218"><a href="data-collection-wrangling.html#cb31-218" tabindex="-1"></a>    <span class="at">CRM1_50 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-219"><a href="data-collection-wrangling.html#cb31-219" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">50</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-220"><a href="data-collection-wrangling.html#cb31-220" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_50 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-221"><a href="data-collection-wrangling.html#cb31-221" tabindex="-1"></a>    <span class="at">CRM1_40 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span></span>
<span id="cb31-222"><a href="data-collection-wrangling.html#cb31-222" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">40</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-223"><a href="data-collection-wrangling.html#cb31-223" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_40 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-224"><a href="data-collection-wrangling.html#cb31-224" tabindex="-1"></a>    <span class="at">CRM1_30 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-225"><a href="data-collection-wrangling.html#cb31-225" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">30</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-226"><a href="data-collection-wrangling.html#cb31-226" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_30 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-227"><a href="data-collection-wrangling.html#cb31-227" tabindex="-1"></a>    <span class="at">CRM1_20 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-228"><a href="data-collection-wrangling.html#cb31-228" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">20</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-229"><a href="data-collection-wrangling.html#cb31-229" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_20 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps)))),</span>
<span id="cb31-230"><a href="data-collection-wrangling.html#cb31-230" tabindex="-1"></a>    <span class="at">CRM1_10 =</span> data <span class="sc">%&gt;%</span> <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb31-231"><a href="data-collection-wrangling.html#cb31-231" tabindex="-1"></a>                            dplyr<span class="sc">::</span><span class="fu">filter</span>(doy <span class="sc">&lt;</span> (<span class="dv">120</span> <span class="sc">+</span> <span class="dv">10</span>) <span class="sc">&amp;</span> doy <span class="sc">&gt;</span> <span class="dv">120</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-232"><a href="data-collection-wrangling.html#cb31-232" tabindex="-1"></a>                            <span class="fu">summarise</span>(<span class="at">CRM1_10 =</span> <span class="fu">max</span>(<span class="fu">cumsum</span>(chirps))))</span>
<span id="cb31-233"><a href="data-collection-wrangling.html#cb31-233" tabindex="-1"></a>    ) <span class="sc">%&gt;%</span> </span>
<span id="cb31-234"><a href="data-collection-wrangling.html#cb31-234" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">starts_with</span>(<span class="st">&quot;CR&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-235"><a href="data-collection-wrangling.html#cb31-235" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">starts_with</span>(<span class="st">&quot;CR&quot;</span>), <span class="at">names_to =</span> <span class="st">&quot;Period&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;CR&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-236"><a href="data-collection-wrangling.html#cb31-236" tabindex="-1"></a>  <span class="fu">separate</span>(Period, <span class="fu">c</span>(<span class="st">&quot;Start_moment&quot;</span>, <span class="st">&quot;Period&quot;</span>),<span class="at">sep =</span> <span class="st">&quot;_&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb31-237"><a href="data-collection-wrangling.html#cb31-237" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Start_moment =</span> <span class="fu">str_remove</span>(Start_moment, <span class="st">&quot;CR&quot;</span>),</span>
<span id="cb31-238"><a href="data-collection-wrangling.html#cb31-238" tabindex="-1"></a>         <span class="at">Start_moment =</span> <span class="fu">case_when</span>(Start_moment <span class="sc">==</span> <span class="st">&quot;A1&quot;</span> <span class="sc">~</span> <span class="st">&quot;April-1&quot;</span>,</span>
<span id="cb31-239"><a href="data-collection-wrangling.html#cb31-239" tabindex="-1"></a>                                  Start_moment <span class="sc">==</span> <span class="st">&quot;A2&quot;</span> <span class="sc">~</span> <span class="st">&quot;April-10&quot;</span>,</span>
<span id="cb31-240"><a href="data-collection-wrangling.html#cb31-240" tabindex="-1"></a>                                  Start_moment <span class="sc">==</span> <span class="st">&quot;A3&quot;</span> <span class="sc">~</span> <span class="st">&quot;April-20&quot;</span>,</span>
<span id="cb31-241"><a href="data-collection-wrangling.html#cb31-241" tabindex="-1"></a>                                  Start_moment <span class="sc">==</span> <span class="st">&quot;M1&quot;</span> <span class="sc">~</span> <span class="st">&quot;May-1&quot;</span>,</span>
<span id="cb31-242"><a href="data-collection-wrangling.html#cb31-242" tabindex="-1"></a>                                  Start_moment <span class="sc">==</span> <span class="st">&quot;M2&quot;</span> <span class="sc">~</span> <span class="st">&quot;May-10&quot;</span>,</span>
<span id="cb31-243"><a href="data-collection-wrangling.html#cb31-243" tabindex="-1"></a>                                  <span class="cn">TRUE</span> <span class="sc">~</span><span class="st">&quot;NA&quot;</span>),</span>
<span id="cb31-244"><a href="data-collection-wrangling.html#cb31-244" tabindex="-1"></a>         <span class="at">CR =</span> <span class="fu">round</span>(CR, <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb31-245"><a href="data-collection-wrangling.html#cb31-245" tabindex="-1"></a>dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data)</span>
<span id="cb31-246"><a href="data-collection-wrangling.html#cb31-246" tabindex="-1"></a><span class="fu">write.csv</span>(CP_period, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/4_CP/CP_&quot;</span>,FIELD_TO_CLEAN,<span class="st">&quot;.csv&quot;</span>), <span class="at">row.names =</span> F)</span></code></pre></div>
</div>
<div id="reference" class="section level2 hasAnchor" number="2.5">
<h2><span class="header-section-number">2.5</span> Reference<a href="data-collection-wrangling.html#reference" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Arno Z, Erickson J (2022). tidyrgee: ‘tidyverse’ Methods for ’Earth Engine’.
R package version 0.1.0, <a href="https://CRAN.R-project.org/package=tidyrgee" class="uri">https://CRAN.R-project.org/package=tidyrgee</a>.</p></li>
<li><p>Aybar C (2024). rgee: R Bindings for Calling the ‘Earth Engine’ API.
<a href="https://github.com/r-spatial/rgee/" class="uri">https://github.com/r-spatial/rgee/</a>, <a href="https://r-spatial.github.io/rgee/" class="uri">https://r-spatial.github.io/rgee/</a>, <a href="https://github.com/google/earthengine-api/" class="uri">https://github.com/google/earthengine-api/</a>.</p></li>
<li><p>Bivand R, Pebesma E, Gomez-Rubio V (2013). Applied spatial data analysis with R, Second edition. Springer, NY. <a href="https://asdar-book.org/" class="uri">https://asdar-book.org/</a>.</p></li>
<li><p>Córdoba, M.A., 2014. Herramientas estadísticas para el monitoreo y uso de la variabilidad espacial del rendimiento y propiedades de suelo intralote (Doctoral dissertation). Universidad Nacional de Córdoba.</p></li>
<li><p>Funk, C., Peterson, P., Landsfeld, M., Pedreros, D., Verdin, J., Shukla, S., Husak, G., Rowland, J., Harrison, L., Hoell, A., Michaelsen, J., 2015. The climate hazards infrared precipitation with stations—a new environmental record for monitoring extremes. Sci Data 2, 150066. <a href="https://doi.org/10.1038/sdata.2015.66" class="uri">https://doi.org/10.1038/sdata.2015.66</a></p></li>
<li><p>Hijmans R (2023). raster: Geographic Data Analysis and Modeling. R package
version 3.6-26, <a href="https://CRAN.R-project.org/package=raster" class="uri">https://CRAN.R-project.org/package=raster</a>.</p></li>
<li><p>Pebesma E (2018). “Simple Features for R: Standardized Support for Spatial Vector Data.” The R Journal, 10(1), 439–446. <a href="doi:10.32614/RJ-2018-009" class="uri">doi:10.32614/RJ-2018-009</a>, <a href="https://doi.org/10.32614/RJ-2018-009" class="uri">https://doi.org/10.32614/RJ-2018-009</a>.</p></li>
<li><p>Wickham H, Averick M, Bryan J, Chang W, McGowan LD, François R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Müller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). “Welcome to the tidyverse.” Journal of Open Source Software, 4(43), 1686. <a href="doi:10.21105/joss.01686" class="uri">doi:10.21105/joss.01686</a>.</p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/2_Data_collection.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
