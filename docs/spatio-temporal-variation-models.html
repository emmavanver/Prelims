<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Spatio-temporal variation models | Spatio-temporal yield variation to precipitation within a field</title>
  <meta name="description" content="4 Spatio-temporal variation models | Spatio-temporal yield variation to precipitation within a field" />
  <meta name="generator" content="bookdown 0.39 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Spatio-temporal variation models | Spatio-temporal yield variation to precipitation within a field" />
  <meta property="og:type" content="book" />
  
  
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Spatio-temporal variation models | Spatio-temporal yield variation to precipitation within a field" />
  
  
  

<meta name="author" content="Emmanuela van Versendaal" />


<meta name="date" content="2024-08-07" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="yield-prediction-using-sentinel-2.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="custom.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<Spatio-temporal Yield variation within field>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a></li>
<li class="chapter" data-level="2" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html"><i class="fa fa-check"></i><b>2</b> Data collection, wrangling &amp; exploration</a>
<ul>
<li class="chapter" data-level="2.1" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#retrieve-satellite-data"><i class="fa fa-check"></i><b>2.1</b> Retrieve satellite data</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#import-libraries"><i class="fa fa-check"></i><b>2.1.1</b> Import libraries</a></li>
<li class="chapter" data-level="2.1.2" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#field-identification"><i class="fa fa-check"></i><b>2.1.2</b> Field identification</a></li>
<li class="chapter" data-level="2.1.3" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#gcvi-peak-detection"><i class="fa fa-check"></i><b>2.1.3</b> GCVI Peak detection</a></li>
<li class="chapter" data-level="2.1.4" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#gcvi-at-pixel-level-within-field"><i class="fa fa-check"></i><b>2.1.4</b> GCVI at pixel level within field</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#clean-yield-monitor-data"><i class="fa fa-check"></i><b>2.2</b> Clean yield monitor data</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#import-libraries-1"><i class="fa fa-check"></i><b>2.2.1</b> Import libraries</a></li>
<li class="chapter" data-level="2.2.2" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#field-identification-1"><i class="fa fa-check"></i><b>2.2.2</b> Field identification</a></li>
<li class="chapter" data-level="2.2.3" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#cleaning-process"><i class="fa fa-check"></i><b>2.2.3</b> Cleaning process</a></li>
<li class="chapter" data-level="2.2.4" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#merge-ym-data-gcvi-data"><i class="fa fa-check"></i><b>2.2.4</b> Merge YM data &amp; GCVI data</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#cp-period"><i class="fa fa-check"></i><b>2.3</b> CP period</a></li>
<li class="chapter" data-level="2.4" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#data-exploration"><i class="fa fa-check"></i><b>2.4</b> Data exploration</a></li>
<li class="chapter" data-level="2.5" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#split-field-in-training-testing"><i class="fa fa-check"></i><b>2.5</b> Split field in training-testing</a></li>
<li class="chapter" data-level="2.6" data-path="data-collection-wrangling-exploration.html"><a href="data-collection-wrangling-exploration.html#reference"><i class="fa fa-check"></i><b>2.6</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html"><i class="fa fa-check"></i><b>3</b> Yield prediction using sentinel-2</a>
<ul>
<li class="chapter" data-level="3.1" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#import-libraries-2"><i class="fa fa-check"></i><b>3.1</b> Import libraries</a></li>
<li class="chapter" data-level="3.2" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#model"><i class="fa fa-check"></i><b>3.2</b> Model</a></li>
<li class="chapter" data-level="3.3" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#predict"><i class="fa fa-check"></i><b>3.3</b> Predict</a></li>
<li class="chapter" data-level="3.4" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#model-evaluation"><i class="fa fa-check"></i><b>3.4</b> Model evaluation</a></li>
<li class="chapter" data-level="3.5" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#save-prediction"><i class="fa fa-check"></i><b>3.5</b> Save prediction</a></li>
<li class="chapter" data-level="3.6" data-path="yield-prediction-using-sentinel-2.html"><a href="yield-prediction-using-sentinel-2.html#reference-1"><i class="fa fa-check"></i><b>3.6</b> Reference</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html"><i class="fa fa-check"></i><b>4</b> Spatio-temporal variation models</a>
<ul>
<li class="chapter" data-level="4.1" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#import-libraries-3"><i class="fa fa-check"></i><b>4.1</b> Import Libraries</a></li>
<li class="chapter" data-level="4.2" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#upload-data"><i class="fa fa-check"></i><b>4.2</b> Upload data</a></li>
<li class="chapter" data-level="4.3" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#gams"><i class="fa fa-check"></i><b>4.3</b> GAMs</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#run-models"><i class="fa fa-check"></i><b>4.3.1</b> Run models</a></li>
<li class="chapter" data-level="4.3.2" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#obtain-predictions"><i class="fa fa-check"></i><b>4.3.2</b> Obtain predictions</a></li>
<li class="chapter" data-level="4.3.3" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#model-evaluation-1"><i class="fa fa-check"></i><b>4.3.3</b> Model evaluation</a></li>
<li class="chapter" data-level="4.3.4" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#spatially-varying-parameters"><i class="fa fa-check"></i><b>4.3.4</b> Spatially Varying Parameters</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#cart"><i class="fa fa-check"></i><b>4.4</b> CART</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#run-cart"><i class="fa fa-check"></i><b>4.4.1</b> Run CART</a></li>
<li class="chapter" data-level="4.4.2" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#obtain-figures"><i class="fa fa-check"></i><b>4.4.2</b> Obtain Figures</a></li>
</ul></li>
<li class="chapter" data-level="4.5" data-path="spatio-temporal-variation-models.html"><a href="spatio-temporal-variation-models.html#reference-2"><i class="fa fa-check"></i><b>4.5</b> Reference</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Spatio-temporal yield variation to precipitation within a field</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="spatio-temporal-variation-models" class="section level1 hasAnchor" number="4">
<h1><span class="header-section-number">4</span> Spatio-temporal variation models<a href="spatio-temporal-variation-models.html#spatio-temporal-variation-models" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To assess spatio-temporal yield variation in response to precipitation within a field using both observed and predicted yield data, two methodologies will be employed:</p>
<ol style="list-style-type: decimal">
<li><p>Generalized Additive Models (GAMs): To obtain Spatially Varying Response Parameters (SVRP) across the field.</p></li>
<li><p>Classification and Regression Trees (CART): To classify different types of yield responses to precipitation within the field, based on the previously obtained SVRP.</p></li>
</ol>
<div id="import-libraries-3" class="section level2 hasAnchor" number="4.1">
<h2><span class="header-section-number">4.1</span> Import Libraries<a href="spatio-temporal-variation-models.html#import-libraries-3" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="spatio-temporal-variation-models.html#cb52-1" tabindex="-1"></a><span class="co"># Packages to be used</span></span>
<span id="cb52-2"><a href="spatio-temporal-variation-models.html#cb52-2" tabindex="-1"></a>library_names <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sp&quot;</span>, <span class="co"># (Bivand et al., 2012)</span></span>
<span id="cb52-3"><a href="spatio-temporal-variation-models.html#cb52-3" tabindex="-1"></a>                   <span class="st">&quot;sf&quot;</span>, <span class="co"># (Pebesma, 2018)</span></span>
<span id="cb52-4"><a href="spatio-temporal-variation-models.html#cb52-4" tabindex="-1"></a>                   <span class="st">&quot;mgcv&quot;</span>, <span class="co"># GAMs (Wood,2017)</span></span>
<span id="cb52-5"><a href="spatio-temporal-variation-models.html#cb52-5" tabindex="-1"></a>                   <span class="st">&quot;rpart&quot;</span>, <span class="co"># Regression tree</span></span>
<span id="cb52-6"><a href="spatio-temporal-variation-models.html#cb52-6" tabindex="-1"></a>                   <span class="st">&quot;rpart.plot&quot;</span>, <span class="co"># CART (Therneau et al., 2015)</span></span>
<span id="cb52-7"><a href="spatio-temporal-variation-models.html#cb52-7" tabindex="-1"></a>                   <span class="st">&quot;partykit&quot;</span>,</span>
<span id="cb52-8"><a href="spatio-temporal-variation-models.html#cb52-8" tabindex="-1"></a>                   <span class="st">&quot;tidyverse&quot;</span>) <span class="co"># (Wickham et al., 2019)</span></span>
<span id="cb52-9"><a href="spatio-temporal-variation-models.html#cb52-9" tabindex="-1"></a><span class="co"># Iterate over each library name</span></span>
<span id="cb52-10"><a href="spatio-temporal-variation-models.html#cb52-10" tabindex="-1"></a><span class="cf">for</span> (lib_name <span class="cf">in</span> library_names) {</span>
<span id="cb52-11"><a href="spatio-temporal-variation-models.html#cb52-11" tabindex="-1"></a>  <span class="co"># Check if the library is already installed</span></span>
<span id="cb52-12"><a href="spatio-temporal-variation-models.html#cb52-12" tabindex="-1"></a>  <span class="cf">if</span> (<span class="sc">!</span><span class="fu">require</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)) {</span>
<span id="cb52-13"><a href="spatio-temporal-variation-models.html#cb52-13" tabindex="-1"></a>    <span class="co"># If the library is not installed, install it</span></span>
<span id="cb52-14"><a href="spatio-temporal-variation-models.html#cb52-14" tabindex="-1"></a>    <span class="fu">install.packages</span>(lib_name, <span class="at">dependencies =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-15"><a href="spatio-temporal-variation-models.html#cb52-15" tabindex="-1"></a>    <span class="co"># Load the library</span></span>
<span id="cb52-16"><a href="spatio-temporal-variation-models.html#cb52-16" tabindex="-1"></a>    <span class="fu">library</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-17"><a href="spatio-temporal-variation-models.html#cb52-17" tabindex="-1"></a>  } <span class="cf">else</span> {</span>
<span id="cb52-18"><a href="spatio-temporal-variation-models.html#cb52-18" tabindex="-1"></a>    <span class="co"># If the library is already installed, load it</span></span>
<span id="cb52-19"><a href="spatio-temporal-variation-models.html#cb52-19" tabindex="-1"></a>    <span class="fu">library</span>(lib_name, <span class="at">character.only =</span> <span class="cn">TRUE</span>)</span>
<span id="cb52-20"><a href="spatio-temporal-variation-models.html#cb52-20" tabindex="-1"></a>  }</span>
<span id="cb52-21"><a href="spatio-temporal-variation-models.html#cb52-21" tabindex="-1"></a>}</span></code></pre></div>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="spatio-temporal-variation-models.html#cb53-1" tabindex="-1"></a><span class="co"># Palette color figures #</span></span>
<span id="cb53-2"><a href="spatio-temporal-variation-models.html#cb53-2" tabindex="-1"></a>grad_id <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#99e2b4&quot;</span>, <span class="st">&quot;#88d4ab&quot;</span>, <span class="st">&quot;#78c6a3&quot;</span>, <span class="st">&quot;#67b99a&quot;</span>, <span class="st">&quot;#56ab91&quot;</span>,</span>
<span id="cb53-3"><a href="spatio-temporal-variation-models.html#cb53-3" tabindex="-1"></a>             <span class="st">&quot;#469d89&quot;</span>, <span class="st">&quot;#358f80&quot;</span>, <span class="st">&quot;#248277&quot;</span>, <span class="st">&quot;#14746f&quot;</span>, <span class="st">&quot;#036666&quot;</span>,</span>
<span id="cb53-4"><a href="spatio-temporal-variation-models.html#cb53-4" tabindex="-1"></a>             <span class="st">&quot;#025959&quot;</span>, <span class="st">&quot;#014c4c&quot;</span>, <span class="st">&quot;#013f3f&quot;</span>, <span class="st">&quot;#013232&quot;</span>, <span class="st">&quot;#012525&quot;</span>)</span>
<span id="cb53-5"><a href="spatio-temporal-variation-models.html#cb53-5" tabindex="-1"></a>grad_bl <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#c2e0f0&quot;</span>, <span class="st">&quot;#b3d8ea&quot;</span>, <span class="st">&quot;#a3cfe4&quot;</span>, <span class="st">&quot;#89c2d9&quot;</span>, <span class="st">&quot;#61a5c2&quot;</span>,</span>
<span id="cb53-6"><a href="spatio-temporal-variation-models.html#cb53-6" tabindex="-1"></a>             <span class="st">&quot;#468faf&quot;</span>, <span class="st">&quot;#2c7da0&quot;</span>, <span class="st">&quot;#2a6f97&quot;</span>, <span class="st">&quot;#014f86&quot;</span>, <span class="st">&quot;#01497c&quot;</span>,</span>
<span id="cb53-7"><a href="spatio-temporal-variation-models.html#cb53-7" tabindex="-1"></a>             <span class="st">&quot;#013a63&quot;</span>, <span class="st">&quot;#012a4a&quot;</span>, <span class="st">&quot;#011d36&quot;</span>, <span class="st">&quot;#011529&quot;</span>, <span class="st">&quot;#010e1d&quot;</span>, <span class="st">&quot;#010912&quot;</span>)</span>
<span id="cb53-8"><a href="spatio-temporal-variation-models.html#cb53-8" tabindex="-1"></a>grad_MY <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;#dad7cd&quot;</span>, <span class="st">&quot;#a3b18a&quot;</span>, <span class="st">&quot;#588157&quot;</span>, <span class="st">&quot;#3a5a40&quot;</span>, <span class="st">&quot;#344e41&quot;</span>,</span>
<span id="cb53-9"><a href="spatio-temporal-variation-models.html#cb53-9" tabindex="-1"></a>             <span class="st">&quot;#2c4238&quot;</span>, <span class="st">&quot;#243630&quot;</span>, <span class="st">&quot;#1c2a28&quot;</span>)</span></code></pre></div>
</div>
<div id="upload-data" class="section level2 hasAnchor" number="4.2">
<h2><span class="header-section-number">4.2</span> Upload data<a href="spatio-temporal-variation-models.html#upload-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="spatio-temporal-variation-models.html#cb54-1" tabindex="-1"></a><span class="do">######### ADD FIELD NAME. Example: IL5 #############</span></span>
<span id="cb54-2"><a href="spatio-temporal-variation-models.html#cb54-2" tabindex="-1"></a>FIELD_NAME <span class="ot">&lt;-</span> <span class="st">&quot;IL5&quot;</span></span></code></pre></div>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="spatio-temporal-variation-models.html#cb55-1" tabindex="-1"></a><span class="do">### Obtain each datasets </span><span class="al">###</span></span>
<span id="cb55-2"><a href="spatio-temporal-variation-models.html#cb55-2" tabindex="-1"></a>YM_df <span class="ot">&lt;-</span> </span>
<span id="cb55-3"><a href="spatio-temporal-variation-models.html#cb55-3" tabindex="-1"></a><span class="fu">read_sf</span>(<span class="fu">paste0</span>(<span class="st">&quot;1_Data/5_YieldPred/YM_df&quot;</span>, FIELD_NAME, <span class="st">&quot;_Ypred.shp&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-4"><a href="spatio-temporal-variation-models.html#cb55-4" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Yobs, Ypred), <span class="at">names_to =</span> <span class="st">&quot;Variable&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb55-5"><a href="spatio-temporal-variation-models.html#cb55-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Value =</span> <span class="fu">round</span>(Value, <span class="dv">0</span>))</span>
<span id="cb55-6"><a href="spatio-temporal-variation-models.html#cb55-6" tabindex="-1"></a></span>
<span id="cb55-7"><a href="spatio-temporal-variation-models.html#cb55-7" tabindex="-1"></a>pp_periods <span class="ot">&lt;-</span> </span>
<span id="cb55-8"><a href="spatio-temporal-variation-models.html#cb55-8" tabindex="-1"></a>  <span class="fu">read.csv</span>(<span class="fu">paste0</span>(<span class="st">&quot;1_Data/4_CP/CP_&quot;</span>,FIELD_NAME,<span class="st">&quot;.csv&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-9"><a href="spatio-temporal-variation-models.html#cb55-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Start_moment =</span> <span class="fu">str_replace</span>(Start_moment, <span class="st">&quot;-&quot;</span>, <span class="st">&quot;_&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb55-10"><a href="spatio-temporal-variation-models.html#cb55-10" tabindex="-1"></a>  <span class="fu">pivot_wider</span>(<span class="at">names_from =</span> <span class="fu">c</span>(Start_moment, Period), <span class="at">values_from =</span> CR) <span class="sc">%&gt;%</span> </span>
<span id="cb55-11"><a href="spatio-temporal-variation-models.html#cb55-11" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Year <span class="sc">%in%</span><span class="fu">c</span>(<span class="fu">unique</span>(YM_df<span class="sc">$</span>Year))) <span class="sc">%&gt;%</span> </span>
<span id="cb55-12"><a href="spatio-temporal-variation-models.html#cb55-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Year,May_1_90) <span class="sc">%&gt;%</span> </span>
<span id="cb55-13"><a href="spatio-temporal-variation-models.html#cb55-13" tabindex="-1"></a>  <span class="fu">rename</span>(<span class="at">CP =</span> May_1_90)</span>
<span id="cb55-14"><a href="spatio-temporal-variation-models.html#cb55-14" tabindex="-1"></a></span>
<span id="cb55-15"><a href="spatio-temporal-variation-models.html#cb55-15" tabindex="-1"></a>df <span class="ot">&lt;-</span> YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb55-16"><a href="spatio-temporal-variation-models.html#cb55-16" tabindex="-1"></a>  <span class="fu">left_join</span>(pp_periods, <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;Year&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb55-17"><a href="spatio-temporal-variation-models.html#cb55-17" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb55-18"><a href="spatio-temporal-variation-models.html#cb55-18" tabindex="-1"></a>  <span class="fu">nest</span>()</span></code></pre></div>
</div>
<div id="gams" class="section level2 hasAnchor" number="4.3">
<h2><span class="header-section-number">4.3</span> GAMs<a href="spatio-temporal-variation-models.html#gams" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>GAMs, which are hierarchical models, are flexible analytical frameworks for capturing complex and non-linear interactions within a data (Wood, 2017). By using GAMs, we can obtain yield responses to precipitation at the pixel level within the field. In this framework, the first level of the model describes the crop yield (<span class="math inline">\(Y_i\)</span>) for the <span class="math inline">\(i^{th}\)</span> observation. The crop yield (<span class="math inline">\(Y_i\)</span>) was assumed to follow a normal distribution with expected value <span class="math inline">\(\mu_i\)</span> and variance <span class="math inline">\(\sigma^2\)</span>:</p>
<p><span class="math inline">\(Y_i \sim Normal(\mu_i, \sigma^2)\)</span></p>
<p>In the second level of the model, <span class="math inline">\(\mu_i\)</span> was defined as:</p>
<p><span class="math inline">\(\mu_i = \beta_0 + f(Lon_i, Lat_i, CP_i)\)</span>,</p>
<p>where <span class="math inline">\(\beta_0\)</span> is the intercept term; and <span class="math inline">\(f(Lon_i, Lat_i, CP_i)\)</span> is a tensor product smooth function of latitude (<span class="math inline">\(Lat_i\)</span>), longitude (<span class="math inline">\(Lon_i\)</span>), and cumulative precipitation (<span class="math inline">\(CP_i\)</span>) with basis function thin plate spline for the spatial coordinates (Wood, 2003) and a cubic regression spline for cumulative precipitation variable. The complexity of the model is controlled by smoothing parameters, where k=(400,3) specifies the basis dimension limits, with 400 basis functions allocated for the interaction of spatial coordinates and 3 for cumulative precipitation.</p>
<div id="run-models" class="section level3 hasAnchor" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Run models<a href="spatio-temporal-variation-models.html#run-models" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="spatio-temporal-variation-models.html#cb56-1" tabindex="-1"></a><span class="do">## Observed yield monitor data model ##</span></span>
<span id="cb56-2"><a href="spatio-temporal-variation-models.html#cb56-2" tabindex="-1"></a>GAM_obs <span class="ot">&lt;-</span> <span class="fu">bam</span>(Value <span class="sc">~</span> <span class="fu">te</span>(X,Y, CP, <span class="at">bs=</span> <span class="fu">c</span>(<span class="st">&quot;tp&quot;</span>,<span class="st">&quot;cr&quot;</span>), <span class="at">k =</span><span class="fu">c</span>(<span class="dv">400</span>, <span class="fl">2.6</span>), <span class="at">d =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)),</span>
<span id="cb56-3"><a href="spatio-temporal-variation-models.html#cb56-3" tabindex="-1"></a>                <span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">nthreads =</span> <span class="dv">16</span>,</span>
<span id="cb56-4"><a href="spatio-temporal-variation-models.html#cb56-4" tabindex="-1"></a>                <span class="at">data =</span> df <span class="sc">%&gt;%</span></span>
<span id="cb56-5"><a href="spatio-temporal-variation-models.html#cb56-5" tabindex="-1"></a>                 dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-6"><a href="spatio-temporal-variation-models.html#cb56-6" tabindex="-1"></a>                 <span class="fu">unnest</span>(data) )</span>
<span id="cb56-7"><a href="spatio-temporal-variation-models.html#cb56-7" tabindex="-1"></a><span class="co">#summary(GAM_obs)</span></span>
<span id="cb56-8"><a href="spatio-temporal-variation-models.html#cb56-8" tabindex="-1"></a><span class="do">## Observed yield monitor data model  using sentinel-2 ##</span></span>
<span id="cb56-9"><a href="spatio-temporal-variation-models.html#cb56-9" tabindex="-1"></a>GAM_pred <span class="ot">&lt;-</span> <span class="fu">bam</span>(Value <span class="sc">~</span> <span class="fu">te</span>(X,Y, CP, <span class="at">bs=</span> <span class="fu">c</span>(<span class="st">&quot;tp&quot;</span>,<span class="st">&quot;cr&quot;</span>), <span class="at">k =</span><span class="fu">c</span>(<span class="dv">400</span>, <span class="fl">2.6</span>), <span class="at">d =</span> <span class="fu">c</span>(<span class="dv">2</span>,<span class="dv">1</span>)),</span>
<span id="cb56-10"><a href="spatio-temporal-variation-models.html#cb56-10" tabindex="-1"></a>                <span class="at">discrete =</span> <span class="cn">TRUE</span>, <span class="at">nthreads =</span> <span class="dv">16</span>,</span>
<span id="cb56-11"><a href="spatio-temporal-variation-models.html#cb56-11" tabindex="-1"></a>                <span class="at">data =</span> df <span class="sc">%&gt;%</span></span>
<span id="cb56-12"><a href="spatio-temporal-variation-models.html#cb56-12" tabindex="-1"></a>                 dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb56-13"><a href="spatio-temporal-variation-models.html#cb56-13" tabindex="-1"></a>                 <span class="fu">unnest</span>(data) )</span>
<span id="cb56-14"><a href="spatio-temporal-variation-models.html#cb56-14" tabindex="-1"></a><span class="co">#summary(GAM_pred)</span></span></code></pre></div>
</div>
<div id="obtain-predictions" class="section level3 hasAnchor" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Obtain predictions<a href="spatio-temporal-variation-models.html#obtain-predictions" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Use the original dataset to evaluate later observed versus predicted for observed yield monitor data and predicted monitor data using sentinel-2.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="spatio-temporal-variation-models.html#cb57-1" tabindex="-1"></a>pred <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span> </span>
<span id="cb57-2"><a href="spatio-temporal-variation-models.html#cb57-2" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">map2</span>(data, Variable, <span class="sc">~</span>{</span>
<span id="cb57-3"><a href="spatio-temporal-variation-models.html#cb57-3" tabindex="-1"></a>    <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>) {</span>
<span id="cb57-4"><a href="spatio-temporal-variation-models.html#cb57-4" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb57-5"><a href="spatio-temporal-variation-models.html#cb57-5" tabindex="-1"></a>        <span class="fu">bind_cols</span>(<span class="fu">predict</span>(GAM_obs,</span>
<span id="cb57-6"><a href="spatio-temporal-variation-models.html#cb57-6" tabindex="-1"></a>                          df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable<span class="sc">==</span><span class="st">&quot;Yobs&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data),</span>
<span id="cb57-7"><a href="spatio-temporal-variation-models.html#cb57-7" tabindex="-1"></a>                          <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-8"><a href="spatio-temporal-variation-models.html#cb57-8" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-9"><a href="spatio-temporal-variation-models.html#cb57-9" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="st">&quot;Yield_hat&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-10"><a href="spatio-temporal-variation-models.html#cb57-10" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, Year, Value, Yield_hat, CP)</span>
<span id="cb57-11"><a href="spatio-temporal-variation-models.html#cb57-11" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) {</span>
<span id="cb57-12"><a href="spatio-temporal-variation-models.html#cb57-12" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb57-13"><a href="spatio-temporal-variation-models.html#cb57-13" tabindex="-1"></a>        <span class="fu">bind_cols</span>(<span class="fu">predict</span>(GAM_pred,</span>
<span id="cb57-14"><a href="spatio-temporal-variation-models.html#cb57-14" tabindex="-1"></a>                          df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable<span class="sc">==</span><span class="st">&quot;Ypred&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data),</span>
<span id="cb57-15"><a href="spatio-temporal-variation-models.html#cb57-15" tabindex="-1"></a>                          <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb57-16"><a href="spatio-temporal-variation-models.html#cb57-16" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb57-17"><a href="spatio-temporal-variation-models.html#cb57-17" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="st">&quot;Yield_hat&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb57-18"><a href="spatio-temporal-variation-models.html#cb57-18" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, Year, Value, Yield_hat, CP)</span>
<span id="cb57-19"><a href="spatio-temporal-variation-models.html#cb57-19" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb57-20"><a href="spatio-temporal-variation-models.html#cb57-20" tabindex="-1"></a>      .x</span>
<span id="cb57-21"><a href="spatio-temporal-variation-models.html#cb57-21" tabindex="-1"></a>    }</span>
<span id="cb57-22"><a href="spatio-temporal-variation-models.html#cb57-22" tabindex="-1"></a>  }))</span></code></pre></div>
<p>A dataset with more intervals of of cumulative precipitation was created (mm). For that, the minimum and maximum value of CP was obtained, in order to obtain more interval between that range.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="spatio-temporal-variation-models.html#cb58-1" tabindex="-1"></a><span class="co"># New dataframe in order to have more intervals</span></span>
<span id="cb58-2"><a href="spatio-temporal-variation-models.html#cb58-2" tabindex="-1"></a><span class="co"># within the range of Cum precipitation</span></span>
<span id="cb58-3"><a href="spatio-temporal-variation-models.html#cb58-3" tabindex="-1"></a>new_df <span class="ot">&lt;-</span> df <span class="sc">%&gt;%</span>  </span>
<span id="cb58-4"><a href="spatio-temporal-variation-models.html#cb58-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">df =</span> <span class="fu">map2</span>(data, Variable, <span class="sc">~</span>{</span>
<span id="cb58-5"><a href="spatio-temporal-variation-models.html#cb58-5" tabindex="-1"></a>    <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>){</span>
<span id="cb58-6"><a href="spatio-temporal-variation-models.html#cb58-6" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb58-7"><a href="spatio-temporal-variation-models.html#cb58-7" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-8"><a href="spatio-temporal-variation-models.html#cb58-8" tabindex="-1"></a>        <span class="fu">group_by</span>(X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb58-9"><a href="spatio-temporal-variation-models.html#cb58-9" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(CP),</span>
<span id="cb58-10"><a href="spatio-temporal-variation-models.html#cb58-10" tabindex="-1"></a>               <span class="at">max =</span> <span class="fu">max</span>(CP) ) <span class="sc">%&gt;%</span> </span>
<span id="cb58-11"><a href="spatio-temporal-variation-models.html#cb58-11" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y, min, max) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-12"><a href="spatio-temporal-variation-models.html#cb58-12" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">CP =</span> <span class="fu">list</span>(<span class="fu">seq</span>(min, max, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb58-13"><a href="spatio-temporal-variation-models.html#cb58-13" tabindex="-1"></a>        <span class="fu">unnest</span>(CP) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() </span>
<span id="cb58-14"><a href="spatio-temporal-variation-models.html#cb58-14" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) {</span>
<span id="cb58-15"><a href="spatio-temporal-variation-models.html#cb58-15" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb58-16"><a href="spatio-temporal-variation-models.html#cb58-16" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-17"><a href="spatio-temporal-variation-models.html#cb58-17" tabindex="-1"></a>        <span class="fu">group_by</span>(X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb58-18"><a href="spatio-temporal-variation-models.html#cb58-18" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">min =</span> <span class="fu">min</span>(CP),</span>
<span id="cb58-19"><a href="spatio-temporal-variation-models.html#cb58-19" tabindex="-1"></a>               <span class="at">max =</span> <span class="fu">max</span>(CP) ) <span class="sc">%&gt;%</span> </span>
<span id="cb58-20"><a href="spatio-temporal-variation-models.html#cb58-20" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y, min, max) <span class="sc">%&gt;%</span> <span class="fu">distinct</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-21"><a href="spatio-temporal-variation-models.html#cb58-21" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">CP =</span> <span class="fu">list</span>(<span class="fu">seq</span>(min, max, <span class="dv">2</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb58-22"><a href="spatio-temporal-variation-models.html#cb58-22" tabindex="-1"></a>        <span class="fu">unnest</span>(CP) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>()</span>
<span id="cb58-23"><a href="spatio-temporal-variation-models.html#cb58-23" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb58-24"><a href="spatio-temporal-variation-models.html#cb58-24" tabindex="-1"></a>      .x  <span class="co"># Return the original data if the variable is not Obs or pred</span></span>
<span id="cb58-25"><a href="spatio-temporal-variation-models.html#cb58-25" tabindex="-1"></a>    }</span>
<span id="cb58-26"><a href="spatio-temporal-variation-models.html#cb58-26" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) </span>
<span id="cb58-27"><a href="spatio-temporal-variation-models.html#cb58-27" tabindex="-1"></a></span>
<span id="cb58-28"><a href="spatio-temporal-variation-models.html#cb58-28" tabindex="-1"></a><span class="do">## Prediction ##</span></span>
<span id="cb58-29"><a href="spatio-temporal-variation-models.html#cb58-29" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> new_df <span class="sc">%&gt;%</span>  </span>
<span id="cb58-30"><a href="spatio-temporal-variation-models.html#cb58-30" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">pred =</span> <span class="fu">map2</span>(df, Variable, <span class="sc">~</span>{</span>
<span id="cb58-31"><a href="spatio-temporal-variation-models.html#cb58-31" tabindex="-1"></a>    <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>){</span>
<span id="cb58-32"><a href="spatio-temporal-variation-models.html#cb58-32" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb58-33"><a href="spatio-temporal-variation-models.html#cb58-33" tabindex="-1"></a>        <span class="fu">bind_cols</span>(<span class="fu">predict</span>(GAM_obs,</span>
<span id="cb58-34"><a href="spatio-temporal-variation-models.html#cb58-34" tabindex="-1"></a>                          new_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span><span class="st">&quot;Yobs&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(df),</span>
<span id="cb58-35"><a href="spatio-temporal-variation-models.html#cb58-35" tabindex="-1"></a>                          <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-36"><a href="spatio-temporal-variation-models.html#cb58-36" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-37"><a href="spatio-temporal-variation-models.html#cb58-37" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="st">&quot;Yield_hat&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-38"><a href="spatio-temporal-variation-models.html#cb58-38" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y, Yield_hat,CP)</span>
<span id="cb58-39"><a href="spatio-temporal-variation-models.html#cb58-39" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) {</span>
<span id="cb58-40"><a href="spatio-temporal-variation-models.html#cb58-40" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb58-41"><a href="spatio-temporal-variation-models.html#cb58-41" tabindex="-1"></a>        <span class="fu">bind_cols</span>(<span class="fu">predict</span>(GAM_pred,</span>
<span id="cb58-42"><a href="spatio-temporal-variation-models.html#cb58-42" tabindex="-1"></a>                          new_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span><span class="st">&quot;Ypred&quot;</span>) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(df),</span>
<span id="cb58-43"><a href="spatio-temporal-variation-models.html#cb58-43" tabindex="-1"></a>                          <span class="at">se.fit =</span> <span class="cn">TRUE</span>, <span class="at">type =</span> <span class="st">&quot;response&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb58-44"><a href="spatio-temporal-variation-models.html#cb58-44" tabindex="-1"></a>                    <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb58-45"><a href="spatio-temporal-variation-models.html#cb58-45" tabindex="-1"></a>                    <span class="fu">rename</span>(<span class="st">&quot;Yield_hat&quot;</span> <span class="ot">=</span> <span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb58-46"><a href="spatio-temporal-variation-models.html#cb58-46" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y, Yield_hat,CP)</span>
<span id="cb58-47"><a href="spatio-temporal-variation-models.html#cb58-47" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb58-48"><a href="spatio-temporal-variation-models.html#cb58-48" tabindex="-1"></a>      .x  <span class="co"># Return the original data if the variable is not Obs or pred</span></span>
<span id="cb58-49"><a href="spatio-temporal-variation-models.html#cb58-49" tabindex="-1"></a>    }</span>
<span id="cb58-50"><a href="spatio-temporal-variation-models.html#cb58-50" tabindex="-1"></a>  }))</span></code></pre></div>
</div>
<div id="model-evaluation-1" class="section level3 hasAnchor" number="4.3.3">
<h3><span class="header-section-number">4.3.3</span> Model evaluation<a href="spatio-temporal-variation-models.html#model-evaluation-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Metrics values</strong></p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="spatio-temporal-variation-models.html#cb59-1" tabindex="-1"></a><span class="do">## Check summary ##</span></span>
<span id="cb59-2"><a href="spatio-temporal-variation-models.html#cb59-2" tabindex="-1"></a><span class="co">#summary(GAM_obs)</span></span>
<span id="cb59-3"><a href="spatio-temporal-variation-models.html#cb59-3" tabindex="-1"></a><span class="co">#summary(GAM_pred)</span></span>
<span id="cb59-4"><a href="spatio-temporal-variation-models.html#cb59-4" tabindex="-1"></a><span class="co">#gam.check(GAM_obs)</span></span>
<span id="cb59-5"><a href="spatio-temporal-variation-models.html#cb59-5" tabindex="-1"></a><span class="co">#gam.check(GAM_pred)</span></span></code></pre></div>
<p>Model performance will be evaluated using the following metrics: Relative Root Mean Square Error (RRMSE%), Percentage Lack of Precision (PLP%), Percentage Lack of Accuracy (PLA%), and Mean Absolute Error (MAE, same units that variable of response). Metrics equations are below:</p>
<p><span class="math display">\[
RRMSE = \frac{\sqrt{\frac{1}{n} \sum \left(Pred_i - Obs_i \right)^2}}{\bar{Obs}} \times 100\%
\]</span></p>
<p><span class="math inline">\(PLP = \frac{2 S_{Obs} S_{Pred} (1-r)}{\frac{1}{n} \sum{(Pred_i - Obs_i)^2} }* 100\)</span></p>
<p><span class="math inline">\(PLA = \frac{(\bar{Obs}-\bar{Pred})^2 + (S_{Obs} - S_{Pred})^2}{\frac{1}{n} \sum{(Pred_i - Obs_i)^2} } *100\)</span></p>
<p><span class="math inline">\(MAE = \frac{1}{n}\sum|Obs_i - Pred_i|\)</span></p>
<p>Lower values of RRMSE and MAE indicate better model performance. Similarly, for PLA and PLP, lower values reflect better model accuracy and precision. For instance, a PLP value of 90% and a PLA value of 10% suggest that the model predicts with higher accuracy than precision. For more details, refer to Correndo et al., 2021 and Correndo et al., 2022.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="spatio-temporal-variation-models.html#cb60-1" tabindex="-1"></a>Label <span class="ot">&lt;-</span> pred <span class="sc">%&gt;%</span>  </span>
<span id="cb60-2"><a href="spatio-temporal-variation-models.html#cb60-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="spatio-temporal-variation-models.html#cb60-3" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">metrics =</span> <span class="fu">map2</span>(pred, Variable, <span class="sc">~</span>{</span>
<span id="cb60-4"><a href="spatio-temporal-variation-models.html#cb60-4" tabindex="-1"></a>    <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>){</span>
<span id="cb60-5"><a href="spatio-temporal-variation-models.html#cb60-5" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="spatio-temporal-variation-models.html#cb60-6" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="spatio-temporal-variation-models.html#cb60-7" tabindex="-1"></a>        <span class="fu">drop_na</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-8"><a href="spatio-temporal-variation-models.html#cb60-8" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">RRMSE =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">RRMSE</span>(<span class="at">obs=</span>Value,<span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb60-9"><a href="spatio-temporal-variation-models.html#cb60-9" tabindex="-1"></a>               <span class="at">PLP =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">PLP</span>(<span class="at">obs=</span>Value, <span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]],<span class="dv">0</span>),</span>
<span id="cb60-10"><a href="spatio-temporal-variation-models.html#cb60-10" tabindex="-1"></a>               <span class="at">PLA =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">PLA</span>(<span class="at">obs=</span>Value, <span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]],<span class="dv">0</span>),</span>
<span id="cb60-11"><a href="spatio-temporal-variation-models.html#cb60-11" tabindex="-1"></a>               <span class="at">MAE =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(Value <span class="sc">-</span> Yield_hat)),<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-12"><a href="spatio-temporal-variation-models.html#cb60-12" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(RRMSE, PLP, PLA, MAE) <span class="sc">%&gt;%</span> </span>
<span id="cb60-13"><a href="spatio-temporal-variation-models.html#cb60-13" tabindex="-1"></a>        <span class="fu">distinct</span>()</span>
<span id="cb60-14"><a href="spatio-temporal-variation-models.html#cb60-14" tabindex="-1"></a>    } <span class="cf">else</span> <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) {</span>
<span id="cb60-15"><a href="spatio-temporal-variation-models.html#cb60-15" tabindex="-1"></a>      .x <span class="sc">%&gt;%</span> </span>
<span id="cb60-16"><a href="spatio-temporal-variation-models.html#cb60-16" tabindex="-1"></a>        <span class="fu">st_drop_geometry</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-17"><a href="spatio-temporal-variation-models.html#cb60-17" tabindex="-1"></a>        <span class="fu">mutate</span>(<span class="at">RRMSE =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">RRMSE</span>(<span class="at">obs=</span>Value,<span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]]<span class="sc">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb60-18"><a href="spatio-temporal-variation-models.html#cb60-18" tabindex="-1"></a>               <span class="at">PLP =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">PLP</span>(<span class="at">obs=</span>Value, <span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]],<span class="dv">0</span>),</span>
<span id="cb60-19"><a href="spatio-temporal-variation-models.html#cb60-19" tabindex="-1"></a>               <span class="at">PLA =</span> <span class="fu">round</span>(metrica<span class="sc">::</span><span class="fu">PLA</span>(<span class="at">obs=</span>Value, <span class="at">pred=</span>Yield_hat)[[<span class="dv">1</span>]],<span class="dv">0</span>),</span>
<span id="cb60-20"><a href="spatio-temporal-variation-models.html#cb60-20" tabindex="-1"></a>               <span class="at">MAE =</span> <span class="fu">round</span>(<span class="fu">mean</span>(<span class="fu">abs</span>(Value <span class="sc">-</span> Yield_hat)),<span class="dv">0</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb60-21"><a href="spatio-temporal-variation-models.html#cb60-21" tabindex="-1"></a>        dplyr<span class="sc">::</span><span class="fu">select</span>(RRMSE, PLP, PLA, MAE) <span class="sc">%&gt;%</span> </span>
<span id="cb60-22"><a href="spatio-temporal-variation-models.html#cb60-22" tabindex="-1"></a>        <span class="fu">distinct</span>()</span>
<span id="cb60-23"><a href="spatio-temporal-variation-models.html#cb60-23" tabindex="-1"></a>    } <span class="cf">else</span> {</span>
<span id="cb60-24"><a href="spatio-temporal-variation-models.html#cb60-24" tabindex="-1"></a>      .x</span>
<span id="cb60-25"><a href="spatio-temporal-variation-models.html#cb60-25" tabindex="-1"></a>    }</span>
<span id="cb60-26"><a href="spatio-temporal-variation-models.html#cb60-26" tabindex="-1"></a>  })) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>pred) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(metrics) <span class="sc">%&gt;%</span> </span>
<span id="cb60-27"><a href="spatio-temporal-variation-models.html#cb60-27" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="sc">-</span>Variable, <span class="at">names_to =</span> <span class="st">&quot;Metric&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Value&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb60-28"><a href="spatio-temporal-variation-models.html#cb60-28" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Label =</span> <span class="fu">paste</span>(Metric, <span class="st">&quot;=&quot;</span>, Value))</span>
<span id="cb60-29"><a href="spatio-temporal-variation-models.html#cb60-29" tabindex="-1"></a></span>
<span id="cb60-30"><a href="spatio-temporal-variation-models.html#cb60-30" tabindex="-1"></a><span class="co"># Prepare label positions</span></span>
<span id="cb60-31"><a href="spatio-temporal-variation-models.html#cb60-31" tabindex="-1"></a>num_metrics <span class="ot">&lt;-</span> <span class="fu">n_distinct</span>(Label<span class="sc">$</span>Metric)</span>
<span id="cb60-32"><a href="spatio-temporal-variation-models.html#cb60-32" tabindex="-1"></a>y_positions <span class="ot">&lt;-</span> <span class="fu">seq</span>(<span class="dv">20000</span>, <span class="at">by =</span> <span class="sc">-</span><span class="dv">1000</span>, <span class="at">length.out =</span> num_metrics)</span>
<span id="cb60-33"><a href="spatio-temporal-variation-models.html#cb60-33" tabindex="-1"></a>Label <span class="ot">&lt;-</span> Label <span class="sc">%&gt;%</span><span class="fu">mutate</span>(<span class="at">y_position =</span> <span class="fu">rep</span>(y_positions, <span class="at">times =</span> <span class="fu">n_distinct</span>(Variable)))</span></code></pre></div>
<p><strong>Plot observed vs predicted</strong></p>
<p>Plot observed vs predicted for both observed yield monitor data (Yobs) and predicted yield monitor data (Ypred) using sentinel-2. The color of the points correspond to each pixel within the field.</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="spatio-temporal-variation-models.html#cb61-1" tabindex="-1"></a>ObsPred <span class="ot">&lt;-</span> pred <span class="sc">%&gt;%</span></span>
<span id="cb61-2"><a href="spatio-temporal-variation-models.html#cb61-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>data) <span class="sc">%&gt;%</span> </span>
<span id="cb61-3"><a href="spatio-temporal-variation-models.html#cb61-3" tabindex="-1"></a>  <span class="fu">unnest</span>(pred) <span class="sc">%&gt;%</span> </span>
<span id="cb61-4"><a href="spatio-temporal-variation-models.html#cb61-4" tabindex="-1"></a>  <span class="fu">group_by</span>(X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb61-5"><a href="spatio-temporal-variation-models.html#cb61-5" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">!=</span> <span class="st">&quot;Pgcvi&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb61-6"><a href="spatio-temporal-variation-models.html#cb61-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb61-7"><a href="spatio-temporal-variation-models.html#cb61-7" tabindex="-1"></a>  <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb61-8"><a href="spatio-temporal-variation-models.html#cb61-8" tabindex="-1"></a>  <span class="fu">geom_point</span>(<span class="fu">aes</span>(<span class="at">x =</span> Yield_hat, <span class="at">y =</span>Value, <span class="at">fill =</span> ID), </span>
<span id="cb61-9"><a href="spatio-temporal-variation-models.html#cb61-9" tabindex="-1"></a>             <span class="at">shape =</span> <span class="dv">21</span>, <span class="at">size =</span> <span class="fl">2.5</span>,<span class="at">color=</span><span class="st">&quot;black&quot;</span>,<span class="at">alpha=</span>.<span class="dv">7</span>, <span class="at">show.legend=</span>F)<span class="sc">+</span></span>
<span id="cb61-10"><a href="spatio-temporal-variation-models.html#cb61-10" tabindex="-1"></a>  <span class="fu">scale_fill_gradientn</span>(<span class="at">colors =</span> grad_id)<span class="sc">+</span></span>
<span id="cb61-11"><a href="spatio-temporal-variation-models.html#cb61-11" tabindex="-1"></a>  <span class="fu">geom_abline</span>(<span class="at">intercept =</span> <span class="dv">0</span>, <span class="at">slope =</span> <span class="dv">1</span>, <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>, <span class="at">size =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb61-12"><a href="spatio-temporal-variation-models.html#cb61-12" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">5000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20000</span>))<span class="sc">+</span></span>
<span id="cb61-13"><a href="spatio-temporal-variation-models.html#cb61-13" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>, <span class="dv">20000</span>, <span class="dv">5000</span>), <span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">20000</span>))<span class="sc">+</span></span>
<span id="cb61-14"><a href="spatio-temporal-variation-models.html#cb61-14" tabindex="-1"></a>  <span class="fu">facet_wrap</span>(<span class="sc">~</span>Variable)<span class="sc">+</span></span>
<span id="cb61-15"><a href="spatio-temporal-variation-models.html#cb61-15" tabindex="-1"></a>  <span class="fu">geom_text</span>(<span class="at">data =</span> Label, </span>
<span id="cb61-16"><a href="spatio-temporal-variation-models.html#cb61-16" tabindex="-1"></a>            <span class="fu">aes</span>(<span class="at">x =</span> <span class="dv">0</span>, <span class="at">y =</span> y_position, <span class="at">label =</span> Label), <span class="at">hjust =</span> <span class="dv">0</span>, <span class="at">size =</span><span class="dv">3</span>) <span class="sc">+</span></span>
<span id="cb61-17"><a href="spatio-temporal-variation-models.html#cb61-17" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">y =</span> <span class="fu">expression</span>(Observed<span class="sc">~</span>yield<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^-</span><span class="dv">1</span>)),</span>
<span id="cb61-18"><a href="spatio-temporal-variation-models.html#cb61-18" tabindex="-1"></a>       <span class="at">x =</span> <span class="fu">expression</span>(Predicted<span class="sc">~</span>yield<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^-</span><span class="dv">1</span>)))<span class="sc">+</span></span>
<span id="cb61-19"><a href="spatio-temporal-variation-models.html#cb61-19" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb61-20"><a href="spatio-temporal-variation-models.html#cb61-20" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>,<span class="at">family =</span> <span class="st">&quot;sans&quot;</span>),</span>
<span id="cb61-21"><a href="spatio-temporal-variation-models.html#cb61-21" tabindex="-1"></a>        <span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-22"><a href="spatio-temporal-variation-models.html#cb61-22" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#eeeeee&quot;</span>),</span>
<span id="cb61-23"><a href="spatio-temporal-variation-models.html#cb61-23" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#f8f9fa&quot;</span>),</span>
<span id="cb61-24"><a href="spatio-temporal-variation-models.html#cb61-24" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb61-25"><a href="spatio-temporal-variation-models.html#cb61-25" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb61-26"><a href="spatio-temporal-variation-models.html#cb61-26" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb61-27"><a href="spatio-temporal-variation-models.html#cb61-27" tabindex="-1"></a>        <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))</span>
<span id="cb61-28"><a href="spatio-temporal-variation-models.html#cb61-28" tabindex="-1"></a>ObsPred</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-47-1.png" width="576" /></p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="spatio-temporal-variation-models.html#cb62-1" tabindex="-1"></a><span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/5_GAM_Obs_Pred/ObsPred_&quot;</span>,FIELD_NAME, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb62-2"><a href="spatio-temporal-variation-models.html#cb62-2" tabindex="-1"></a>       <span class="at">height =</span> <span class="fl">3.5</span>, <span class="at">width =</span> <span class="dv">6</span>)</span></code></pre></div>
</div>
<div id="spatially-varying-parameters" class="section level3 hasAnchor" number="4.3.4">
<h3><span class="header-section-number">4.3.4</span> Spatially Varying Parameters<a href="spatio-temporal-variation-models.html#spatially-varying-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p><strong>Obtain derivatives</strong></p>
<p>Spatially varying response parameters were derived from the GAM. Maximum yield at each coordinate was determined based on the first derivative of yield response to cumulative precipitation: it was obtained at the point where the derivative crosses zero, or at the point closest to zero if the maximum is not reached. For a flat yield response, the minimum extreme of cumulative precipitation was used. Additionally, the corresponding cumulative precipitation that maximizes yield was identified.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="spatio-temporal-variation-models.html#cb63-1" tabindex="-1"></a>pred_df <span class="ot">&lt;-</span> </span>
<span id="cb63-2"><a href="spatio-temporal-variation-models.html#cb63-2" tabindex="-1"></a>pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-3"><a href="spatio-temporal-variation-models.html#cb63-3" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>df) <span class="sc">%&gt;%</span> </span>
<span id="cb63-4"><a href="spatio-temporal-variation-models.html#cb63-4" tabindex="-1"></a>  <span class="fu">unnest</span>(pred) <span class="sc">%&gt;%</span> </span>
<span id="cb63-5"><a href="spatio-temporal-variation-models.html#cb63-5" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-6"><a href="spatio-temporal-variation-models.html#cb63-6" tabindex="-1"></a>  <span class="fu">group_by</span>(X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb63-7"><a href="spatio-temporal-variation-models.html#cb63-7" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-8"><a href="spatio-temporal-variation-models.html#cb63-8" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable, X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb63-9"><a href="spatio-temporal-variation-models.html#cb63-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">CP =</span> <span class="fu">round</span>(CP, <span class="dv">3</span>))<span class="sc">%&gt;%</span></span>
<span id="cb63-10"><a href="spatio-temporal-variation-models.html#cb63-10" tabindex="-1"></a>  <span class="co"># Calculate derivative</span></span>
<span id="cb63-11"><a href="spatio-temporal-variation-models.html#cb63-11" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">der1 =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(Yield_hat)<span class="sc">/</span><span class="fu">diff</span>(CP))) </span>
<span id="cb63-12"><a href="spatio-temporal-variation-models.html#cb63-12" tabindex="-1"></a><span class="fu">write.csv</span>(pred_df, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/6_GAMs_pred/pred_&quot;</span>,FIELD_NAME,<span class="st">&quot;.csv&quot;</span>), <span class="at">row.names =</span> F)</span>
<span id="cb63-13"><a href="spatio-temporal-variation-models.html#cb63-13" tabindex="-1"></a></span>
<span id="cb63-14"><a href="spatio-temporal-variation-models.html#cb63-14" tabindex="-1"></a>max_CP <span class="ot">&lt;-</span> </span>
<span id="cb63-15"><a href="spatio-temporal-variation-models.html#cb63-15" tabindex="-1"></a>  pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb63-16"><a href="spatio-temporal-variation-models.html#cb63-16" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">der1_sign_change =</span> <span class="fu">c</span>(<span class="cn">NA</span>, <span class="fu">diff</span>(<span class="fu">sign</span>(der1))),</span>
<span id="cb63-17"><a href="spatio-temporal-variation-models.html#cb63-17" tabindex="-1"></a>         <span class="at">count =</span> <span class="fu">any</span>(der1_sign_change <span class="sc">!=</span> <span class="dv">0</span>),</span>
<span id="cb63-18"><a href="spatio-temporal-variation-models.html#cb63-18" tabindex="-1"></a>         <span class="at">reach_max =</span> <span class="fu">case_when</span>(count <span class="sc">==</span> <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;yes&quot;</span>,</span>
<span id="cb63-19"><a href="spatio-temporal-variation-models.html#cb63-19" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;no&quot;</span> )) <span class="sc">%&gt;%</span> </span>
<span id="cb63-20"><a href="spatio-temporal-variation-models.html#cb63-20" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(der1 <span class="sc">!=</span><span class="fu">is.na</span>(der1)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-21"><a href="spatio-temporal-variation-models.html#cb63-21" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(der1),</span>
<span id="cb63-22"><a href="spatio-temporal-variation-models.html#cb63-22" tabindex="-1"></a>           <span class="at">sd =</span> <span class="fu">sd</span>(der1),</span>
<span id="cb63-23"><a href="spatio-temporal-variation-models.html#cb63-23" tabindex="-1"></a>           <span class="at">cv =</span> <span class="fu">abs</span>((sd <span class="sc">/</span> mean) <span class="sc">*</span> <span class="dv">100</span>),</span>
<span id="cb63-24"><a href="spatio-temporal-variation-models.html#cb63-24" tabindex="-1"></a>           <span class="do">## Variation of the 1st derivative ##</span></span>
<span id="cb63-25"><a href="spatio-temporal-variation-models.html#cb63-25" tabindex="-1"></a>           <span class="at">cv_range =</span> <span class="fu">case_when</span>(</span>
<span id="cb63-26"><a href="spatio-temporal-variation-models.html#cb63-26" tabindex="-1"></a>             cv <span class="sc">&lt;=</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">&quot;No_var&quot;</span>,</span>
<span id="cb63-27"><a href="spatio-temporal-variation-models.html#cb63-27" tabindex="-1"></a>             cv <span class="sc">&gt;</span> <span class="dv">80</span> <span class="sc">~</span> <span class="st">&quot;Var&quot;</span> )) <span class="sc">%&gt;%</span> </span>
<span id="cb63-28"><a href="spatio-temporal-variation-models.html#cb63-28" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable,X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb63-29"><a href="spatio-temporal-variation-models.html#cb63-29" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">row_number =</span> <span class="fu">row_number</span>()) <span class="sc">%&gt;%</span></span>
<span id="cb63-30"><a href="spatio-temporal-variation-models.html#cb63-30" tabindex="-1"></a>  <span class="co"># The first row where the derivative changes sign was found.</span></span>
<span id="cb63-31"><a href="spatio-temporal-variation-models.html#cb63-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">first_sign_change_row =</span> <span class="fu">min</span>(row_number[der1_sign_change <span class="sc">!=</span> <span class="dv">0</span>], <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-32"><a href="spatio-temporal-variation-models.html#cb63-32" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable,X,Y, reach_max, cv_range) <span class="sc">%&gt;%</span> </span>
<span id="cb63-33"><a href="spatio-temporal-variation-models.html#cb63-33" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-34"><a href="spatio-temporal-variation-models.html#cb63-34" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb63-35"><a href="spatio-temporal-variation-models.html#cb63-35" tabindex="-1"></a>    <span class="at">check_resp =</span> <span class="fu">map2</span>(data, reach_max,<span class="sc">~</span>{</span>
<span id="cb63-36"><a href="spatio-temporal-variation-models.html#cb63-36" tabindex="-1"></a>      <span class="cf">if</span> (.y <span class="sc">==</span> <span class="st">&quot;yes&quot;</span>) {</span>
<span id="cb63-37"><a href="spatio-temporal-variation-models.html#cb63-37" tabindex="-1"></a>        .x <span class="sc">%&gt;%</span> </span>
<span id="cb63-38"><a href="spatio-temporal-variation-models.html#cb63-38" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">filter</span>(row_number <span class="sc">&lt;</span> first_sign_change_row) <span class="sc">%&gt;%</span>  </span>
<span id="cb63-39"><a href="spatio-temporal-variation-models.html#cb63-39" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">check_resp =</span> <span class="fu">mean</span>(der1, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-40"><a href="spatio-temporal-variation-models.html#cb63-40" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(check_resp) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb63-41"><a href="spatio-temporal-variation-models.html#cb63-41" tabindex="-1"></a>        } <span class="cf">else</span> {</span>
<span id="cb63-42"><a href="spatio-temporal-variation-models.html#cb63-42" tabindex="-1"></a>        .x <span class="sc">%&gt;%</span> </span>
<span id="cb63-43"><a href="spatio-temporal-variation-models.html#cb63-43" tabindex="-1"></a>          <span class="fu">mutate</span>(<span class="at">check_resp =</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb63-44"><a href="spatio-temporal-variation-models.html#cb63-44" tabindex="-1"></a>          dplyr<span class="sc">::</span><span class="fu">select</span>(check_resp) <span class="sc">%&gt;%</span> <span class="fu">as.data.frame</span>() <span class="sc">%&gt;%</span> <span class="fu">unique</span>()</span>
<span id="cb63-45"><a href="spatio-temporal-variation-models.html#cb63-45" tabindex="-1"></a>          }</span>
<span id="cb63-46"><a href="spatio-temporal-variation-models.html#cb63-46" tabindex="-1"></a>      })) <span class="sc">%&gt;%</span> </span>
<span id="cb63-47"><a href="spatio-temporal-variation-models.html#cb63-47" tabindex="-1"></a>  <span class="fu">unnest</span>(check_resp) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb63-48"><a href="spatio-temporal-variation-models.html#cb63-48" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">resp =</span> <span class="fu">case_when</span>(check_resp <span class="sc">&lt;</span> <span class="dv">0</span> <span class="sc">~</span> <span class="st">&quot;negative_resp&quot;</span>, <span class="cn">TRUE</span> <span class="sc">~</span> <span class="st">&quot;resp&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-49"><a href="spatio-temporal-variation-models.html#cb63-49" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable,X,Y, reach_max, cv_range, resp) <span class="sc">%&gt;%</span> </span>
<span id="cb63-50"><a href="spatio-temporal-variation-models.html#cb63-50" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-51"><a href="spatio-temporal-variation-models.html#cb63-51" tabindex="-1"></a> <span class="co"># dplyr::filter(reach_max == &quot;no&quot; &amp; resp == &quot;resp&quot; ) </span></span>
<span id="cb63-52"><a href="spatio-temporal-variation-models.html#cb63-52" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_CP =</span> <span class="fu">case_when</span>(</span>
<span id="cb63-53"><a href="spatio-temporal-variation-models.html#cb63-53" tabindex="-1"></a>  <span class="do">## when reach maximum yield ##</span></span>
<span id="cb63-54"><a href="spatio-temporal-variation-models.html#cb63-54" tabindex="-1"></a>    reach_max <span class="sc">==</span> <span class="st">&quot;yes&quot;</span> <span class="sc">&amp;</span> resp <span class="sc">==</span> <span class="st">&quot;resp&quot;</span> <span class="sc">~</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb63-55"><a href="spatio-temporal-variation-models.html#cb63-55" tabindex="-1"></a>      <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span></span>
<span id="cb63-56"><a href="spatio-temporal-variation-models.html#cb63-56" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(der1_sign_change <span class="sc">!=</span> <span class="dv">0</span>) <span class="sc">%&gt;%</span></span>
<span id="cb63-57"><a href="spatio-temporal-variation-models.html#cb63-57" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(CP) <span class="sc">%&gt;%</span> </span>
<span id="cb63-58"><a href="spatio-temporal-variation-models.html#cb63-58" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">max_CP =</span> CP)),</span>
<span id="cb63-59"><a href="spatio-temporal-variation-models.html#cb63-59" tabindex="-1"></a>    <span class="do">## when plateau but is negative (false maximum) ##</span></span>
<span id="cb63-60"><a href="spatio-temporal-variation-models.html#cb63-60" tabindex="-1"></a>    reach_max <span class="sc">==</span> <span class="st">&quot;yes&quot;</span> <span class="sc">&amp;</span> resp <span class="sc">==</span> <span class="st">&quot;negative_resp&quot;</span> <span class="sc">~</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb63-61"><a href="spatio-temporal-variation-models.html#cb63-61" tabindex="-1"></a>      <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb63-62"><a href="spatio-temporal-variation-models.html#cb63-62" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(der1 <span class="sc">!=</span> <span class="fu">is.na</span>(der1)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-63"><a href="spatio-temporal-variation-models.html#cb63-63" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(Yield_hat <span class="sc">==</span> <span class="fu">max</span>(Yield_hat)) <span class="sc">%&gt;%</span>  </span>
<span id="cb63-64"><a href="spatio-temporal-variation-models.html#cb63-64" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(CP)<span class="sc">%&gt;%</span> </span>
<span id="cb63-65"><a href="spatio-temporal-variation-models.html#cb63-65" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">max_CP =</span> CP)),</span>
<span id="cb63-66"><a href="spatio-temporal-variation-models.html#cb63-66" tabindex="-1"></a>  <span class="do">## Don&#39;t reach maximum but is not a flat resp., select the point more near to 0 ##</span></span>
<span id="cb63-67"><a href="spatio-temporal-variation-models.html#cb63-67" tabindex="-1"></a>    reach_max <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">&amp;</span> cv_range <span class="sc">==</span> <span class="st">&quot;Var&quot;</span> <span class="sc">&amp;</span> resp <span class="sc">==</span> <span class="st">&quot;resp&quot;</span> <span class="sc">~</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb63-68"><a href="spatio-temporal-variation-models.html#cb63-68" tabindex="-1"></a>      <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb63-69"><a href="spatio-temporal-variation-models.html#cb63-69" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(der1 <span class="sc">!=</span> <span class="fu">is.na</span>(der1)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-70"><a href="spatio-temporal-variation-models.html#cb63-70" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">abs</span>(der1) <span class="sc">==</span> <span class="fu">min</span>(<span class="fu">abs</span>(der1))) <span class="sc">%&gt;%</span> </span>
<span id="cb63-71"><a href="spatio-temporal-variation-models.html#cb63-71" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(CP)<span class="sc">%&gt;%</span> </span>
<span id="cb63-72"><a href="spatio-temporal-variation-models.html#cb63-72" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">max_CP =</span> CP)),</span>
<span id="cb63-73"><a href="spatio-temporal-variation-models.html#cb63-73" tabindex="-1"></a>  <span class="do">## Flat response: select the maximum yield ##</span></span>
<span id="cb63-74"><a href="spatio-temporal-variation-models.html#cb63-74" tabindex="-1"></a>    reach_max <span class="sc">==</span> <span class="st">&quot;no&quot;</span> <span class="sc">&amp;</span> cv_range <span class="sc">==</span> <span class="st">&quot;No_var&quot;</span> <span class="sc">&amp;</span> resp <span class="sc">==</span> <span class="st">&quot;resp&quot;</span> <span class="sc">~</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb63-75"><a href="spatio-temporal-variation-models.html#cb63-75" tabindex="-1"></a>      <span class="fu">map</span>(.,<span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb63-76"><a href="spatio-temporal-variation-models.html#cb63-76" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(der1 <span class="sc">!=</span> <span class="fu">is.na</span>(der1)) <span class="sc">%&gt;%</span> </span>
<span id="cb63-77"><a href="spatio-temporal-variation-models.html#cb63-77" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(Yield_hat <span class="sc">==</span> <span class="fu">max</span>(Yield_hat)) <span class="sc">%&gt;%</span>  </span>
<span id="cb63-78"><a href="spatio-temporal-variation-models.html#cb63-78" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(CP)<span class="sc">%&gt;%</span> </span>
<span id="cb63-79"><a href="spatio-temporal-variation-models.html#cb63-79" tabindex="-1"></a>            <span class="fu">rename</span>(<span class="at">max_CP =</span> CP)))) <span class="sc">%&gt;%</span> </span>
<span id="cb63-80"><a href="spatio-temporal-variation-models.html#cb63-80" tabindex="-1"></a>  <span class="fu">unnest</span>(max_CP) <span class="sc">%&gt;%</span> <span class="fu">unnest</span>(data) <span class="sc">%&gt;%</span> </span>
<span id="cb63-81"><a href="spatio-temporal-variation-models.html#cb63-81" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(CP <span class="sc">==</span> max_CP) <span class="sc">%&gt;%</span> </span>
<span id="cb63-82"><a href="spatio-temporal-variation-models.html#cb63-82" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb63-83"><a href="spatio-temporal-variation-models.html#cb63-83" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span><span class="fu">c</span>(mean, sd, cv, count))</span></code></pre></div>
<p><strong>plot derivative to check</strong></p>
<p>Plot the derivative for both observed yield (Yobs) and predicted yield (Ypred) at specific coordinates within the field to determine if the crop yield response to precipitation is consistent at those coordinates using both yields variables. For example, a negative response using Yobs in the yield data might differ significantly when compared to the Ypred response at the same coordinate, indicating potential discrepancies between the Yobs and Ypred data.</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="spatio-temporal-variation-models.html#cb64-1" tabindex="-1"></a>pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb64-2"><a href="spatio-temporal-variation-models.html#cb64-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-3"><a href="spatio-temporal-variation-models.html#cb64-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb64-4"><a href="spatio-temporal-variation-models.html#cb64-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb64-5"><a href="spatio-temporal-variation-models.html#cb64-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Yield_hat, der1), <span class="at">names_to =</span> <span class="st">&quot;Var&quot;</span>,<span class="at">values_to =</span><span class="st">&quot;Val&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-6"><a href="spatio-temporal-variation-models.html#cb64-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP, <span class="at">y =</span> Val, <span class="at">group =</span> ID))<span class="sc">+</span></span>
<span id="cb64-7"><a href="spatio-temporal-variation-models.html#cb64-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> .<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb64-8"><a href="spatio-temporal-variation-models.html#cb64-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> CP), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb64-9"><a href="spatio-temporal-variation-models.html#cb64-9" tabindex="-1"></a>             <span class="at">data =</span> max_CP <span class="sc">%&gt;%</span> </span>
<span id="cb64-10"><a href="spatio-temporal-variation-models.html#cb64-10" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Yobs&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb64-11"><a href="spatio-temporal-variation-models.html#cb64-11" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>))) <span class="sc">+</span></span>
<span id="cb64-12"><a href="spatio-temporal-variation-models.html#cb64-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Var<span class="sc">~</span>ID, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, </span>
<span id="cb64-13"><a href="spatio-temporal-variation-models.html#cb64-13" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Var =</span> <span class="fu">c</span>(<span class="at">Yield_hat =</span> <span class="st">&quot;Predicted  yield&quot;</span>, </span>
<span id="cb64-14"><a href="spatio-temporal-variation-models.html#cb64-14" tabindex="-1"></a>                                         <span class="at">der1 =</span> <span class="st">&quot;1st  Derivative&quot;</span>)))<span class="sc">+</span></span>
<span id="cb64-15"><a href="spatio-temporal-variation-models.html#cb64-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cumulative precipitation (mm)&quot;</span>,</span>
<span id="cb64-16"><a href="spatio-temporal-variation-models.html#cb64-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb64-17"><a href="spatio-temporal-variation-models.html#cb64-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb64-18"><a href="spatio-temporal-variation-models.html#cb64-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-19"><a href="spatio-temporal-variation-models.html#cb64-19" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb64-20"><a href="spatio-temporal-variation-models.html#cb64-20" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#eeeeee&quot;</span>),</span>
<span id="cb64-21"><a href="spatio-temporal-variation-models.html#cb64-21" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#f8f9fa&quot;</span>),</span>
<span id="cb64-22"><a href="spatio-temporal-variation-models.html#cb64-22" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb64-23"><a href="spatio-temporal-variation-models.html#cb64-23" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb64-24"><a href="spatio-temporal-variation-models.html#cb64-24" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb64-25"><a href="spatio-temporal-variation-models.html#cb64-25" tabindex="-1"></a>        <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-49-1.png" width="624" /></p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="spatio-temporal-variation-models.html#cb65-1" tabindex="-1"></a>pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb65-2"><a href="spatio-temporal-variation-models.html#cb65-2" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-3"><a href="spatio-temporal-variation-models.html#cb65-3" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb65-4"><a href="spatio-temporal-variation-models.html#cb65-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb65-5"><a href="spatio-temporal-variation-models.html#cb65-5" tabindex="-1"></a>  <span class="fu">pivot_longer</span>(<span class="fu">c</span>(Yield_hat, der1), <span class="at">names_to =</span> <span class="st">&quot;Var&quot;</span>,<span class="at">values_to =</span><span class="st">&quot;Val&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-6"><a href="spatio-temporal-variation-models.html#cb65-6" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP, <span class="at">y =</span> Val, <span class="at">group =</span> ID))<span class="sc">+</span></span>
<span id="cb65-7"><a href="spatio-temporal-variation-models.html#cb65-7" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">linewidth =</span> .<span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb65-8"><a href="spatio-temporal-variation-models.html#cb65-8" tabindex="-1"></a>  <span class="fu">geom_vline</span>(<span class="fu">aes</span>(<span class="at">xintercept =</span> CP), <span class="at">linetype =</span> <span class="st">&quot;dotted&quot;</span>,</span>
<span id="cb65-9"><a href="spatio-temporal-variation-models.html#cb65-9" tabindex="-1"></a>             <span class="at">data =</span> max_CP <span class="sc">%&gt;%</span> </span>
<span id="cb65-10"><a href="spatio-temporal-variation-models.html#cb65-10" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> <span class="st">&quot;Ypred&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb65-11"><a href="spatio-temporal-variation-models.html#cb65-11" tabindex="-1"></a>               dplyr<span class="sc">::</span><span class="fu">filter</span>(ID <span class="sc">%in%</span> <span class="fu">c</span>(<span class="dv">10</span>,<span class="dv">100</span>,<span class="dv">500</span>,<span class="dv">1000</span>,<span class="dv">1500</span>,<span class="dv">2000</span>))) <span class="sc">+</span></span>
<span id="cb65-12"><a href="spatio-temporal-variation-models.html#cb65-12" tabindex="-1"></a>  <span class="fu">facet_grid</span>(Var<span class="sc">~</span>ID, <span class="at">scales =</span> <span class="st">&quot;free_y&quot;</span>, </span>
<span id="cb65-13"><a href="spatio-temporal-variation-models.html#cb65-13" tabindex="-1"></a>             <span class="at">labeller =</span> <span class="fu">labeller</span>(<span class="at">Var =</span> <span class="fu">c</span>(<span class="at">Yield_hat =</span> <span class="st">&quot;Predicted  yield&quot;</span>, </span>
<span id="cb65-14"><a href="spatio-temporal-variation-models.html#cb65-14" tabindex="-1"></a>                                         <span class="at">der1 =</span> <span class="st">&quot;1st  Derivative&quot;</span>)))<span class="sc">+</span></span>
<span id="cb65-15"><a href="spatio-temporal-variation-models.html#cb65-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cumulative precipitation (mm)&quot;</span>,</span>
<span id="cb65-16"><a href="spatio-temporal-variation-models.html#cb65-16" tabindex="-1"></a>       <span class="at">y =</span> <span class="st">&quot;&quot;</span>)<span class="sc">+</span></span>
<span id="cb65-17"><a href="spatio-temporal-variation-models.html#cb65-17" tabindex="-1"></a>  <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb65-18"><a href="spatio-temporal-variation-models.html#cb65-18" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb65-19"><a href="spatio-temporal-variation-models.html#cb65-19" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb65-20"><a href="spatio-temporal-variation-models.html#cb65-20" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#eeeeee&quot;</span>),</span>
<span id="cb65-21"><a href="spatio-temporal-variation-models.html#cb65-21" tabindex="-1"></a>        <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#f8f9fa&quot;</span>),</span>
<span id="cb65-22"><a href="spatio-temporal-variation-models.html#cb65-22" tabindex="-1"></a>        <span class="at">panel.grid.minor =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb65-23"><a href="spatio-temporal-variation-models.html#cb65-23" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">7</span>),</span>
<span id="cb65-24"><a href="spatio-temporal-variation-models.html#cb65-24" tabindex="-1"></a>        <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb65-25"><a href="spatio-temporal-variation-models.html#cb65-25" tabindex="-1"></a>        <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-49-2.png" width="624" /></p>
<p><strong>Obtain SVRP</strong></p>
<p>Growth rate was calculated from the start to the maximum yield, while decay rate was assessed from the maximum yield to the end. If the maximum yield is not reached, a rate of 0 is assigned, and it is noted in the dataset that the maximum yield response to cumulative rainfall was not achieved at that coordinate.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="spatio-temporal-variation-models.html#cb66-1" tabindex="-1"></a><span class="do">## Dataframe ##</span></span>
<span id="cb66-2"><a href="spatio-temporal-variation-models.html#cb66-2" tabindex="-1"></a>param_df <span class="ot">&lt;-</span> </span>
<span id="cb66-3"><a href="spatio-temporal-variation-models.html#cb66-3" tabindex="-1"></a>pred_df <span class="sc">%&gt;%</span> </span>
<span id="cb66-4"><a href="spatio-temporal-variation-models.html#cb66-4" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(der1 <span class="sc">!=</span> <span class="fu">is.na</span>(der1)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-5"><a href="spatio-temporal-variation-models.html#cb66-5" tabindex="-1"></a>  <span class="fu">left_join</span>(max_CP <span class="sc">%&gt;%</span> </span>
<span id="cb66-6"><a href="spatio-temporal-variation-models.html#cb66-6" tabindex="-1"></a>              dplyr<span class="sc">::</span><span class="fu">select</span>(Variable, ID, CP, reach_max) <span class="sc">%&gt;%</span> </span>
<span id="cb66-7"><a href="spatio-temporal-variation-models.html#cb66-7" tabindex="-1"></a>              <span class="fu">rename</span>(<span class="at">max_CP =</span> CP), <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Variable&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-8"><a href="spatio-temporal-variation-models.html#cb66-8" tabindex="-1"></a>  <span class="fu">group_by</span>(Variable,ID) <span class="sc">%&gt;%</span> </span>
<span id="cb66-9"><a href="spatio-temporal-variation-models.html#cb66-9" tabindex="-1"></a>  <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-10"><a href="spatio-temporal-variation-models.html#cb66-10" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb66-11"><a href="spatio-temporal-variation-models.html#cb66-11" tabindex="-1"></a>    <span class="do">## Growth rate ##</span></span>
<span id="cb66-12"><a href="spatio-temporal-variation-models.html#cb66-12" tabindex="-1"></a>    <span class="at">growth_rate =</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb66-13"><a href="spatio-temporal-variation-models.html#cb66-13" tabindex="-1"></a>      <span class="fu">map</span>(., <span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb66-14"><a href="spatio-temporal-variation-models.html#cb66-14" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(CP <span class="sc">&lt;=</span> max_CP) <span class="sc">%&gt;%</span> </span>
<span id="cb66-15"><a href="spatio-temporal-variation-models.html#cb66-15" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">growth_rate =</span><span class="fu">case_when</span>(</span>
<span id="cb66-16"><a href="spatio-temporal-variation-models.html#cb66-16" tabindex="-1"></a>              max_CP <span class="sc">==</span> <span class="fu">min</span>(CP)<span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb66-17"><a href="spatio-temporal-variation-models.html#cb66-17" tabindex="-1"></a>              max_CP<span class="sc">&gt;</span><span class="fu">min</span>(CP)<span class="sc">~</span><span class="fu">round</span>((<span class="fu">max</span>(Yield_hat)<span class="sc">-</span><span class="fu">min</span>(Yield_hat))<span class="sc">/</span>(<span class="fu">max</span>(CP)<span class="sc">-</span><span class="fu">min</span>(CP)),</span>
<span id="cb66-18"><a href="spatio-temporal-variation-models.html#cb66-18" tabindex="-1"></a>                                   <span class="dv">3</span>)))<span class="sc">%&gt;%</span></span>
<span id="cb66-19"><a href="spatio-temporal-variation-models.html#cb66-19" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(growth_rate) <span class="sc">%&gt;%</span></span>
<span id="cb66-20"><a href="spatio-temporal-variation-models.html#cb66-20" tabindex="-1"></a>            <span class="fu">unique</span>()),</span>
<span id="cb66-21"><a href="spatio-temporal-variation-models.html#cb66-21" tabindex="-1"></a>    <span class="do">## Decay rate ##</span></span>
<span id="cb66-22"><a href="spatio-temporal-variation-models.html#cb66-22" tabindex="-1"></a>    <span class="at">decay_rate =</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb66-23"><a href="spatio-temporal-variation-models.html#cb66-23" tabindex="-1"></a>      <span class="fu">map</span>(., <span class="sc">~</span><span class="fu">as.data.frame</span>(.) <span class="sc">%&gt;%</span> </span>
<span id="cb66-24"><a href="spatio-temporal-variation-models.html#cb66-24" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">filter</span>(CP <span class="sc">&gt;=</span> max_CP) <span class="sc">%&gt;%</span> </span>
<span id="cb66-25"><a href="spatio-temporal-variation-models.html#cb66-25" tabindex="-1"></a>            <span class="fu">mutate</span>(<span class="at">decay_rate =</span><span class="fu">case_when</span>(</span>
<span id="cb66-26"><a href="spatio-temporal-variation-models.html#cb66-26" tabindex="-1"></a>              max_CP <span class="sc">==</span> <span class="fu">max</span>(CP)<span class="sc">~</span><span class="dv">0</span>,</span>
<span id="cb66-27"><a href="spatio-temporal-variation-models.html#cb66-27" tabindex="-1"></a>              <span class="cn">TRUE</span><span class="sc">~</span><span class="fu">round</span>((<span class="fu">max</span>(Yield_hat)<span class="sc">-</span><span class="fu">min</span>(Yield_hat))<span class="sc">/</span>(<span class="fu">max</span>(CP)<span class="sc">-</span><span class="fu">min</span>(CP)),<span class="dv">3</span>))) <span class="sc">%&gt;%</span></span>
<span id="cb66-28"><a href="spatio-temporal-variation-models.html#cb66-28" tabindex="-1"></a>            dplyr<span class="sc">::</span><span class="fu">select</span>(decay_rate) <span class="sc">%&gt;%</span></span>
<span id="cb66-29"><a href="spatio-temporal-variation-models.html#cb66-29" tabindex="-1"></a>            <span class="fu">unique</span>())) <span class="sc">%&gt;%</span> </span>
<span id="cb66-30"><a href="spatio-temporal-variation-models.html#cb66-30" tabindex="-1"></a>  <span class="fu">unnest</span>(<span class="fu">c</span>(data,growth_rate, decay_rate)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-31"><a href="spatio-temporal-variation-models.html#cb66-31" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">max_Yield =</span> <span class="fu">round</span>(<span class="fu">max</span>(Yield_hat),<span class="dv">1</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb66-32"><a href="spatio-temporal-variation-models.html#cb66-32" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(Variable,ID,X,Y,max_Yield,max_CP,</span>
<span id="cb66-33"><a href="spatio-temporal-variation-models.html#cb66-33" tabindex="-1"></a>                growth_rate, decay_rate, reach_max) <span class="sc">%&gt;%</span></span>
<span id="cb66-34"><a href="spatio-temporal-variation-models.html#cb66-34" tabindex="-1"></a>  <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb66-35"><a href="spatio-temporal-variation-models.html#cb66-35" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">reach_max =</span> <span class="fu">as.factor</span>(<span class="fu">case_when</span>(reach_max <span class="sc">==</span> <span class="st">&quot;yes&quot;</span> <span class="sc">~</span><span class="dv">1</span>,</span>
<span id="cb66-36"><a href="spatio-temporal-variation-models.html#cb66-36" tabindex="-1"></a>                               <span class="cn">TRUE</span> <span class="sc">~</span><span class="dv">0</span>)))</span>
<span id="cb66-37"><a href="spatio-temporal-variation-models.html#cb66-37" tabindex="-1"></a><span class="fu">write.csv</span>(param_df, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/7_SVRP/param_&quot;</span>,FIELD_NAME,<span class="st">&quot;.csv&quot;</span>), <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<p><strong>Plot the SVRP within the field</strong></p>
<p>Plot maps of each Spatially Varying Response Parameter to visualize the spatial distribution of these variables across the field.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="spatio-temporal-variation-models.html#cb67-1" tabindex="-1"></a><span class="do">## Path to the folder containing the SVRP files</span></span>
<span id="cb67-2"><a href="spatio-temporal-variation-models.html#cb67-2" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path_CART =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="st">&quot;1_Data/7_SVRP&quot;</span>, </span>
<span id="cb67-3"><a href="spatio-temporal-variation-models.html#cb67-3" tabindex="-1"></a>                                                     <span class="at">recursive =</span> T, <span class="at">full.names =</span> T, </span>
<span id="cb67-4"><a href="spatio-temporal-variation-models.html#cb67-4" tabindex="-1"></a>                                                     <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>)))</span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="spatio-temporal-variation-models.html#cb68-1" tabindex="-1"></a><span class="do">## Plot and save map figures ##</span></span>
<span id="cb68-2"><a href="spatio-temporal-variation-models.html#cb68-2" tabindex="-1"></a>Vars <span class="ot">&lt;-</span> <span class="fu">unique</span>(YM_df<span class="sc">$</span>Variable)</span>
<span id="cb68-3"><a href="spatio-temporal-variation-models.html#cb68-3" tabindex="-1"></a></span>
<span id="cb68-4"><a href="spatio-temporal-variation-models.html#cb68-4" tabindex="-1"></a><span class="cf">for</span>(v <span class="cf">in</span> Vars) {</span>
<span id="cb68-5"><a href="spatio-temporal-variation-models.html#cb68-5" tabindex="-1"></a>  map_maxY <span class="ot">&lt;-</span>   YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb68-6"><a href="spatio-temporal-variation-models.html#cb68-6" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v) <span class="sc">%&gt;%</span> </span>
<span id="cb68-7"><a href="spatio-temporal-variation-models.html#cb68-7" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, geometry, Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb68-8"><a href="spatio-temporal-variation-models.html#cb68-8" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-9"><a href="spatio-temporal-variation-models.html#cb68-9" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-10"><a href="spatio-temporal-variation-models.html#cb68-10" tabindex="-1"></a>    <span class="fu">left_join</span>(param_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v), </span>
<span id="cb68-11"><a href="spatio-temporal-variation-models.html#cb68-11" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Variable&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-12"><a href="spatio-temporal-variation-models.html#cb68-12" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb68-13"><a href="spatio-temporal-variation-models.html#cb68-13" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> max_Yield), <span class="at">size =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb68-14"><a href="spatio-temporal-variation-models.html#cb68-14" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> grad_MY,<span class="at">breaks =</span> <span class="fu">seq</span>(<span class="dv">2000</span>, <span class="dv">24000</span>, <span class="dv">2000</span>))<span class="sc">+</span></span>
<span id="cb68-15"><a href="spatio-temporal-variation-models.html#cb68-15" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(Maximum<span class="sc">~</span>yield<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^-</span><span class="dv">1</span>)))<span class="sc">+</span></span>
<span id="cb68-16"><a href="spatio-temporal-variation-models.html#cb68-16" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-17"><a href="spatio-temporal-variation-models.html#cb68-17" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-18"><a href="spatio-temporal-variation-models.html#cb68-18" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb68-19"><a href="spatio-temporal-variation-models.html#cb68-19" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-20"><a href="spatio-temporal-variation-models.html#cb68-20" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-21"><a href="spatio-temporal-variation-models.html#cb68-21" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#7f7f7f&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-22"><a href="spatio-temporal-variation-models.html#cb68-22" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-23"><a href="spatio-temporal-variation-models.html#cb68-23" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb68-24"><a href="spatio-temporal-variation-models.html#cb68-24" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb68-25"><a href="spatio-temporal-variation-models.html#cb68-25" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb68-26"><a href="spatio-temporal-variation-models.html#cb68-26" tabindex="-1"></a>          <span class="at">legend.key.height =</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb68-27"><a href="spatio-temporal-variation-models.html#cb68-27" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(.<span class="dv">95</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb68-28"><a href="spatio-temporal-variation-models.html#cb68-28" tabindex="-1"></a>  </span>
<span id="cb68-29"><a href="spatio-temporal-variation-models.html#cb68-29" tabindex="-1"></a>  map_CP <span class="ot">&lt;-</span>  YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb68-30"><a href="spatio-temporal-variation-models.html#cb68-30" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v) <span class="sc">%&gt;%</span> </span>
<span id="cb68-31"><a href="spatio-temporal-variation-models.html#cb68-31" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, geometry, Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb68-32"><a href="spatio-temporal-variation-models.html#cb68-32" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-33"><a href="spatio-temporal-variation-models.html#cb68-33" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-34"><a href="spatio-temporal-variation-models.html#cb68-34" tabindex="-1"></a>    <span class="fu">left_join</span>(param_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v), </span>
<span id="cb68-35"><a href="spatio-temporal-variation-models.html#cb68-35" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Variable&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-36"><a href="spatio-temporal-variation-models.html#cb68-36" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb68-37"><a href="spatio-temporal-variation-models.html#cb68-37" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> max_CP), <span class="at">size =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb68-38"><a href="spatio-temporal-variation-models.html#cb68-38" tabindex="-1"></a>    <span class="fu">scale_color_gradientn</span>(<span class="at">colors =</span> grad_bl)<span class="sc">+</span></span>
<span id="cb68-39"><a href="spatio-temporal-variation-models.html#cb68-39" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(CP<span class="sc">~</span>maximize<span class="sc">~</span>yield<span class="sc">~</span>(mm)))<span class="sc">+</span></span>
<span id="cb68-40"><a href="spatio-temporal-variation-models.html#cb68-40" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-41"><a href="spatio-temporal-variation-models.html#cb68-41" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-42"><a href="spatio-temporal-variation-models.html#cb68-42" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb68-43"><a href="spatio-temporal-variation-models.html#cb68-43" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-44"><a href="spatio-temporal-variation-models.html#cb68-44" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-45"><a href="spatio-temporal-variation-models.html#cb68-45" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#7f7f7f&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-46"><a href="spatio-temporal-variation-models.html#cb68-46" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-47"><a href="spatio-temporal-variation-models.html#cb68-47" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb68-48"><a href="spatio-temporal-variation-models.html#cb68-48" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb68-49"><a href="spatio-temporal-variation-models.html#cb68-49" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb68-50"><a href="spatio-temporal-variation-models.html#cb68-50" tabindex="-1"></a>          <span class="at">legend.key.height =</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb68-51"><a href="spatio-temporal-variation-models.html#cb68-51" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(.<span class="dv">95</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb68-52"><a href="spatio-temporal-variation-models.html#cb68-52" tabindex="-1"></a></span>
<span id="cb68-53"><a href="spatio-temporal-variation-models.html#cb68-53" tabindex="-1"></a>  map_GR <span class="ot">&lt;-</span> YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb68-54"><a href="spatio-temporal-variation-models.html#cb68-54" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v) <span class="sc">%&gt;%</span> </span>
<span id="cb68-55"><a href="spatio-temporal-variation-models.html#cb68-55" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, geometry, Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb68-56"><a href="spatio-temporal-variation-models.html#cb68-56" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-57"><a href="spatio-temporal-variation-models.html#cb68-57" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-58"><a href="spatio-temporal-variation-models.html#cb68-58" tabindex="-1"></a>    <span class="fu">left_join</span>(param_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v), </span>
<span id="cb68-59"><a href="spatio-temporal-variation-models.html#cb68-59" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Variable&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-60"><a href="spatio-temporal-variation-models.html#cb68-60" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb68-61"><a href="spatio-temporal-variation-models.html#cb68-61" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> growth_rate), <span class="at">size =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb68-62"><a href="spatio-temporal-variation-models.html#cb68-62" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb68-63"><a href="spatio-temporal-variation-models.html#cb68-63" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(Growth<span class="sc">~</span>rate<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}<span class="sc">~</span>mm<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})))<span class="sc">+</span></span>
<span id="cb68-64"><a href="spatio-temporal-variation-models.html#cb68-64" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-65"><a href="spatio-temporal-variation-models.html#cb68-65" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-66"><a href="spatio-temporal-variation-models.html#cb68-66" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb68-67"><a href="spatio-temporal-variation-models.html#cb68-67" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-68"><a href="spatio-temporal-variation-models.html#cb68-68" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-69"><a href="spatio-temporal-variation-models.html#cb68-69" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#7f7f7f&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-70"><a href="spatio-temporal-variation-models.html#cb68-70" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-71"><a href="spatio-temporal-variation-models.html#cb68-71" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb68-72"><a href="spatio-temporal-variation-models.html#cb68-72" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb68-73"><a href="spatio-temporal-variation-models.html#cb68-73" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb68-74"><a href="spatio-temporal-variation-models.html#cb68-74" tabindex="-1"></a>          <span class="at">legend.key.height =</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb68-75"><a href="spatio-temporal-variation-models.html#cb68-75" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(.<span class="dv">95</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb68-76"><a href="spatio-temporal-variation-models.html#cb68-76" tabindex="-1"></a></span>
<span id="cb68-77"><a href="spatio-temporal-variation-models.html#cb68-77" tabindex="-1"></a>  map_DR <span class="ot">&lt;-</span> YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb68-78"><a href="spatio-temporal-variation-models.html#cb68-78" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v) <span class="sc">%&gt;%</span> </span>
<span id="cb68-79"><a href="spatio-temporal-variation-models.html#cb68-79" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID,X,Y, geometry, Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb68-80"><a href="spatio-temporal-variation-models.html#cb68-80" tabindex="-1"></a>    <span class="fu">unique</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-81"><a href="spatio-temporal-variation-models.html#cb68-81" tabindex="-1"></a>    <span class="fu">st_as_sf</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb68-82"><a href="spatio-temporal-variation-models.html#cb68-82" tabindex="-1"></a>    <span class="fu">left_join</span>(param_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> v), </span>
<span id="cb68-83"><a href="spatio-temporal-variation-models.html#cb68-83" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>, <span class="st">&quot;Variable&quot;</span>) ) <span class="sc">%&gt;%</span> </span>
<span id="cb68-84"><a href="spatio-temporal-variation-models.html#cb68-84" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb68-85"><a href="spatio-temporal-variation-models.html#cb68-85" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> decay_rate), <span class="at">size =</span> <span class="fl">0.7</span>)<span class="sc">+</span></span>
<span id="cb68-86"><a href="spatio-temporal-variation-models.html#cb68-86" tabindex="-1"></a>    <span class="fu">scale_color_viridis_c</span>(<span class="at">option =</span> <span class="st">&quot;A&quot;</span>, <span class="at">direction =</span> <span class="sc">-</span><span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb68-87"><a href="spatio-temporal-variation-models.html#cb68-87" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="fu">expression</span>(Decay<span class="sc">~</span>rate<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>}<span class="sc">~</span>mm<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})))<span class="sc">+</span></span>
<span id="cb68-88"><a href="spatio-temporal-variation-models.html#cb68-88" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-89"><a href="spatio-temporal-variation-models.html#cb68-89" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb68-90"><a href="spatio-temporal-variation-models.html#cb68-90" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_colorbar</span>(<span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>)) <span class="sc">+</span></span>
<span id="cb68-91"><a href="spatio-temporal-variation-models.html#cb68-91" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-92"><a href="spatio-temporal-variation-models.html#cb68-92" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb68-93"><a href="spatio-temporal-variation-models.html#cb68-93" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#7f7f7f&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-94"><a href="spatio-temporal-variation-models.html#cb68-94" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb68-95"><a href="spatio-temporal-variation-models.html#cb68-95" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb68-96"><a href="spatio-temporal-variation-models.html#cb68-96" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb68-97"><a href="spatio-temporal-variation-models.html#cb68-97" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb68-98"><a href="spatio-temporal-variation-models.html#cb68-98" tabindex="-1"></a>          <span class="at">legend.key.height =</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb68-99"><a href="spatio-temporal-variation-models.html#cb68-99" tabindex="-1"></a>          <span class="at">legend.key.width =</span> <span class="fu">unit</span>(.<span class="dv">95</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb68-100"><a href="spatio-temporal-variation-models.html#cb68-100" tabindex="-1"></a></span>
<span id="cb68-101"><a href="spatio-temporal-variation-models.html#cb68-101" tabindex="-1"></a>  map_SVP <span class="ot">&lt;-</span> cowplot<span class="sc">::</span><span class="fu">plot_grid</span>(map_maxY,map_CP, map_GR, map_DR,</span>
<span id="cb68-102"><a href="spatio-temporal-variation-models.html#cb68-102" tabindex="-1"></a>                                <span class="at">nrow=</span><span class="dv">1</span>, <span class="at">rel_widths =</span> <span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb68-103"><a href="spatio-temporal-variation-models.html#cb68-103" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/6_SVRP/mapSVP_&quot;</span>,FIELD_NAME,<span class="st">&quot;_&quot;</span>,v, <span class="st">&quot;.png&quot;</span>),</span>
<span id="cb68-104"><a href="spatio-temporal-variation-models.html#cb68-104" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">2</span>, <span class="at">width =</span> <span class="fl">8.3</span>)</span>
<span id="cb68-105"><a href="spatio-temporal-variation-models.html#cb68-105" tabindex="-1"></a>}</span>
<span id="cb68-106"><a href="spatio-temporal-variation-models.html#cb68-106" tabindex="-1"></a>map_SVP</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-52-1.png" width="796.8" /></p>
</div>
</div>
<div id="cart" class="section level2 hasAnchor" number="4.4">
<h2><span class="header-section-number">4.4</span> CART<a href="spatio-temporal-variation-models.html#cart" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To classify responses to cumulative precipitation within the field, Classification and Regression Tree (CART) methodology was used, which divides observations into increasingly homogeneous groups (Breiman et al., 2017). The response variable for this classification was the cumulative precipitation that maximizes yield. Explanatory variables included Maximum Yield, Growth Rate, Decay Rate, and a binary indicator of whether maximum yield was reached, derived from the GAM model.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="spatio-temporal-variation-models.html#cb69-1" tabindex="-1"></a><span class="do">###########################################################################</span></span>
<span id="cb69-2"><a href="spatio-temporal-variation-models.html#cb69-2" tabindex="-1"></a><span class="do">#################### FUNCTION CART  to automatize CART ####################</span></span>
<span id="cb69-3"><a href="spatio-temporal-variation-models.html#cb69-3" tabindex="-1"></a><span class="do">###########################################################################</span></span>
<span id="cb69-4"><a href="spatio-temporal-variation-models.html#cb69-4" tabindex="-1"></a>rt_fn <span class="ot">&lt;-</span> <span class="cf">function</span>(Farm_name, var_name, data){</span>
<span id="cb69-5"><a href="spatio-temporal-variation-models.html#cb69-5" tabindex="-1"></a>  <span class="co"># Filter data for the specific crop</span></span>
<span id="cb69-6"><a href="spatio-temporal-variation-models.html#cb69-6" tabindex="-1"></a>  <span class="co"># Run Regression tree</span></span>
<span id="cb69-7"><a href="spatio-temporal-variation-models.html#cb69-7" tabindex="-1"></a>  rt <span class="ot">&lt;-</span> rpart<span class="sc">::</span><span class="fu">rpart</span>(max_CP <span class="sc">~</span> growth_rate <span class="sc">+</span> decay_rate <span class="sc">+</span> reach_max <span class="sc">+</span> max_Yield,</span>
<span id="cb69-8"><a href="spatio-temporal-variation-models.html#cb69-8" tabindex="-1"></a>                     <span class="at">method =</span> <span class="st">&quot;anova&quot;</span>,</span>
<span id="cb69-9"><a href="spatio-temporal-variation-models.html#cb69-9" tabindex="-1"></a>                     <span class="at">control =</span>  <span class="fu">rpart.control</span>(<span class="at">cp =</span> <span class="fl">0.05</span>,<span class="at">maxdepth =</span> <span class="dv">2</span>),</span>
<span id="cb69-10"><a href="spatio-temporal-variation-models.html#cb69-10" tabindex="-1"></a>                     <span class="at">data =</span> data)</span>
<span id="cb69-11"><a href="spatio-temporal-variation-models.html#cb69-11" tabindex="-1"></a>   <span class="co">#Save CART plot</span></span>
<span id="cb69-12"><a href="spatio-temporal-variation-models.html#cb69-12" tabindex="-1"></a>  <span class="fu">png</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/7_CART/1_CART_plot/&quot;</span>,Farm_name, <span class="st">&quot;_&quot;</span>,var_name, <span class="st">&quot;.png&quot;</span>))</span>
<span id="cb69-13"><a href="spatio-temporal-variation-models.html#cb69-13" tabindex="-1"></a>  <span class="fu">rpart.plot</span>(rt)</span>
<span id="cb69-14"><a href="spatio-temporal-variation-models.html#cb69-14" tabindex="-1"></a>  <span class="fu">dev.off</span>()</span>
<span id="cb69-15"><a href="spatio-temporal-variation-models.html#cb69-15" tabindex="-1"></a>  </span>
<span id="cb69-16"><a href="spatio-temporal-variation-models.html#cb69-16" tabindex="-1"></a>  <span class="co"># Get terminal node (leaf) assignments and create group names</span></span>
<span id="cb69-17"><a href="spatio-temporal-variation-models.html#cb69-17" tabindex="-1"></a>  data <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span></span>
<span id="cb69-18"><a href="spatio-temporal-variation-models.html#cb69-18" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-19"><a href="spatio-temporal-variation-models.html#cb69-19" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">node =</span> <span class="fu">predict</span>(rt, <span class="at">type =</span> <span class="st">&quot;vector&quot;</span>),<span class="co"># Add node predictions</span></span>
<span id="cb69-20"><a href="spatio-temporal-variation-models.html#cb69-20" tabindex="-1"></a>           <span class="at">group =</span> <span class="fu">factor</span>(node)) <span class="sc">%&gt;%</span><span class="co"># Convert node numbers to factor for labeling</span></span>
<span id="cb69-21"><a href="spatio-temporal-variation-models.html#cb69-21" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">as.integer</span>(group)) <span class="sc">%&gt;%</span> <span class="co"># Ensure group is integer for sorting if needed</span></span>
<span id="cb69-22"><a href="spatio-temporal-variation-models.html#cb69-22" tabindex="-1"></a>    <span class="fu">arrange</span>(group) <span class="sc">%&gt;%</span><span class="co"># arrange by group for consistent labeling</span></span>
<span id="cb69-23"><a href="spatio-temporal-variation-models.html#cb69-23" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">group =</span> <span class="fu">paste0</span>(<span class="st">&quot;G&quot;</span>, <span class="fu">dense_rank</span>(group)))<span class="co"># Create unique group names</span></span>
<span id="cb69-24"><a href="spatio-temporal-variation-models.html#cb69-24" tabindex="-1"></a>  </span>
<span id="cb69-25"><a href="spatio-temporal-variation-models.html#cb69-25" tabindex="-1"></a>  <span class="co"># Example of further usage, such as joining and summarizing</span></span>
<span id="cb69-26"><a href="spatio-temporal-variation-models.html#cb69-26" tabindex="-1"></a>  regT_df <span class="ot">&lt;-</span> pred_df <span class="sc">%&gt;%</span></span>
<span id="cb69-27"><a href="spatio-temporal-variation-models.html#cb69-27" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> var_name) <span class="sc">%&gt;%</span> </span>
<span id="cb69-28"><a href="spatio-temporal-variation-models.html#cb69-28" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb69-29"><a href="spatio-temporal-variation-models.html#cb69-29" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID, CP, Yield_hat) <span class="sc">%&gt;%</span></span>
<span id="cb69-30"><a href="spatio-temporal-variation-models.html#cb69-30" tabindex="-1"></a>    <span class="fu">left_join</span>(data, <span class="at">by =</span> <span class="st">&quot;ID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb69-31"><a href="spatio-temporal-variation-models.html#cb69-31" tabindex="-1"></a>    <span class="fu">group_by</span>(group, CP) <span class="sc">%&gt;%</span></span>
<span id="cb69-32"><a href="spatio-temporal-variation-models.html#cb69-32" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean_Y =</span> <span class="fu">mean</span>(Yield_hat),</span>
<span id="cb69-33"><a href="spatio-temporal-variation-models.html#cb69-33" tabindex="-1"></a>         <span class="at">Q975 =</span> <span class="fu">quantile</span>(Yield_hat, <span class="fl">0.95</span>),</span>
<span id="cb69-34"><a href="spatio-temporal-variation-models.html#cb69-34" tabindex="-1"></a>         <span class="at">Q025 =</span> <span class="fu">quantile</span>(Yield_hat, <span class="fl">0.05</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb69-35"><a href="spatio-temporal-variation-models.html#cb69-35" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span> </span>
<span id="cb69-36"><a href="spatio-temporal-variation-models.html#cb69-36" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">q975CP =</span> <span class="fu">quantile</span>(max_CP, <span class="fl">0.95</span>),</span>
<span id="cb69-37"><a href="spatio-temporal-variation-models.html#cb69-37" tabindex="-1"></a>         <span class="at">q025CP =</span> <span class="fu">quantile</span>(max_CP, <span class="fl">0.05</span>))</span>
<span id="cb69-38"><a href="spatio-temporal-variation-models.html#cb69-38" tabindex="-1"></a>   </span>
<span id="cb69-39"><a href="spatio-temporal-variation-models.html#cb69-39" tabindex="-1"></a>   <span class="fu">write.csv</span>(regT_df, <span class="fu">paste0</span>(<span class="st">&quot;1_Data/8_CART/CART_&quot;</span>,Farm_name,<span class="st">&quot;_&quot;</span>,var_name,<span class="st">&quot;.csv&quot;</span>), </span>
<span id="cb69-40"><a href="spatio-temporal-variation-models.html#cb69-40" tabindex="-1"></a>             <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span>
<span id="cb69-41"><a href="spatio-temporal-variation-models.html#cb69-41" tabindex="-1"></a>   <span class="fu">return</span>(regT_df)</span>
<span id="cb69-42"><a href="spatio-temporal-variation-models.html#cb69-42" tabindex="-1"></a>}</span></code></pre></div>
<div id="run-cart" class="section level3 hasAnchor" number="4.4.1">
<h3><span class="header-section-number">4.4.1</span> Run CART<a href="spatio-temporal-variation-models.html#run-cart" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="spatio-temporal-variation-models.html#cb70-1" tabindex="-1"></a><span class="co"># Obtain Files</span></span>
<span id="cb70-2"><a href="spatio-temporal-variation-models.html#cb70-2" tabindex="-1"></a>f_cart <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path_SVP =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="st">&quot;1_Data/7_SVRP&quot;</span>, </span>
<span id="cb70-3"><a href="spatio-temporal-variation-models.html#cb70-3" tabindex="-1"></a>                                                     <span class="at">recursive =</span> T,</span>
<span id="cb70-4"><a href="spatio-temporal-variation-models.html#cb70-4" tabindex="-1"></a>                                                     <span class="at">full.names =</span> T, </span>
<span id="cb70-5"><a href="spatio-temporal-variation-models.html#cb70-5" tabindex="-1"></a>                                                     <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb70-6"><a href="spatio-temporal-variation-models.html#cb70-6" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">path_pred =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="st">&quot;1_Data/6_GAMs_pred&quot;</span>,</span>
<span id="cb70-7"><a href="spatio-temporal-variation-models.html#cb70-7" tabindex="-1"></a>                                          <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>,</span>
<span id="cb70-8"><a href="spatio-temporal-variation-models.html#cb70-8" tabindex="-1"></a>                                          <span class="at">recursive =</span> T,<span class="at">full.names =</span> T))) <span class="sc">%&gt;%</span> </span>
<span id="cb70-9"><a href="spatio-temporal-variation-models.html#cb70-9" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Farm=</span> <span class="fu">str_remove</span>(path_SVP, <span class="st">&quot;1_Data/7_SVRP/param_&quot;</span>),</span>
<span id="cb70-10"><a href="spatio-temporal-variation-models.html#cb70-10" tabindex="-1"></a>         <span class="at">Farm =</span> <span class="fu">str_remove</span>(Farm, <span class="st">&quot;.csv&quot;</span>), <span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb70-11"><a href="spatio-temporal-variation-models.html#cb70-11" tabindex="-1"></a>  <span class="do">## Filter the farm/field that we are testing in the moment</span></span>
<span id="cb70-12"><a href="spatio-temporal-variation-models.html#cb70-12" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Farm <span class="sc">==</span> FIELD_NAME)</span></code></pre></div>
<p>Run this code that contains a function (rt_fn) previously created. rt_fn function: i) runs the CART model (rpart function) for each crop in each field; ii) Saves the CART tree figure; iii) create a dataframe splitting the data depending on the group.</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="spatio-temporal-variation-models.html#cb71-1" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(f_cart)){</span>
<span id="cb71-2"><a href="spatio-temporal-variation-models.html#cb71-2" tabindex="-1"></a>  <span class="do">## Upload files </span></span>
<span id="cb71-3"><a href="spatio-temporal-variation-models.html#cb71-3" tabindex="-1"></a>  Farm <span class="ot">&lt;-</span> f_cart[file,<span class="dv">1</span>]</span>
<span id="cb71-4"><a href="spatio-temporal-variation-models.html#cb71-4" tabindex="-1"></a>  param_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(f_cart[file,<span class="dv">2</span>])</span>
<span id="cb71-5"><a href="spatio-temporal-variation-models.html#cb71-5" tabindex="-1"></a>  pred_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(f_cart[file,<span class="dv">3</span>])</span>
<span id="cb71-6"><a href="spatio-temporal-variation-models.html#cb71-6" tabindex="-1"></a></span>
<span id="cb71-7"><a href="spatio-temporal-variation-models.html#cb71-7" tabindex="-1"></a>  <span class="do">## Run CART, write figures &amp; files in folder</span></span>
<span id="cb71-8"><a href="spatio-temporal-variation-models.html#cb71-8" tabindex="-1"></a>  param_df <span class="sc">%&gt;%</span> </span>
<span id="cb71-9"><a href="spatio-temporal-variation-models.html#cb71-9" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb71-10"><a href="spatio-temporal-variation-models.html#cb71-10" tabindex="-1"></a>    <span class="fu">group_by</span>(Variable) <span class="sc">%&gt;%</span> </span>
<span id="cb71-11"><a href="spatio-temporal-variation-models.html#cb71-11" tabindex="-1"></a>    <span class="fu">nest</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb71-12"><a href="spatio-temporal-variation-models.html#cb71-12" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">cart =</span> <span class="fu">map2</span>(<span class="at">.x =</span> Variable, <span class="at">.y =</span> data,</span>
<span id="cb71-13"><a href="spatio-temporal-variation-models.html#cb71-13" tabindex="-1"></a>                       <span class="co"># function created previously</span></span>
<span id="cb71-14"><a href="spatio-temporal-variation-models.html#cb71-14" tabindex="-1"></a>                       <span class="at">.f =</span> <span class="sc">~</span><span class="fu">rt_fn</span>(<span class="at">Farm_name =</span> Farm, <span class="at">var_name =</span> .x, <span class="at">data =</span> .y)))</span>
<span id="cb71-15"><a href="spatio-temporal-variation-models.html#cb71-15" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="obtain-figures" class="section level3 hasAnchor" number="4.4.2">
<h3><span class="header-section-number">4.4.2</span> Obtain Figures<a href="spatio-temporal-variation-models.html#obtain-figures" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="spatio-temporal-variation-models.html#cb72-1" tabindex="-1"></a>files <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">path_CART =</span> <span class="fu">as.vector</span>(<span class="fu">list.files</span>(<span class="st">&quot;1_Data/8_CART&quot;</span>, </span>
<span id="cb72-2"><a href="spatio-temporal-variation-models.html#cb72-2" tabindex="-1"></a>                                                     <span class="at">recursive =</span> T,</span>
<span id="cb72-3"><a href="spatio-temporal-variation-models.html#cb72-3" tabindex="-1"></a>                                                     <span class="at">full.names =</span> T, </span>
<span id="cb72-4"><a href="spatio-temporal-variation-models.html#cb72-4" tabindex="-1"></a>                                                     <span class="at">pattern =</span> <span class="st">&quot;.csv&quot;</span>))) <span class="sc">%&gt;%</span> </span>
<span id="cb72-5"><a href="spatio-temporal-variation-models.html#cb72-5" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">Farm=</span> <span class="fu">str_remove</span>(path_CART, <span class="st">&quot;1_Data/8_CART/CART_&quot;</span>),</span>
<span id="cb72-6"><a href="spatio-temporal-variation-models.html#cb72-6" tabindex="-1"></a>         <span class="at">Farm =</span> <span class="fu">str_remove</span>(Farm, <span class="st">&quot;.csv&quot;</span>),<span class="at">.before =</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-7"><a href="spatio-temporal-variation-models.html#cb72-7" tabindex="-1"></a>  <span class="fu">separate</span>(Farm, <span class="at">into =</span> <span class="fu">c</span>(<span class="st">&quot;Farm&quot;</span>, <span class="st">&quot;Variable&quot;</span>),<span class="at">sep =</span> <span class="st">&quot;_(?=[^_]+$)&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb72-8"><a href="spatio-temporal-variation-models.html#cb72-8" tabindex="-1"></a>  <span class="do">## Filter the farm/field that we are testing in the moment</span></span>
<span id="cb72-9"><a href="spatio-temporal-variation-models.html#cb72-9" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(Farm <span class="sc">==</span> FIELD_NAME)</span></code></pre></div>
<p>Create a figure that includes a map showing the distribution of groups within the field, the yield response to precipitation within each group across the field, and the range of each Spatially Varying Response Parameter within each group.</p>
<div class="sourceCode" id="cb73"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb73-1"><a href="spatio-temporal-variation-models.html#cb73-1" tabindex="-1"></a><span class="do">## Obtain figures and save ##</span></span>
<span id="cb73-2"><a href="spatio-temporal-variation-models.html#cb73-2" tabindex="-1"></a><span class="cf">for</span> (file <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(files)){</span>
<span id="cb73-3"><a href="spatio-temporal-variation-models.html#cb73-3" tabindex="-1"></a>  <span class="do">## Upload files </span></span>
<span id="cb73-4"><a href="spatio-temporal-variation-models.html#cb73-4" tabindex="-1"></a>  Farm <span class="ot">&lt;-</span> files[file,<span class="dv">1</span>]</span>
<span id="cb73-5"><a href="spatio-temporal-variation-models.html#cb73-5" tabindex="-1"></a>  var_name <span class="ot">&lt;-</span> files[file,<span class="dv">2</span>]</span>
<span id="cb73-6"><a href="spatio-temporal-variation-models.html#cb73-6" tabindex="-1"></a>  regT_df <span class="ot">&lt;-</span> <span class="fu">read.csv</span>(files[file,<span class="dv">3</span>])</span>
<span id="cb73-7"><a href="spatio-temporal-variation-models.html#cb73-7" tabindex="-1"></a>  <span class="do">## Plot groups spatial distribution in the field</span></span>
<span id="cb73-8"><a href="spatio-temporal-variation-models.html#cb73-8" tabindex="-1"></a>  map_gr <span class="ot">&lt;-</span> YM_df <span class="sc">%&gt;%</span> </span>
<span id="cb73-9"><a href="spatio-temporal-variation-models.html#cb73-9" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">filter</span>(Variable <span class="sc">==</span> var_name) <span class="sc">%&gt;%</span> </span>
<span id="cb73-10"><a href="spatio-temporal-variation-models.html#cb73-10" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(X,Y) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-11"><a href="spatio-temporal-variation-models.html#cb73-11" tabindex="-1"></a>    <span class="fu">group_by</span>(X,Y) <span class="sc">%&gt;%</span> </span>
<span id="cb73-12"><a href="spatio-temporal-variation-models.html#cb73-12" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">ID =</span> <span class="fu">cur_group_id</span>()) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb73-13"><a href="spatio-temporal-variation-models.html#cb73-13" tabindex="-1"></a>    <span class="fu">left_join</span>(regT_df <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(group, ID) <span class="sc">%&gt;%</span> <span class="fu">unique</span>(),</span>
<span id="cb73-14"><a href="spatio-temporal-variation-models.html#cb73-14" tabindex="-1"></a>              <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;ID&quot;</span>)) <span class="sc">%&gt;%</span> </span>
<span id="cb73-15"><a href="spatio-temporal-variation-models.html#cb73-15" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb73-16"><a href="spatio-temporal-variation-models.html#cb73-16" tabindex="-1"></a>    <span class="fu">geom_sf</span>(<span class="fu">aes</span>(<span class="at">color =</span> group), <span class="at">size =</span><span class="dv">3</span>)<span class="sc">+</span></span>
<span id="cb73-17"><a href="spatio-temporal-variation-models.html#cb73-17" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span><span class="fu">c</span>(<span class="st">&quot;#61a5c2&quot;</span>, <span class="st">&quot;#01497c&quot;</span>,<span class="st">&quot;#011d36&quot;</span>, <span class="st">&quot;#010912&quot;</span>),</span>
<span id="cb73-18"><a href="spatio-temporal-variation-models.html#cb73-18" tabindex="-1"></a>                       <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>))<span class="sc">+</span></span>
<span id="cb73-19"><a href="spatio-temporal-variation-models.html#cb73-19" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;Groups&quot;</span>)<span class="sc">+</span></span>
<span id="cb73-20"><a href="spatio-temporal-variation-models.html#cb73-20" tabindex="-1"></a>    <span class="fu">scale_y_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb73-21"><a href="spatio-temporal-variation-models.html#cb73-21" tabindex="-1"></a>    <span class="fu">scale_x_continuous</span>(<span class="at">expand =</span> <span class="fu">c</span>(.<span class="dv">15</span>,.<span class="dv">15</span>))<span class="sc">+</span></span>
<span id="cb73-22"><a href="spatio-temporal-variation-models.html#cb73-22" tabindex="-1"></a>    <span class="fu">guides</span>(<span class="at">color =</span> <span class="fu">guide_legend</span>(<span class="at">override.aes =</span> <span class="fu">list</span>(<span class="at">size =</span> <span class="dv">3</span>),</span>
<span id="cb73-23"><a href="spatio-temporal-variation-models.html#cb73-23" tabindex="-1"></a>                                <span class="at">title.position =</span> <span class="st">&quot;top&quot;</span>, <span class="at">title.hjust =</span> <span class="fl">0.5</span>))<span class="sc">+</span></span>
<span id="cb73-24"><a href="spatio-temporal-variation-models.html#cb73-24" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">axis.text =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-25"><a href="spatio-temporal-variation-models.html#cb73-25" tabindex="-1"></a>          <span class="at">axis.ticks =</span> <span class="fu">element_blank</span>(), </span>
<span id="cb73-26"><a href="spatio-temporal-variation-models.html#cb73-26" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#7f7f7f&quot;</span>, <span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb73-27"><a href="spatio-temporal-variation-models.html#cb73-27" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#949494&quot;</span>),</span>
<span id="cb73-28"><a href="spatio-temporal-variation-models.html#cb73-28" tabindex="-1"></a>          <span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>,</span>
<span id="cb73-29"><a href="spatio-temporal-variation-models.html#cb73-29" tabindex="-1"></a>          <span class="at">legend.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">12</span>),</span>
<span id="cb73-30"><a href="spatio-temporal-variation-models.html#cb73-30" tabindex="-1"></a>          <span class="at">legend.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb73-31"><a href="spatio-temporal-variation-models.html#cb73-31" tabindex="-1"></a>          <span class="at">legend.key.height=</span> <span class="fu">unit</span>(.<span class="dv">2</span>, <span class="st">&#39;cm&#39;</span>),</span>
<span id="cb73-32"><a href="spatio-temporal-variation-models.html#cb73-32" tabindex="-1"></a>          <span class="at">legend.key.width=</span> <span class="fu">unit</span>(.<span class="dv">4</span>, <span class="st">&#39;cm&#39;</span>))</span>
<span id="cb73-33"><a href="spatio-temporal-variation-models.html#cb73-33" tabindex="-1"></a>  </span>
<span id="cb73-34"><a href="spatio-temporal-variation-models.html#cb73-34" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/7_CART/2_Field_classif/mapGr_&quot;</span>,Farm,<span class="st">&quot;_&quot;</span>,var_name,<span class="st">&quot;.png&quot;</span>))</span>
<span id="cb73-35"><a href="spatio-temporal-variation-models.html#cb73-35" tabindex="-1"></a>  </span>
<span id="cb73-36"><a href="spatio-temporal-variation-models.html#cb73-36" tabindex="-1"></a>  <span class="do">## Plot type of response</span></span>
<span id="cb73-37"><a href="spatio-temporal-variation-models.html#cb73-37" tabindex="-1"></a>  group_responses <span class="ot">&lt;-</span> regT_df <span class="sc">%&gt;%</span></span>
<span id="cb73-38"><a href="spatio-temporal-variation-models.html#cb73-38" tabindex="-1"></a>    <span class="fu">ggplot</span>()<span class="sc">+</span></span>
<span id="cb73-39"><a href="spatio-temporal-variation-models.html#cb73-39" tabindex="-1"></a>    <span class="fu">geom_rect</span>(<span class="at">data =</span> regT_df <span class="sc">%&gt;%</span></span>
<span id="cb73-40"><a href="spatio-temporal-variation-models.html#cb73-40" tabindex="-1"></a>                <span class="fu">group_by</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb73-41"><a href="spatio-temporal-variation-models.html#cb73-41" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">select</span>(group, ID,q975CP, q025CP, Yield_hat) <span class="sc">%&gt;%</span></span>
<span id="cb73-42"><a href="spatio-temporal-variation-models.html#cb73-42" tabindex="-1"></a>                dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="fu">row_number</span>() <span class="sc">==</span> <span class="dv">1</span>) <span class="sc">%&gt;%</span>  <span class="fu">unique</span>(),</span>
<span id="cb73-43"><a href="spatio-temporal-variation-models.html#cb73-43" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">xmin =</span> q025CP, <span class="at">xmax =</span> q975CP),<span class="at">ymin =</span> <span class="sc">-</span><span class="cn">Inf</span>, <span class="at">ymax=</span><span class="cn">Inf</span>,</span>
<span id="cb73-44"><a href="spatio-temporal-variation-models.html#cb73-44" tabindex="-1"></a>              <span class="at">fill =</span> <span class="st">&quot;#274060&quot;</span>,<span class="at">alpha=</span>.<span class="dv">2</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb73-45"><a href="spatio-temporal-variation-models.html#cb73-45" tabindex="-1"></a>    <span class="fu">geom_ribbon</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP, <span class="at">ymin =</span> Q025, <span class="at">ymax =</span> Q975,<span class="at">fill =</span>group),</span>
<span id="cb73-46"><a href="spatio-temporal-variation-models.html#cb73-46" tabindex="-1"></a>                <span class="at">alpha =</span><span class="fl">0.9</span>, <span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb73-47"><a href="spatio-temporal-variation-models.html#cb73-47" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP,<span class="at">y =</span> mean_Y),</span>
<span id="cb73-48"><a href="spatio-temporal-variation-models.html#cb73-48" tabindex="-1"></a>              <span class="at">color =</span> <span class="st">&quot;Black&quot;</span>, <span class="at">linewidth =</span> <span class="dv">1</span>,<span class="at">show.legend =</span> F)<span class="sc">+</span></span>
<span id="cb73-49"><a href="spatio-temporal-variation-models.html#cb73-49" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP,<span class="at">y =</span> Q975),</span>
<span id="cb73-50"><a href="spatio-temporal-variation-models.html#cb73-50" tabindex="-1"></a>              <span class="at">color=</span><span class="st">&quot;Black&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>,<span class="at">show.legend =</span>F,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb73-51"><a href="spatio-temporal-variation-models.html#cb73-51" tabindex="-1"></a>    <span class="fu">geom_line</span>(<span class="fu">aes</span>(<span class="at">x =</span> CP,<span class="at">y =</span> Q025),</span>
<span id="cb73-52"><a href="spatio-temporal-variation-models.html#cb73-52" tabindex="-1"></a>              <span class="at">color=</span><span class="st">&quot;Black&quot;</span>, <span class="at">linewidth=</span><span class="dv">1</span>,<span class="at">show.legend =</span>F,<span class="at">linetype=</span><span class="st">&quot;dashed&quot;</span>)<span class="sc">+</span></span>
<span id="cb73-53"><a href="spatio-temporal-variation-models.html#cb73-53" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>group, <span class="at">nrow =</span> <span class="dv">1</span>)<span class="sc">+</span></span>
<span id="cb73-54"><a href="spatio-temporal-variation-models.html#cb73-54" tabindex="-1"></a>    <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#61a5c2&quot;</span>, <span class="st">&quot;#01497c&quot;</span>,<span class="st">&quot;#011d36&quot;</span>, <span class="st">&quot;#010912&quot;</span>),</span>
<span id="cb73-55"><a href="spatio-temporal-variation-models.html#cb73-55" tabindex="-1"></a>                       <span class="at">aesthetics =</span> <span class="fu">c</span>(<span class="st">&quot;color&quot;</span>, <span class="st">&quot;fill&quot;</span>))<span class="sc">+</span></span>
<span id="cb73-56"><a href="spatio-temporal-variation-models.html#cb73-56" tabindex="-1"></a>    <span class="co">#scale_y_continuous(breaks = seq(0, 350, 40))+</span></span>
<span id="cb73-57"><a href="spatio-temporal-variation-models.html#cb73-57" tabindex="-1"></a>    <span class="fu">expand_limits</span>(<span class="at">y=</span><span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb73-58"><a href="spatio-temporal-variation-models.html#cb73-58" tabindex="-1"></a>    <span class="co">#scale_x_continuous(breaks = seq(0, 550, 25))+</span></span>
<span id="cb73-59"><a href="spatio-temporal-variation-models.html#cb73-59" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">x =</span> <span class="st">&quot;Cumulative precipitation (mm)&quot;</span>,</span>
<span id="cb73-60"><a href="spatio-temporal-variation-models.html#cb73-60" tabindex="-1"></a>       <span class="at">y =</span> <span class="fu">expression</span>(Predicted<span class="sc">~</span>yield<span class="sc">~</span>(kg<span class="sc">~</span>ha<span class="sc">^</span>{<span class="sc">-</span><span class="dv">1</span>})))<span class="sc">+</span></span>
<span id="cb73-61"><a href="spatio-temporal-variation-models.html#cb73-61" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb73-62"><a href="spatio-temporal-variation-models.html#cb73-62" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-63"><a href="spatio-temporal-variation-models.html#cb73-63" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb73-64"><a href="spatio-temporal-variation-models.html#cb73-64" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#eeeeee&quot;</span>),</span>
<span id="cb73-65"><a href="spatio-temporal-variation-models.html#cb73-65" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#f8f9fa&quot;</span>),</span>
<span id="cb73-66"><a href="spatio-temporal-variation-models.html#cb73-66" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb73-67"><a href="spatio-temporal-variation-models.html#cb73-67" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">11</span>),</span>
<span id="cb73-68"><a href="spatio-temporal-variation-models.html#cb73-68" tabindex="-1"></a>          <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>))</span>
<span id="cb73-69"><a href="spatio-temporal-variation-models.html#cb73-69" tabindex="-1"></a></span>
<span id="cb73-70"><a href="spatio-temporal-variation-models.html#cb73-70" tabindex="-1"></a>  <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/7_CART/2_Field_classif/grResp_&quot;</span>,Farm,<span class="st">&quot;_&quot;</span>,var_name,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb73-71"><a href="spatio-temporal-variation-models.html#cb73-71" tabindex="-1"></a>         <span class="at">height =</span> <span class="dv">3</span>,<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb73-72"><a href="spatio-temporal-variation-models.html#cb73-72" tabindex="-1"></a></span>
<span id="cb73-73"><a href="spatio-temporal-variation-models.html#cb73-73" tabindex="-1"></a>  <span class="do">## Plot parameters</span></span>
<span id="cb73-74"><a href="spatio-temporal-variation-models.html#cb73-74" tabindex="-1"></a>  param_gr <span class="ot">&lt;-</span> regT_df <span class="sc">%&gt;%</span></span>
<span id="cb73-75"><a href="spatio-temporal-variation-models.html#cb73-75" tabindex="-1"></a>    dplyr<span class="sc">::</span><span class="fu">select</span>(ID,max_CP, growth_rate,decay_rate, max_Yield,group) <span class="sc">%&gt;%</span></span>
<span id="cb73-76"><a href="spatio-temporal-variation-models.html#cb73-76" tabindex="-1"></a>    <span class="fu">distinct</span>() <span class="sc">%&gt;%</span></span>
<span id="cb73-77"><a href="spatio-temporal-variation-models.html#cb73-77" tabindex="-1"></a>    <span class="fu">rename</span>(<span class="st">&quot;CP maximize yield&quot;</span> <span class="ot">=</span> max_CP,</span>
<span id="cb73-78"><a href="spatio-temporal-variation-models.html#cb73-78" tabindex="-1"></a>           <span class="st">&quot;Maximum Yield&quot;</span> <span class="ot">=</span> max_Yield,</span>
<span id="cb73-79"><a href="spatio-temporal-variation-models.html#cb73-79" tabindex="-1"></a>           <span class="st">&quot;Growth rate&quot;</span> <span class="ot">=</span> growth_rate,</span>
<span id="cb73-80"><a href="spatio-temporal-variation-models.html#cb73-80" tabindex="-1"></a>           <span class="st">&quot;Decay rate&quot;</span> <span class="ot">=</span> decay_rate) <span class="sc">%&gt;%</span></span>
<span id="cb73-81"><a href="spatio-temporal-variation-models.html#cb73-81" tabindex="-1"></a>    <span class="fu">pivot_longer</span>(<span class="fu">c</span>(<span class="st">`</span><span class="at">Maximum Yield</span><span class="st">`</span>,<span class="st">`</span><span class="at">CP maximize yield</span><span class="st">`</span>,<span class="st">`</span><span class="at">Growth rate</span><span class="st">`</span>,<span class="st">`</span><span class="at">Decay rate</span><span class="st">`</span>),</span>
<span id="cb73-82"><a href="spatio-temporal-variation-models.html#cb73-82" tabindex="-1"></a>                 <span class="at">names_to =</span> <span class="st">&quot;Var&quot;</span>, <span class="at">values_to =</span> <span class="st">&quot;Val&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb73-83"><a href="spatio-temporal-variation-models.html#cb73-83" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">Var =</span> <span class="fu">as.factor</span>(Var),</span>
<span id="cb73-84"><a href="spatio-temporal-variation-models.html#cb73-84" tabindex="-1"></a>           <span class="at">Var =</span> <span class="fu">fct_relevel</span>(Var,<span class="st">&quot;Maximum Yield&quot;</span>, <span class="st">&quot;CP maximize yield&quot;</span>,</span>
<span id="cb73-85"><a href="spatio-temporal-variation-models.html#cb73-85" tabindex="-1"></a>                             <span class="st">&quot;Growth rate&quot;</span>,<span class="st">&quot;Decay rate&quot;</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-86"><a href="spatio-temporal-variation-models.html#cb73-86" tabindex="-1"></a>    <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(Var, group) <span class="sc">%&gt;%</span></span>
<span id="cb73-87"><a href="spatio-temporal-variation-models.html#cb73-87" tabindex="-1"></a>    <span class="fu">summarise</span>(<span class="at">meanCl =</span> <span class="fu">mean</span>(Val),</span>
<span id="cb73-88"><a href="spatio-temporal-variation-models.html#cb73-88" tabindex="-1"></a>              <span class="at">q975Cl =</span> <span class="fu">quantile</span>(Val, .<span class="dv">975</span>),</span>
<span id="cb73-89"><a href="spatio-temporal-variation-models.html#cb73-89" tabindex="-1"></a>              <span class="at">q025Cl =</span> <span class="fu">quantile</span>(Val, .<span class="dv">025</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb73-90"><a href="spatio-temporal-variation-models.html#cb73-90" tabindex="-1"></a>    <span class="fu">ungroup</span>(group) <span class="sc">%&gt;%</span></span>
<span id="cb73-91"><a href="spatio-temporal-variation-models.html#cb73-91" tabindex="-1"></a>    <span class="fu">mutate</span>(<span class="at">mean =</span> <span class="fu">mean</span>(meanCl),</span>
<span id="cb73-92"><a href="spatio-temporal-variation-models.html#cb73-92" tabindex="-1"></a>           <span class="at">difMean =</span> meanCl <span class="sc">-</span> mean) <span class="sc">%&gt;%</span></span>
<span id="cb73-93"><a href="spatio-temporal-variation-models.html#cb73-93" tabindex="-1"></a>    <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">y =</span> <span class="fu">as.factor</span>(group), <span class="at">x =</span> meanCl)) <span class="sc">+</span></span>
<span id="cb73-94"><a href="spatio-temporal-variation-models.html#cb73-94" tabindex="-1"></a>    <span class="fu">geom_point</span>(<span class="at">size =</span> <span class="dv">2</span>)<span class="sc">+</span></span>
<span id="cb73-95"><a href="spatio-temporal-variation-models.html#cb73-95" tabindex="-1"></a>    <span class="fu">geom_errorbar</span>(<span class="fu">aes</span>(<span class="at">xmin =</span> q975Cl, <span class="at">xmax =</span> q025Cl), <span class="at">width =</span> <span class="dv">0</span>)<span class="sc">+</span></span>
<span id="cb73-96"><a href="spatio-temporal-variation-models.html#cb73-96" tabindex="-1"></a>    <span class="fu">facet_wrap</span>(<span class="sc">~</span>Var, <span class="at">scales =</span> <span class="st">&quot;free_x&quot;</span>, <span class="at">ncol =</span> <span class="dv">4</span>)<span class="sc">+</span></span>
<span id="cb73-97"><a href="spatio-temporal-variation-models.html#cb73-97" tabindex="-1"></a>    <span class="fu">labs</span>(<span class="at">y =</span> <span class="st">&quot;Group&quot;</span>)<span class="sc">+</span></span>
<span id="cb73-98"><a href="spatio-temporal-variation-models.html#cb73-98" tabindex="-1"></a>    <span class="fu">theme_bw</span>()<span class="sc">+</span></span>
<span id="cb73-99"><a href="spatio-temporal-variation-models.html#cb73-99" tabindex="-1"></a>    <span class="fu">theme</span>(<span class="at">strip.background =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb73-100"><a href="spatio-temporal-variation-models.html#cb73-100" tabindex="-1"></a>          <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb73-101"><a href="spatio-temporal-variation-models.html#cb73-101" tabindex="-1"></a>          <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;#eeeeee&quot;</span>),</span>
<span id="cb73-102"><a href="spatio-temporal-variation-models.html#cb73-102" tabindex="-1"></a>          <span class="at">panel.grid =</span> <span class="fu">element_line</span>(<span class="at">color =</span> <span class="st">&quot;#f8f9fa&quot;</span>),</span>
<span id="cb73-103"><a href="spatio-temporal-variation-models.html#cb73-103" tabindex="-1"></a>          <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">9</span>),</span>
<span id="cb73-104"><a href="spatio-temporal-variation-models.html#cb73-104" tabindex="-1"></a>          <span class="at">axis.title =</span> <span class="fu">element_text</span>(<span class="at">size =</span> <span class="dv">10</span>),</span>
<span id="cb73-105"><a href="spatio-temporal-variation-models.html#cb73-105" tabindex="-1"></a>          <span class="at">axis.ticks.length=</span><span class="fu">unit</span>(<span class="sc">-</span><span class="fl">0.1</span>, <span class="st">&quot;cm&quot;</span>),</span>
<span id="cb73-106"><a href="spatio-temporal-variation-models.html#cb73-106" tabindex="-1"></a>          <span class="at">axis.title.x =</span> <span class="fu">element_blank</span>())</span>
<span id="cb73-107"><a href="spatio-temporal-variation-models.html#cb73-107" tabindex="-1"></a>   </span>
<span id="cb73-108"><a href="spatio-temporal-variation-models.html#cb73-108" tabindex="-1"></a>   <span class="fu">ggsave</span>(<span class="fu">paste0</span>(<span class="st">&quot;3_Output/7_CART/2_Field_classif/paramGr_&quot;</span>,Farm,<span class="st">&quot;_&quot;</span>,var_name,<span class="st">&quot;.png&quot;</span>),</span>
<span id="cb73-109"><a href="spatio-temporal-variation-models.html#cb73-109" tabindex="-1"></a>          <span class="at">height =</span> <span class="fl">2.8</span>,<span class="at">width =</span> <span class="dv">8</span>)</span>
<span id="cb73-110"><a href="spatio-temporal-variation-models.html#cb73-110" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Saving 7 x 5 in image
## `summarise()` has grouped output by &#39;Var&#39;. You can override using the `.groups` argument.
## Saving 7 x 5 in image
## `summarise()` has grouped output by &#39;Var&#39;. You can override using the `.groups` argument.</code></pre>
<div class="sourceCode" id="cb75"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb75-1"><a href="spatio-temporal-variation-models.html#cb75-1" tabindex="-1"></a>map_gr</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-1.png" width="672" /></p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="spatio-temporal-variation-models.html#cb76-1" tabindex="-1"></a>group_responses</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-2.png" width="672" /></p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="spatio-temporal-variation-models.html#cb77-1" tabindex="-1"></a>param_gr</span></code></pre></div>
<p><img src="_main_files/figure-html/unnamed-chunk-57-3.png" width="672" /></p>
</div>
</div>
<div id="reference-2" class="section level2 hasAnchor" number="4.5">
<h2><span class="header-section-number">4.5</span> Reference<a href="spatio-temporal-variation-models.html#reference-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<ol style="list-style-type: decimal">
<li><p>Bivand R, Pebesma E, Gomez-Rubio V (2013). Applied spatial data analysis with R, Second edition. Springer, NY. <a href="https://asdar-book.org/" class="uri">https://asdar-book.org/</a>.</p></li>
<li><p>Pebesma E (2018). Simple Features for R: Standardized Support for Spatial Vector Data. The R Journal, 10(1), 439446. <a href="doi:10.32614/RJ-2018-009" class="uri">doi:10.32614/RJ-2018-009</a>, <a href="https://doi.org/10.32614/RJ-2018-009" class="uri">https://doi.org/10.32614/RJ-2018-009</a>.</p></li>
<li><p>Correndo, A. A., Hefley, T. J., Holzworth, D. P., &amp; Ciampitti, I. A. (2021). Revisiting linear regression to test agreement in continuous predicted-observed datasets. Agricultural Systems, 192, 103194.</p></li>
<li><p>Correndo, A. A., Rosso, L. H. M., Hernandez, C. H., Bastos, L. M., Nieto, L., Holzworth, D., &amp; Ciampitti, I. A. (2022). metrica: an R package to evaluate prediction performance of regression and classification point-forecast models. Journal of Open Source Software, 7(79), 4655.</p></li>
<li><p>Therneau T, Atkinson B (2022). rpart: Recursive Partitioning and Regression Trees. R package version 4.1.19,
<a href="https://CRAN.R-project.org/package=rpart" class="uri">https://CRAN.R-project.org/package=rpart</a>.</p></li>
<li><p>Wickham H, Averick M, Bryan J, Chang W, McGowan LD, Franois R, Grolemund G, Hayes A, Henry L, Hester J, Kuhn M, Pedersen TL, Miller E, Bache SM, Mller K, Ooms J, Robinson D, Seidel DP, Spinu V, Takahashi K, Vaughan D, Wilke C, Woo K, Yutani H (2019). Welcome to the tidyverse. Journal of Open Source Software, 4(43), 1686. <a href="doi:10.21105/joss.01686" class="uri">doi:10.21105/joss.01686</a>.</p></li>
<li><p>Wood, S.N., 2003. Thin Plate Regression Splines. Journal of the Royal Statistical Society Series B: Statistical Methodology 65, 95114. <a href="https://doi.org/10.1111/1467-9868.00374" class="uri">https://doi.org/10.1111/1467-9868.00374</a></p></li>
<li><p>Wood, S.N., 2017. Generalized Additive Models: An Introduction with R, 2nd ed.Chapman and Hall/CRC. <a href="https://doi.org/10.1201/9781315370279" class="uri">https://doi.org/10.1201/9781315370279</a></p></li>
</ol>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="yield-prediction-using-sentinel-2.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/4_SVRP_CART.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub", "_main.figures"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
